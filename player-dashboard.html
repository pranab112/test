<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŽ° Casino Royal Player Dashboard ðŸŽ²</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gold: #FFD700;
            --secondary-gold: #FFA500;
            --neon-red: #FF073A;
            --neon-blue: #0DCDFF;
            --neon-green: #39FF14;
            --neon-purple: #BC13FE;
            --casino-red: #CC0000;
            --casino-green: #00AA00;
            --bg-dark: #0a0a0a;
            --bg-darker: #000000;
            --bg-casino: #1a0000;
            --text-primary: #ffffff;
            --text-secondary: #e0e0e0; /* Improved contrast */
            --text-accessible: #ffffff;
            --text-neon: #00FFFF;
            --focus-ring: 3px solid #00FFFF;
            --success: #39FF14;
            --danger: #FF073A;
            --info: #0DCDFF;

            /* Animation control variables */
            --animation-duration: 2s;
            --animation-intensity: 1;
            --glow-opacity: 0.8;
        }

        /* Accessibility: Reduced Motion Support */
        @media (prefers-reduced-motion: reduce) {
            :root {
                --animation-duration: 0.01ms;
                --animation-intensity: 0;
                --glow-opacity: 0.3;
            }

            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                transform: none !important;
            }
        }

        /* Focus Management */
        *:focus {
            outline: var(--focus-ring);
            outline-offset: 2px;
        }

        /* Skip link for screen readers */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: var(--primary-gold);
            color: var(--bg-dark);
            padding: 8px;
            text-decoration: none;
            z-index: 1000;
        }

        .skip-link:focus {
            top: 6px;
        }

        body {
            font-family: 'Orbitron', 'Segoe UI', monospace;
            background: radial-gradient(circle at center, #1a0000 0%, #000000 50%, #0a0000 100%);
            background-attachment: fixed;
            color: var(--text-primary);
            display: flex;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* Casino Background Effects - Performance Optimized */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(circle at 20% 80%, var(--neon-red) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, var(--neon-blue) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, var(--primary-gold) 0%, transparent 50%);
            opacity: calc(0.05 * var(--glow-opacity));
            z-index: -1;
            animation: casino-glow 12s ease-in-out infinite alternate;
            will-change: opacity;
            transform: translateZ(0);
        }

        @keyframes casino-glow {
            0% { opacity: calc(0.03 * var(--glow-opacity)); }
            100% { opacity: calc(0.08 * var(--glow-opacity)); }
        }

        /* Performance hint for animations */
        .stat-card,
        .login-box,
        .btn {
            will-change: transform;
            transform: translateZ(0);
        }


        /* Optimized Neon text effects */
        .neon-text {
            text-shadow:
                0 0 5px currentColor,
                0 0 10px currentColor,
                0 0 15px currentColor,
                0 0 20px var(--primary-gold);
            animation: neon-flicker calc(var(--animation-duration) * var(--animation-intensity)) infinite alternate;
        }

        @keyframes neon-flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: calc(0.8 * var(--glow-opacity)); }
        }

        /* Content zones for better hierarchy */
        .content-zone {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1rem 0;
            border: 1px solid rgba(255, 215, 0, 0.1);
        }

        .quiet-zone {
            background: rgba(0, 0, 0, 0.8);
            animation: none !important;
        }

        .quiet-zone * {
            animation: none !important;
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            :root {
                --animation-intensity: 0.5;
                --glow-opacity: 0.4;
            }

            .complex-animation {
                animation: none;
            }

            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                transform: none !important;
            }

            .main-content {
                margin-left: 0;
                padding: 1rem;
            }

            .login-box {
                padding: 2rem 1.5rem;
                margin: 1rem;
            }

            .stat-card {
                margin-bottom: 1rem;
            }

            .animation-controls {
                top: 5px;
                right: 5px;
                padding: 0.25rem;
            }

            /* Reduce animation intensity for performance */
            .stat-card::before,
            .stat-card::after,
            .login-box::before {
                animation-duration: 8s !important;
            }
        }

        /* Touch device optimizations */
        @media (hover: none) and (pointer: coarse) {
            .btn:hover {
                transform: none;
                transition: background-color 0.2s ease;
            }

            .stat-card:hover {
                transform: none;
            }
        }

        /* Large screen enhancements */
        @media (min-width: 1200px) {
            .login-box {
                width: 500px;
            }

            .sidebar {
                width: 300px;
            }

            .main-content {
                margin-left: 300px;
            }
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            :root {
                --text-secondary: #ffffff;
                --glow-opacity: 0.1;
            }

            .neon-text,
            .login-title h2,
            .stat-value {
                text-shadow: none;
            }
        }

        /* Slot machine style borders */
        .casino-border {
            border: 2px solid var(--primary-gold);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
        }

        .casino-border::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--neon-red), var(--neon-blue), var(--neon-green), var(--primary-gold));
            z-index: -1;
            border-radius: 15px;
            animation: casino-border-spin 3s linear infinite;
        }

        @keyframes casino-border-spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Login Section */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .login-box {
            background: linear-gradient(145deg, rgba(0, 0, 0, 0.9), rgba(26, 0, 0, 0.95));
            backdrop-filter: blur(20px);
            padding: 3rem;
            border-radius: 20px;
            border: 3px solid transparent;
            background-clip: padding-box;
            width: 420px;
            max-width: 90vw; /* Mobile responsive */
            box-shadow:
                0 20px 60px rgba(0, 0, 0, 0.7),
                inset 0 1px 0 rgba(255, 215, 0, 0.3),
                0 0 30px rgba(255, 215, 0, 0.2);
            position: relative;
            animation: casino-pulse calc(6s * var(--animation-intensity)) ease-in-out infinite;
            will-change: transform;
        }

        .login-box::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(45deg, var(--primary-gold), var(--neon-red), var(--neon-blue), var(--primary-gold));
            z-index: -1;
            border-radius: 20px;
            animation: casino-border-glow calc(4s * var(--animation-intensity)) linear infinite;
            opacity: var(--glow-opacity);
        }

        @keyframes casino-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(calc(1 + 0.02 * var(--animation-intensity))); }
        }

        @keyframes casino-border-glow {
            0%, 100% { filter: hue-rotate(0deg); }
            50% { filter: hue-rotate(calc(180deg * var(--animation-intensity))); }
        }

        .login-title {
            text-align: center;
            margin-bottom: 2rem;
        }

        .login-title h2 {
            color: var(--primary-gold);
            font-family: 'Orbitron', monospace;
            font-size: clamp(1.8rem, 5vw, 2.5rem); /* Responsive font size */
            font-weight: 900;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: clamp(1px, 0.5vw, 3px);
            text-shadow:
                0 0 5px var(--primary-gold),
                0 0 10px var(--primary-gold),
                0 0 20px var(--primary-gold),
                0 0 calc(40px * var(--glow-opacity));
            animation: casino-title-glow calc(4s * var(--animation-intensity)) ease-in-out infinite alternate;
        }

        @keyframes casino-title-glow {
            0% {
                text-shadow:
                    0 0 5px var(--primary-gold),
                    0 0 10px var(--primary-gold),
                    0 0 20px var(--primary-gold),
                    0 0 calc(40px * var(--glow-opacity));
            }
            100% {
                text-shadow:
                    0 0 calc(10px * var(--glow-opacity)),
                    0 0 calc(20px * var(--glow-opacity)),
                    0 0 calc(30px * var(--glow-opacity)),
                    0 0 calc(60px * var(--glow-opacity));
            }
        }

        .login-title p {
            color: var(--text-secondary);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .form-input {
            width: 100%;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-gold);
            background: rgba(255, 255, 255, 0.08);
        }

        /* Online Status Indicators */
        .online-indicator {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid #1a1a2e;
            z-index: 2;
        }

        .online-indicator.online {
            background: #4CAF50;
            box-shadow: 0 0 8px rgba(76, 175, 80, 0.6);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .online-indicator.offline {
            background: #f44336;
        }

        .online-indicator.away {
            background: #FF9800;
        }

        .last-seen {
            font-size: 0.75rem;
            color: #888;
            margin-top: 2px;
        }

        /* Profile Picture Styles */
        .profile-picture-section {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .profile-picture-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 2px solid rgba(255, 215, 0, 0.3);
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.05);
            position: relative;
        }

        .profile-picture-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-picture-placeholder {
            text-align: center;
            color: #666;
        }

        .profile-picture-actions {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .profile-picture-actions button {
            min-width: 140px;
        }

        .btn-login {
            width: 100%;
            padding: 1.2rem;
            background: linear-gradient(45deg, var(--primary-gold), var(--secondary-gold), var(--neon-red));
            color: var(--bg-dark);
            border: 2px solid transparent;
            border-radius: 15px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-login::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .btn-login:hover::before {
            left: 100%;
        }

        .btn-login:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow:
                0 15px 30px rgba(255, 215, 0, 0.4),
                0 0 20px rgba(255, 215, 0, 0.6);
            background: linear-gradient(45deg, var(--secondary-gold), var(--primary-gold), var(--neon-green));
        }

        .btn-login:active {
            transform: translateY(-1px) scale(1);
        }

        /* Toggle Buttons */
        .toggle-btn {
            flex: 1;
            padding: 0.8rem;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .toggle-btn:hover {
            color: var(--primary-gold);
            background: rgba(255, 215, 0, 0.1);
        }

        .toggle-btn.active {
            background: linear-gradient(45deg, var(--primary-gold), var(--secondary-gold));
            color: var(--bg-dark);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }

        /* Dashboard Layout */
        .dashboard-wrapper {
            display: none;
            min-height: 100vh;
            background: var(--bg-dark);
        }

        .dashboard-wrapper.active {
            display: flex;
        }

        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, rgba(26, 0, 0, 0.9) 0%, rgba(10, 0, 0, 0.95) 100%);
            border-right: 2px solid var(--primary-gold);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            height: 100vh;
            overflow-y: auto;
            flex-shrink: 0;
        }

        .sidebar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 215, 0, 0.05), transparent);
            pointer-events: none;
        }

        @keyframes casino-sidebar-glow {
            0% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .logo-section {
            padding: 2rem;
            border-bottom: 2px solid var(--primary-gold);
            text-align: center;
            background: rgba(255, 215, 0, 0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
        }

        .logo i {
            font-size: 2.5rem;
            color: var(--primary-gold);
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.3);
        }

        .logo-text {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary-gold), var(--secondary-gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.2);
        }


        .user-info-sidebar {
            padding: 1.5rem;
            background: rgba(255, 215, 0, 0.05);
            margin: 1rem;
            border-radius: 10px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary-gold), var(--secondary-gold));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--bg-dark);
            margin-bottom: 1rem;
            position: relative;
        }

        .nav-menu {
            padding: 1rem 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 1rem 1.5rem;
            color: var(--text-primary);
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            font-weight: 600;
            border-left: 4px solid transparent;
        }

        .nav-item::after {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border: 6px solid transparent;
            border-right-color: var(--primary-gold);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .nav-item:hover {
            background: rgba(255, 215, 0, 0.15);
            color: var(--primary-gold);
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
            border-left-color: var(--primary-gold);
            box-shadow: inset 0 0 20px rgba(255, 215, 0, 0.1);
        }

        .nav-item.active {
            background: rgba(255, 215, 0, 0.25);
            border-left-color: var(--primary-gold);
            color: var(--primary-gold);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
            box-shadow: inset 0 0 25px rgba(255, 215, 0, 0.15);
        }

        .nav-item.active::after {
            opacity: 1;
        }

        .nav-item i {
            font-size: 1.25rem;
            width: 30px;
            text-align: center;
            color: var(--primary-gold);
            text-shadow: 0 0 5px currentColor;
        }

        .nav-item span {
            margin-left: 1rem;
            font-weight: 600;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: linear-gradient(135deg, rgba(10, 0, 0, 0.95), rgba(26, 0, 0, 0.9));
            backdrop-filter: blur(5px);
            position: relative;
            min-height: 100vh;
        }

        .main-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 70% 30%, rgba(255, 215, 0, 0.03), transparent 50%);
            pointer-events: none;
        }

        .top-header {
            background: linear-gradient(135deg, rgba(26, 0, 0, 0.9), rgba(22, 33, 62, 0.8));
            backdrop-filter: blur(15px);
            border-bottom: 2px solid var(--primary-gold);
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 20px rgba(255, 215, 0, 0.2);
            position: relative;
            z-index: 10;
        }

        .top-header::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary-gold), transparent);
            animation: header-glow 3s ease-in-out infinite alternate;
        }

        @keyframes header-glow {
            0% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .header-left h1 {
            color: var(--primary-gold);
            margin-bottom: 0.5rem;
        }

        .header-stats {
            display: flex;
            gap: 2rem;
        }

        .stat-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .stat-badge i {
            color: var(--primary-gold);
        }

        .content-area {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            display: none;
        }

        .content-area.active {
            display: block;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(26, 0, 0, 0.9), rgba(10, 0, 0, 0.8));
            padding: 2rem;
            border-radius: 15px;
            border: 2px solid var(--primary-gold);
            background-clip: padding-box;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow:
                0 8px 32px rgba(255, 215, 0, 0.15),
                inset 0 1px 0 rgba(255, 215, 0, 0.2);
            backdrop-filter: blur(10px);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--primary-gold), transparent);
            z-index: -1;
            border-radius: 20px;
            opacity: 0.3;
        }

        .stat-card::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.05) 0%, transparent 70%);
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }


        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.15);
        }


        .stat-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-gold), var(--secondary-gold));
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px rgba(255, 215, 0, 0.2);
            position: relative;
            z-index: 1;
        }

        .stat-icon i {
            color: var(--bg-dark);
            font-size: 1.8rem;
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
        }

        .stat-label {
            color: var(--text-neon);
            font-family: 'Orbitron', monospace;
            font-size: 1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.8rem;
            text-shadow: 0 0 5px currentColor;
            position: relative;
            z-index: 1;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #FFD700;
        }


        /* Casino Headings */
        .casino-heading {
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--primary-gold);
            text-shadow:
                0 0 5px var(--primary-gold),
                0 0 10px var(--primary-gold),
                0 0 15px var(--primary-gold);
            margin-bottom: 1.5rem;
        }

        .casino-heading.h1 {
            font-size: 2.5rem;
            font-weight: 900;
        }

        .casino-heading.h2 {
            font-size: 2rem;
            font-weight: 700;
        }

        .casino-heading.h3 {
            font-size: 1.5rem;
            font-weight: 700;
        }

        /* Section Styles */
        .section {
            background: rgba(255, 255, 255, 0.02);
            padding: 2rem;
            border-radius: 15px;
            border: 1px solid rgba(255, 215, 0, 0.1);
            margin-bottom: 2rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .section-title {
            color: var(--primary-gold);
            font-size: 1.5rem;
        }

        /* Search Bar */
        .search-bar {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .search-bar input {
            flex: 1;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 10px;
            color: var(--text-primary);
        }

        .search-bar select {
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 10px;
            color: var(--text-primary);
        }

        /* User Cards */
        .user-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }

        .user-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 10px;
            border: 1px solid rgba(255, 215, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.3s ease;
        }

        .user-card:hover {
            background: rgba(255, 215, 0, 0.05);
        }

        .user-card-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-gold), var(--secondary-gold));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--bg-dark);
            position: relative;
        }

        .user-card-info {
            flex: 1;
        }

        .user-card-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .user-card-id {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        /* Chat Section */
        .chat-container {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 1.5rem;
            height: 600px;
        }

        .conversations-panel {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 15px;
            border: 1px solid rgba(255, 215, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .conversations-header {
            padding: 1rem 1.5rem;
            background: rgba(255, 215, 0, 0.05);
            border-bottom: 1px solid rgba(255, 215, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .conversations-list {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .conversation-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            margin-bottom: 0.5rem;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .conversation-item:hover {
            background: rgba(255, 215, 0, 0.05);
        }

        .conversation-item.active {
            background: rgba(255, 215, 0, 0.1);
            border-left: 3px solid var(--primary-gold);
        }

        .chat-panel {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 15px;
            border: 1px solid rgba(255, 215, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            padding: 1rem 1.5rem;
            background: rgba(255, 215, 0, 0.05);
            border-bottom: 1px solid rgba(255, 215, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .chat-header #chatAvatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-gold), var(--secondary-gold));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--bg-dark);
        }

        .messages-area {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 1.5rem;
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 215, 0, 0.3) transparent;
            scroll-behavior: smooth;
        }

        .messages-area::-webkit-scrollbar {
            width: 6px;
        }

        .messages-area::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .messages-area::-webkit-scrollbar-thumb {
            background: rgba(255, 215, 0, 0.3);
            border-radius: 3px;
            transition: background 0.3s ease;
        }

        .messages-area::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 215, 0, 0.5);
        }

        .message {
            display: flex;
            margin-bottom: 1rem;
            animation: fadeInMessage 0.3s ease-out;
            opacity: 0;
            animation-fill-mode: forwards;
        }

        .message.own {
            justify-content: flex-end;
        }

        .message-bubble {
            max-width: 70%;
            padding: 0.75rem 1rem;
            border-radius: 15px;
            background: rgba(255, 215, 0, 0.1);
            transition: all 0.2s ease;
            position: relative;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            word-wrap: break-word;
        }

        .message-bubble:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        @keyframes fadeInMessage {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.own .message-bubble {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 165, 0, 0.2));
        }

        .chat-input-area {
            padding: 1rem;
            background: rgba(255, 215, 0, 0.05);
            border-top: 1px solid rgba(255, 215, 0, 0.1);
            display: flex;
            gap: 0.5rem;
        }

        .chat-input {
            flex: 1;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 10px;
            color: var(--text-primary);
            outline: none;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .chat-input:focus {
            border-color: rgba(255, 215, 0, 0.5);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.1);
        }

        .chat-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        /* Buttons */
        .btn {
            padding: 0.9rem 2rem;
            border-radius: 15px;
            border: 2px solid transparent;
            cursor: pointer;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
            background-clip: padding-box;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s ease;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-gold), var(--secondary-gold), var(--neon-red));
            color: var(--bg-dark);
            box-shadow:
                0 6px 20px rgba(255, 215, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .btn-primary::after {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--primary-gold), var(--neon-red), var(--neon-blue), var(--primary-gold));
            z-index: -1;
            border-radius: 15px;
            animation: btn-border-glow 2s linear infinite;
        }

        @keyframes btn-border-glow {
            0%, 100% { filter: hue-rotate(0deg); }
            50% { filter: hue-rotate(90deg); }
        }

        .btn-primary:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow:
                0 10px 25px rgba(255, 215, 0, 0.5),
                0 0 30px rgba(255, 215, 0, 0.3);
            background: linear-gradient(135deg, var(--secondary-gold), var(--primary-gold), var(--neon-green));
        }

        .btn-primary:active {
            transform: translateY(-2px) scale(1.02);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .btn-icon:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.2);
        }

        .btn-icon:active {
            transform: scale(0.95);
        }

        .btn-icon::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn-icon:hover::before {
            left: 100%;
        }

        /* Settings */
        .settings-grid {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 2rem;
        }

        .settings-nav {
            background: rgba(255, 255, 255, 0.02);
            padding: 1.5rem;
            border-radius: 15px;
            border: 1px solid rgba(255, 215, 0, 0.1);
        }

        .settings-nav-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .settings-nav-item:hover {
            background: rgba(255, 215, 0, 0.05);
        }

        .settings-nav-item.active {
            background: rgba(255, 215, 0, 0.1);
            color: var(--primary-gold);
        }

        .settings-content {
            background: rgba(255, 255, 255, 0.02);
            padding: 2rem;
            border-radius: 15px;
            border: 1px solid rgba(255, 215, 0, 0.1);
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            background: var(--bg-darker);
            border: 1px solid rgba(255, 215, 0, 0.3);
            color: var(--text-primary);
            display: none;
            z-index: 1000;
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification.success {
            border-color: var(--success);
        }

        .notification.error {
            border-color: var(--danger);
        }

        /* Reviews */
        .review-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
        }

        .tab-btn {
            padding: 1rem 2rem;
            background: none;
            border: none;
            color: #b8b8b8;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            color: #FFD700;
            border-bottom-color: #FFD700;
        }

        .tab-btn:hover {
            color: #FFD700;
        }

        .reviews-list {
            display: grid;
            gap: 1rem;
        }

        .review-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 10px;
            border: 1px solid rgba(255, 215, 0, 0.1);
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .review-user {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .review-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #1a1a2e;
        }

        .review-info h4 {
            margin: 0;
            color: #FFD700;
        }

        .review-date {
            color: #b8b8b8;
            font-size: 0.85rem;
        }

        .review-rating {
            display: flex;
            gap: 0.25rem;
        }

        .star {
            color: #FFD700;
            font-size: 1.2rem;
        }

        .star.empty {
            color: #333;
        }

        .review-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #FFD700;
            margin: 1rem 0 0.5rem;
        }

        .review-comment {
            color: #e0e0e0;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .review-actions {
            display: flex;
            gap: 0.5rem;
        }

        .review-actions button {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .btn-edit {
            background: rgba(33, 150, 243, 0.2);
            color: #2196f3;
        }

        .btn-delete {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
        }

        .btn-review {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #1a1a2e;
            font-weight: 600;
        }

        .reviewable-client-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 10px;
            border: 1px solid rgba(255, 215, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .client-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .client-details {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            color: #FFD700;
            margin-bottom: 0.25rem;
        }

        .user-id {
            color: #b8b8b8;
            font-size: 0.85rem;
            margin-bottom: 0.25rem;
        }

        .user-stats {
            color: #888;
            font-size: 0.8rem;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: #1a1a2e;
            border: 1px solid #FFD700;
            border-radius: 15px;
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            color: #FFD700;
            font-size: 1.5rem;
        }

        .close-btn {
            background: none;
            border: none;
            color: #b8b8b8;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .rating-input {
            display: flex;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .rating-star {
            font-size: 2rem;
            color: #333;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .rating-star.active,
        .rating-star:hover {
            color: #FFD700;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #b8b8b8;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #b8b8b8;
            font-style: italic;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .sidebar {
                width: 70px;
            }

            .sidebar-header,
            .user-info-sidebar,
            .nav-item span {
                display: none;
            }

            .main-content {
                margin-left: 70px;
            }
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .chat-container {
                grid-template-columns: 1fr;
                height: auto;
            }

            .conversations-panel {
                height: 200px;
            }
        }
        /* Promotions Styles */
        .promotions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .credentials-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .credential-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .credential-card:hover {
            border-color: var(--primary-gold);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.2);
            transform: translateY(-2px);
        }

        .credential-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .credential-icon {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            background: rgba(255, 215, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-gold);
            font-size: 1.5rem;
        }

        .credential-title {
            color: var(--primary-gold);
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0;
        }

        .credential-info {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .credential-field {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
        }

        .credential-label {
            color: var(--text-secondary);
            font-size: 0.85rem;
            font-weight: 500;
        }

        .credential-value {
            color: var(--text-primary);
            font-family: monospace;
            font-size: 0.9rem;
            cursor: pointer;
            position: relative;
        }

        .credential-value:hover {
            color: var(--primary-gold);
        }

        .copy-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.25rem;
            margin-left: 0.5rem;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .copy-btn:hover {
            color: var(--primary-gold);
            background: rgba(255, 215, 0, 0.1);
        }

        .credential-date {
            color: var(--text-secondary);
            font-size: 0.8rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Client Credentials in Messages */
        .client-credentials-content {
            display: block;
            transition: all 0.3s ease;
            max-height: 300px;
            overflow-y: auto;
            overflow-x: hidden;
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 215, 0, 0.3) transparent;
        }

        .client-credentials-content::-webkit-scrollbar {
            width: 4px;
        }

        .client-credentials-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 2px;
        }

        .client-credentials-content::-webkit-scrollbar-thumb {
            background: rgba(255, 215, 0, 0.3);
            border-radius: 2px;
        }

        .client-credentials-content.collapsed {
            display: none;
        }

        .client-credential-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 8px;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
            animation: fadeInUp 0.3s ease-out;
            position: relative;
            overflow: hidden;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .client-credential-item:hover {
            border-color: var(--primary-gold);
            background: rgba(255, 215, 0, 0.1);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.1);
        }

        .client-credential-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.1), transparent);
            transition: left 0.5s;
        }

        .client-credential-item:hover::before {
            left: 100%;
        }

        .client-credential-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .client-credential-game-icon {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            background: rgba(255, 215, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-gold);
            font-size: 1rem;
        }

        .client-credential-game-name {
            color: var(--primary-gold);
            font-weight: 600;
            margin: 0;
        }

        .client-credential-fields {
            display: grid;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .client-credential-field {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.4rem 0.5rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .client-credential-field-label {
            color: var(--text-secondary);
            font-size: 0.8rem;
            font-weight: 500;
        }

        .client-credential-field-value {
            color: var(--text-primary);
            font-family: monospace;
            font-size: 0.85rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .client-credential-field-value:hover {
            color: var(--primary-gold);
        }

        .client-credential-copy-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.2rem;
            border-radius: 3px;
            font-size: 0.75rem;
            transition: all 0.2s;
        }

        .client-credential-copy-btn:hover {
            color: var(--primary-gold);
            background: rgba(255, 215, 0, 0.1);
        }

        .client-credentials-empty {
            text-align: center;
            padding: 1rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .promotion-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .promotion-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.15);
            border-color: var(--primary);
        }

        .promotion-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .promotion-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary);
        }

        .promotion-type {
            background: rgba(255, 215, 0, 0.15);
            color: var(--primary);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            text-transform: uppercase;
        }

        .promotion-client {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            padding: 0.5rem;
            background: rgba(255, 215, 0, 0.05);
            border-radius: var(--radius);
        }

        .promotion-client-avatar {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--dark);
        }

        .promotion-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin: 1rem 0;
            text-align: center;
        }

        .promotion-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
            margin: 1rem 0;
            padding: 1rem 0;
            border-top: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
        }

        .promotion-detail {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .promotion-detail i {
            color: var(--primary);
            width: 20px;
        }

        .promotion-countdown {
            text-align: center;
            padding: 0.5rem;
            background: rgba(255, 215, 0, 0.05);
            border-radius: var(--radius);
            margin: 1rem 0;
        }

        .claim-button {
            width: 100%;
            padding: 0.75rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--dark);
            border: none;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .claim-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
        }

        .claim-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .claimed-badge {
            background: var(--success);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            text-align: center;
            font-weight: 600;
        }

        .pending-badge {
            background: var(--info);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            text-align: center;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .wallet-modal {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 2rem;
            max-width: 600px;
            margin: auto;
        }

        .wallet-balance {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .balance-card {
            text-align: center;
            padding: 1rem;
            background: rgba(255, 215, 0, 0.05);
            border-radius: var(--radius);
        }

        .balance-label {
            color: var(--text-light);
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        .balance-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        /* Report Card Styling */
        .report-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            padding: 1.25rem;
            margin-bottom: 1rem;
        }

        .report-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .report-status {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .report-status.pending {
            background: #FFA500;
            color: #000;
        }

        .report-status.reviewed {
            background: #2196F3;
            color: #fff;
        }

        .report-status.resolved {
            background: #4CAF50;
            color: #fff;
        }

        .report-status.dismissed {
            background: #757575;
            color: #fff;
        }

        .report-reason {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 1rem 0;
            color: var(--text-primary);
        }

        .report-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .report-actions button {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            border: none;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }

        .edit-report-btn {
            background: var(--accent-color);
            color: var(--text-primary);
        }

        .delete-report-btn {
            background: #dc3545;
            color: #fff;
        }

        .report-actions button:hover {
            opacity: 0.8;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>


    <!-- Login Section -->
    <div class="login-container" id="loginSection">
        <div class="notification" id="loginNotification" style="position: fixed; top: 20px; right: 20px; padding: 15px 20px; border-radius: 8px; display: none; z-index: 9999; max-width: 400px;"></div>
        <div class="login-box">
            <div class="login-title">
                <div>
                    <i class="fas fa-gamepad" style="font-size: 3rem; color: var(--primary-gold); margin-bottom: 1rem;"></i>
                    <h2>Player Portal</h2>
                    <p id="welcomeMessage">Welcome back, champion!</p>
                </div>
            </div>

            <!-- Toggle Buttons -->
            <div class="auth-toggle" style="display: flex; margin-bottom: 2rem; border-radius: 10px; background: rgba(0,0,0,0.3); padding: 5px;">
                <button type="button" class="toggle-btn active" onclick="showLogin()" id="loginToggle">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
                <button type="button" class="toggle-btn" onclick="showRegister()" id="registerToggle">
                    <i class="fas fa-user-plus"></i> Register
                </button>
            </div>

            <!-- Login Form -->
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" class="form-input" id="username" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="password" required>
                </div>
                <button type="submit" class="btn-login">
                    <i class="fas fa-sign-in-alt"></i> Login to Play
                </button>
            </form>

            <!-- Registration Form -->
            <form id="registerForm" onsubmit="handleRegister(event)" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" class="form-input" id="regFullName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="regEmail" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" class="form-input" id="regUsername" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="regPassword" required minlength="6">
                </div>
                <div class="form-group">
                    <label class="form-label">Confirm Password</label>
                    <input type="password" class="form-input" id="regConfirmPassword" required minlength="6">
                </div>
                <button type="submit" class="btn-login">
                    <i class="fas fa-user-plus"></i> Create Account
                </button>
            </form>
        </div>
    </div>

    <!-- Dashboard Section -->
    <div class="dashboard-wrapper" id="dashboardSection">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-dice"></i>
                    <span>Casino Royale</span>
                </div>
            </div>

            <div class="user-info-sidebar">
                <div class="user-avatar" id="sidebarAvatar">P</div>
                <div style="color: var(--text-primary); font-weight: 600;" id="sidebarName">Player</div>
                <div style="color: var(--text-secondary); font-size: 0.85rem;" id="sidebarId">ID: -</div>
            </div>

            <nav class="nav-menu">
                <a href="#" class="nav-item active" data-section="home">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </a>
                <a href="#" class="nav-item" data-section="clients">
                    <i class="fas fa-building"></i>
                    <span>Clients</span>
                </a>
                <a href="#" class="nav-item" data-section="friends">
                    <i class="fas fa-user-friends"></i>
                    <span>Friends</span>
                </a>
                <a href="#" class="nav-item" data-section="messages">
                    <i class="fas fa-comments"></i>
                    <span>Messages</span>
                    <span class="badge" id="messagesBadge" style="display: none; background: var(--danger); color: white; padding: 2px 6px; border-radius: 10px; margin-left: auto;">0</span>
                </a>
                <a href="#" class="nav-item" data-section="promotions">
                    <i class="fas fa-gift"></i>
                    <span>Promotions</span>
                    <span class="badge" id="promotionsBadge" style="display: none; background: var(--primary); color: white; padding: 2px 6px; border-radius: 10px; margin-left: auto;">0</span>
                </a>
                <a href="#" class="nav-item" data-section="reviews">
                    <i class="fas fa-star"></i>
                    <span>Reviews</span>
                </a>
                <a href="#" class="nav-item" data-section="reports">
                    <i class="fas fa-flag"></i>
                    <span>Reports</span>
                </a>
                <a href="#" class="nav-item" data-section="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
                <a href="#" class="nav-item" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="main-content">
            <div class="top-header">
                <div class="header-left">
                    <h1>Welcome Back, <span id="headerName">Player</span>!</h1>
                    <p style="color: var(--text-secondary);">Ready to win big today?</p>
                </div>
                <div class="header-stats">
                    <div class="stat-badge">
                        <i class="fas fa-star"></i>
                        <span>Level <strong id="headerLevel">1</strong></span>
                    </div>
                    <div class="stat-badge">
                        <i class="fas fa-id-badge"></i>
                        <span>ID: <strong id="headerId">-</strong></span>
                    </div>
                </div>
            </div>

            <!-- Home Section -->
            <div class="content-area active" id="home-section">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">Welcome to Casino Royale</h2>
                    </div>
                    <p style="color: var(--text-secondary); margin-bottom: 2rem;">Test your luck with our practice games before playing for real!</p>

                    <!-- Casino Games Grid -->
                    <div class="casino-games-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 2rem; margin-bottom: 3rem;">

                        <!-- Dice Roll Game -->
                        <div class="game-card" style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 215, 0, 0.05)); border: 2px solid var(--primary-gold); border-radius: 15px; padding: 2rem;">
                            <h3 style="color: var(--primary-gold); margin-bottom: 1.5rem;">
                                <i class="fas fa-dice"></i> Lucky Dice
                            </h3>
                            <div id="diceGame">
                                <div style="text-align: center; margin-bottom: 1.5rem;">
                                    <div id="diceDisplay" style="font-size: 4rem; margin: 1rem 0;">ðŸŽ²ðŸŽ²</div>
                                    <div id="diceResult" style="font-size: 1.5rem; color: var(--primary-gold); margin: 1rem 0;">Roll the dice!</div>
                                </div>
                                <div style="margin-bottom: 1rem;">
                                    <label style="color: var(--text-secondary);">Your Bet (1-12):</label>
                                    <input type="number" id="diceBet" min="1" max="12" value="7" style="width: 100%; padding: 0.5rem; margin-top: 0.5rem; background: rgba(255, 255, 255, 0.05); border: 1px solid var(--primary-gold); border-radius: 5px; color: white;">
                                </div>
                                <button class="btn btn-primary" onclick="rollDice()" id="rollButton" style="width: 100%;">
                                    <i class="fas fa-dice-roll"></i> Roll Dice
                                </button>
                                <div style="margin-top: 1rem; text-align: center;">
                                    <span style="color: var(--text-secondary);">Win Streak: </span>
                                    <span id="diceStreak" style="color: var(--primary-gold); font-weight: bold;">0</span>
                                </div>
                            </div>
                        </div>

                        <!-- Slot Machine Game -->
                        <div class="game-card" style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 215, 0, 0.05)); border: 2px solid var(--primary-gold); border-radius: 15px; padding: 2rem;">
                            <h3 style="color: var(--primary-gold); margin-bottom: 1.5rem;">
                                <i class="fas fa-coins"></i> Lucky Slots
                            </h3>
                            <div id="slotMachine">
                                <div style="background: rgba(0, 0, 0, 0.3); border-radius: 10px; padding: 1.5rem; margin-bottom: 1.5rem;">
                                    <div id="slotDisplay" style="display: flex; justify-content: center; gap: 1rem; font-size: 3rem; margin-bottom: 1rem;">
                                        <div class="slot-reel" id="reel1" style="background: rgba(255, 215, 0, 0.1); padding: 0.5rem 1rem; border-radius: 10px; border: 2px solid var(--primary-gold);">7ï¸âƒ£</div>
                                        <div class="slot-reel" id="reel2" style="background: rgba(255, 215, 0, 0.1); padding: 0.5rem 1rem; border-radius: 10px; border: 2px solid var(--primary-gold);">7ï¸âƒ£</div>
                                        <div class="slot-reel" id="reel3" style="background: rgba(255, 215, 0, 0.1); padding: 0.5rem 1rem; border-radius: 10px; border: 2px solid var(--primary-gold);">7ï¸âƒ£</div>
                                    </div>
                                    <div id="slotResult" style="text-align: center; color: var(--primary-gold); font-size: 1.2rem; min-height: 30px;">Pull the lever to play!</div>
                                </div>
                                <button class="btn btn-primary" onclick="spinSlots()" id="spinButton" style="width: 100%;">
                                    <i class="fas fa-play-circle"></i> Spin Slots
                                </button>
                                <div style="margin-top: 1rem; display: flex; justify-content: space-around;">
                                    <div style="text-align: center;">
                                        <span style="color: var(--text-secondary);">Wins: </span>
                                        <span id="slotWins" style="color: #4CAF50; font-weight: bold;">0</span>
                                    </div>
                                    <div style="text-align: center;">
                                        <span style="color: var(--text-secondary);">Losses: </span>
                                        <span id="slotLosses" style="color: #f44336; font-weight: bold;">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Card Memory Game -->
                        <div class="game-card" style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 215, 0, 0.05)); border: 2px solid var(--primary-gold); border-radius: 15px; padding: 2rem;">
                            <h3 style="color: var(--primary-gold); margin-bottom: 1.5rem;">
                                <i class="fas fa-brain"></i> Card Memory Match
                            </h3>
                            <div id="memoryGame">
                                <div id="gameBoard" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.5rem; margin-bottom: 1rem; min-height: 300px;">
                                    <!-- Cards will be generated here -->
                                </div>
                                <div id="memoryResult" style="text-align: center; color: var(--primary-gold); font-size: 1.2rem; min-height: 30px; margin-bottom: 1rem;">Find all matching pairs!</div>
                                <button class="btn btn-primary" onclick="startMemoryGame()" id="memoryStartButton" style="width: 100%;">
                                    <i class="fas fa-redo"></i> New Game
                                </button>
                                <div style="margin-top: 1rem; display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                                    <div style="text-align: center; padding: 0.5rem; background: rgba(255, 215, 0, 0.05); border-radius: 5px;">
                                        <span style="color: var(--text-secondary); font-size: 0.9rem;">Moves:</span><br>
                                        <span id="moveCount" style="color: var(--primary-gold); font-weight: bold;">0</span>
                                    </div>
                                    <div style="text-align: center; padding: 0.5rem; background: rgba(255, 215, 0, 0.05); border-radius: 5px;">
                                        <span style="color: var(--text-secondary); font-size: 0.9rem;">Pairs:</span><br>
                                        <span id="pairsFound" style="color: #4CAF50; font-weight: bold;">0/8</span>
                                    </div>
                                    <div style="text-align: center; padding: 0.5rem; background: rgba(255, 215, 0, 0.05); border-radius: 5px;">
                                        <span style="color: var(--text-secondary); font-size: 0.9rem;">Time:</span><br>
                                        <span id="gameTimer" style="color: var(--primary-gold); font-weight: bold;">0:00</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Stats -->
                    <div class="dashboard-grid" style="margin-top: 2rem;">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-user-friends"></i>
                            </div>
                            <div class="stat-label">Friends</div>
                            <div class="stat-value" id="homeTotalFriends">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-comments"></i>
                            </div>
                            <div class="stat-label">Messages</div>
                            <div class="stat-value" id="homeTotalMessages">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-gift"></i>
                            </div>
                            <div class="stat-label">Promotions</div>
                            <div class="stat-value" id="homeActivePromos">0</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Clients Section -->
            <div class="content-area" id="clients-section">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">My Client Friends</h2>
                    </div>
                    <div class="user-grid" id="clientsList"></div>
                </div>
            </div>

            <!-- Friends Section -->
            <div class="content-area" id="friends-section">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">Search Users</h2>
                    </div>
                    <div class="search-bar">
                        <input type="text" id="searchInput" placeholder="Search by username or ID...">
                        <select id="userTypeFilter">
                            <option value="">All Users</option>
                            <option value="client">Clients Only</option>
                            <option value="player">Players Only</option>
                        </select>
                        <button class="btn btn-primary" onclick="searchUsers()">Search</button>
                    </div>
                    <div class="user-grid" id="searchResults"></div>
                </div>

                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">Friend Requests</h2>
                    </div>
                    <div class="user-grid" id="friendRequests"></div>
                </div>

                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">My Friends</h2>
                    </div>
                    <div class="user-grid" id="friendsList"></div>
                </div>
            </div>

            <!-- Messages Section -->
            <div class="content-area" id="messages-section">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">Messages</h2>
                    </div>
                    <div class="chat-container">
                        <div class="conversations-panel">
                            <div class="conversations-header">
                                <h3 style="color: var(--primary-gold);">Conversations</h3>
                                <button class="btn-icon btn-primary" onclick="loadConversations()">
                                    <i class="fas fa-sync"></i>
                                </button>
                            </div>
                            <div class="conversations-list" id="conversationsList"></div>
                        </div>
                        <div class="chat-panel">
                            <div id="emptyChatState" style="display: flex; justify-content: center; align-items: center; height: 100%; color: var(--text-secondary);">
                                <div style="text-align: center;">
                                    <i class="fas fa-comments" style="font-size: 3rem; margin-bottom: 1rem; color: var(--primary-gold);"></i>
                                    <h3>Select a conversation</h3>
                                    <p>Choose a friend to start chatting</p>
                                </div>
                            </div>
                            <div id="activeChatArea" style="display: none; height: 100%; display: flex; flex-direction: column;">
                                <div class="chat-header">
                                    <div class="user-card-avatar" style="position: relative;" id="chatAvatarContainer">
                                        <div id="chatAvatar">U</div>
                                        <div class="online-indicator offline" id="chatOnlineIndicator"></div>
                                    </div>
                                    <div>
                                        <div style="font-weight: 600;" id="chatUserName">User Name</div>
                                        <div id="typingIndicator" style="font-size: 0.85rem; color: var(--neon-blue); display: none;">
                                            <i class="fas fa-ellipsis-h"></i> typing...
                                        </div>
                                        <div style="color: var(--text-secondary); font-size: 0.85rem;" id="chatStatus">Online</div>
                                    </div>
                                </div>

                                <!-- Client Credentials Section (only shown when chatting with clients) -->
                                <div id="clientCredentialsSection" style="display: none; border-bottom: 2px solid var(--primary-gold); background: linear-gradient(135deg, rgba(255, 215, 0, 0.05), rgba(255, 215, 0, 0.02));">
                                    <div style="padding: 0.5rem 0.75rem; cursor: pointer; display: flex; align-items: center; justify-content: space-between;" onclick="toggleClientCredentials()">
                                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                                            <i class="fas fa-key" style="color: var(--primary-gold); font-size: 0.875rem;"></i>
                                            <span style="color: var(--primary-gold); font-size: 0.875rem; font-weight: 600;">
                                                Game Credentials (<span id="credentialsCount">0</span> available)
                                            </span>
                                        </div>
                                        <button class="btn-icon" style="background: none; border: none; color: var(--primary-gold); padding: 0;" id="credentialsToggle">
                                            <i class="fas fa-chevron-down" style="font-size: 0.75rem; transition: transform 0.3s;"></i>
                                        </button>
                                    </div>
                                    <div id="clientCredentialsList" class="client-credentials-content" style="display: none; padding: 0.5rem; max-height: 200px; overflow-y: auto; border-top: 1px solid rgba(255, 215, 0, 0.1);">
                                        <!-- Credentials will be loaded here (collapsed by default) -->
                                    </div>
                                </div>

                                <div class="messages-area" id="messagesContainer"></div>
                                <div class="chat-input-area">
                                    <button class="btn-icon btn-secondary" onclick="document.getElementById('imageInput').click()">
                                        <i class="fas fa-image"></i>
                                    </button>
                                    <button class="btn-icon btn-secondary" onclick="startVoiceRecording()">
                                        <i class="fas fa-microphone"></i>
                                    </button>
                                    <input type="text" class="chat-input" id="messageInput" placeholder="Type a message..." onkeypress="handleMessageKeyPress(event)" oninput="handleTyping()" onblur="clearTimeout(typingTimeout); isCurrentlyTyping = false; sendTypingIndicator(false)">
                                    <button class="btn btn-primary" onclick="sendChatMessage()">Send</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Promotions Section -->
            <div class="content-area" id="promotions-section">
                <div class="section">
                    <div class="section-header">
                        <h3 class="section-title">Available Promotions</h3>
                        <div style="display: flex; gap: 1rem;">
                            <button class="btn-secondary" onclick="showMyClaimsModal()">
                                <i class="fas fa-history"></i> My Claims
                            </button>
                            <button class="btn-secondary" onclick="showWalletModal()">
                                <i class="fas fa-wallet"></i> My Wallet
                            </button>
                        </div>
                    </div>

                    <!-- Promotions Filter Tabs -->
                    <div class="tabs" style="margin: 1.5rem 0;">
                        <button class="tab-btn active" onclick="switchPromotionTab('all')">All Promotions</button>
                        <button class="tab-btn" onclick="switchPromotionTab('eligible')">Eligible</button>
                        <button class="tab-btn" onclick="switchPromotionTab('claimed')">Claimed</button>
                    </div>

                    <!-- Promotions Grid -->
                    <div id="promotionsList" class="promotions-grid">
                        <!-- Promotions will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Reports Section -->
            <div class="content-area" id="reports-section">
                <div class="section">
                    <div class="section-header">
                        <h3 class="section-title">Reports Management</h3>
                    </div>

                    <div class="dashboard-grid" style="margin-bottom: 2rem;">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-paper-plane"></i>
                            </div>
                            <div class="stat-label">Reports Made</div>
                            <div class="stat-value" id="reportsMadeCount">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-inbox"></i>
                            </div>
                            <div class="stat-label">Reports Received</div>
                            <div class="stat-value" id="reportsReceivedCount">0</div>
                        </div>
                    </div>

                    <!-- Reports Tabs -->
                    <div class="tabs" style="margin: 2rem 0;">
                        <button class="report-tab-btn active" onclick="switchReportTab('made')">Reports I Made</button>
                        <button class="report-tab-btn" onclick="switchReportTab('received')">Reports About Me</button>
                    </div>

                    <!-- Reports Made List -->
                    <div id="reportsMadeList" class="reports-list">
                        <!-- Reports will be loaded here -->
                    </div>

                    <!-- Reports Received List -->
                    <div id="reportsReceivedList" class="reports-list" style="display: none;">
                        <!-- Reports will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Reviews Section -->
            <div class="content-area" id="reviews-section">
                <div class="section">
                    <div class="section-header">
                        <h3 class="section-title">Client Reviews</h3>
                        <button class="btn-primary" onclick="showWriteReviewModal()">
                            <i class="fas fa-star"></i> Write Review
                        </button>
                    </div>

                    <!-- Review Stats -->
                    <div class="dashboard-grid" style="margin-bottom: 2rem;">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="stat-label">Reviews Given</div>
                            <div class="stat-value" id="reviewsGiven">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-star-half-alt"></i>
                            </div>
                            <div class="stat-label">Average Rating Given</div>
                            <div class="stat-value" id="avgRatingGiven">0.0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-medal"></i>
                            </div>
                            <div class="stat-label">Reviews Received</div>
                            <div class="stat-value" id="reviewsReceived">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div class="stat-label">My Rating</div>
                            <div class="stat-value" id="myRating">0.0</div>
                        </div>
                    </div>

                    <!-- Review Tabs -->
                    <div class="review-tabs">
                        <button class="tab-btn active" onclick="switchReviewTab('given')">Reviews I've Given</button>
                        <button class="tab-btn" onclick="switchReviewTab('received')">Reviews I've Received</button>
                        <button class="tab-btn" onclick="switchReviewTab('clients')">Review Clients</button>
                    </div>

                    <!-- Reviews Content -->
                    <div id="reviewsContent" class="reviews-list"></div>
                </div>
            </div>

            <!-- Settings Section -->
            <div class="content-area" id="settings-section">
                <div class="settings-grid">
                    <div class="settings-nav">
                        <div class="settings-nav-item active">
                            <i class="fas fa-user"></i>
                            <span>Profile</span>
                        </div>
                        <div class="settings-nav-item">
                            <i class="fas fa-lock"></i>
                            <span>Security</span>
                        </div>
                        <div class="settings-nav-item">
                            <i class="fas fa-bell"></i>
                            <span>Notifications</span>
                        </div>
                        <div class="settings-nav-item">
                            <i class="fas fa-palette"></i>
                            <span>Appearance</span>
                        </div>
                    </div>
                    <div class="settings-content">
                        <h3 style="margin-bottom: 1.5rem; color: var(--primary-gold);">Profile Settings</h3>
                        <div class="form-group">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-input" id="settingsName" />
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-input" id="settingsEmail" />
                        </div>
                        <div class="form-group">
                            <label class="form-label">Player Level</label>
                            <input type="text" class="form-input" id="settingsLevel" disabled />
                        </div>

                        <!-- Profile Picture Section -->
                        <div class="form-group">
                            <label class="form-label">Profile Picture</label>
                            <div class="profile-picture-section">
                                <div class="profile-picture-preview" id="profilePicturePreview">
                                    <img id="profilePictureImage" src="" alt="Profile" style="display: none;" />
                                    <div class="profile-picture-placeholder" id="profilePicturePlaceholder">
                                        <i class="fas fa-user" style="font-size: 3rem; color: #666;"></i>
                                        <p style="margin: 0.5rem 0 0 0; color: #666;">No profile picture</p>
                                    </div>
                                </div>
                                <div class="profile-picture-actions">
                                    <input type="file" id="profilePictureInput" accept="image/*" style="display: none;" />
                                    <button type="button" class="btn btn-secondary" onclick="selectProfilePicture()">
                                        <i class="fas fa-upload"></i> Upload Picture
                                    </button>
                                    <button type="button" class="btn btn-danger" id="deleteProfilePictureBtn" onclick="deleteProfilePicture()" style="display: none;">
                                        <i class="fas fa-trash"></i> Remove
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Email Verification Section -->
                        <div class="form-group" style="border-top: 1px solid rgba(255,215,0,0.2); padding-top: 1.5rem; margin-top: 1.5rem;">
                            <label class="form-label">Email Verification</label>
                            <div id="emailVerificationSection">
                                <!-- This will be populated by JavaScript -->
                            </div>
                        </div>

                        <button class="btn btn-primary">Save Profile</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden file input -->
    <input type="file" id="imageInput" accept="image/*" style="display: none;" onchange="handleImageSelect(event)">

    <!-- Notification -->
    <!-- Profile Modal -->
    <div class="modal-overlay" id="profileModal">
        <div class="modal" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h3 class="modal-title" id="profileModalTitle">User Profile</h3>
                <button class="close-btn" onclick="closeProfileModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Profile Header -->
                <div id="profileHeader" style="display: flex; align-items: center; gap: 2rem; padding: 1.5rem; background: rgba(255,215,0,0.1); border-radius: 10px; margin-bottom: 1.5rem;">
                    <div style="width: 80px; height: 80px; background: var(--primary-gold); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; color: var(--bg-dark); font-weight: bold;" id="profileAvatar"></div>
                    <div style="flex: 1;">
                        <h2 id="profileName" style="margin-bottom: 0.5rem;"></h2>
                        <div id="profileInfo" style="color: var(--text-secondary);"></div>
                    </div>
                </div>

                <!-- Profile Stats -->
                <div id="profileStats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                    <!-- Stats will be populated dynamically -->
                </div>

                <!-- Payment Methods (for clients only) -->
                <div id="profilePaymentMethods" style="display: none; margin-bottom: 1.5rem;">
                    <h4 style="color: var(--primary-gold); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-credit-card"></i> Accepted Payment Methods
                    </h4>
                    <div id="profilePaymentMethodsList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 1rem;">
                        <!-- Payment methods will be populated dynamically -->
                    </div>
                </div>

                <!-- Available Games (for clients only) -->
                <div id="profileGames" style="display: none; margin-bottom: 1.5rem;">
                    <h4 style="color: var(--primary-gold); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-gamepad"></i> Available Games
                    </h4>
                    <div id="profileGamesList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 0.75rem; max-height: 300px; overflow-y: auto;">
                        <!-- Games will be populated dynamically -->
                    </div>
                </div>

                <!-- Tabs -->
                <div class="profile-tabs" style="display: flex; gap: 1rem; margin-bottom: 1.5rem; border-bottom: 1px solid rgba(255,215,0,0.2);">
                    <button class="profile-tab active" onclick="switchProfileTab('reviews')" data-tab="reviews" style="background: none; border: none; color: var(--text-primary); padding: 1rem; cursor: pointer; position: relative;">Reviews</button>
                    <button class="profile-tab" onclick="switchProfileTab('reports')" data-tab="reports" style="background: none; border: none; color: var(--text-secondary); padding: 1rem; cursor: pointer;">Reports</button>
                </div>

                <!-- Tab Content -->
                <div id="profileTabContent">
                    <!-- Reviews Tab -->
                    <div id="profileReviewsTab" class="profile-tab-content">
                        <div id="profileReviews">
                            <p style="color: var(--text-secondary);">Loading reviews...</p>
                        </div>
                    </div>

                    <!-- Reports Tab -->
                    <div id="profileReportsTab" class="profile-tab-content" style="display: none;">
                        <div id="profileReports">
                            <!-- Create/Edit Report Section -->
                            <div id="reportActionSection" style="display: none;">
                                <h4 style="color: var(--accent-color); margin-bottom: 1rem;">Report User</h4>
                                <form id="reportForm">
                                    <div class="form-group" style="margin-bottom: 1rem;">
                                        <label style="color: var(--text-primary); margin-bottom: 0.5rem; display: block;">Reason for Report:</label>
                                        <textarea id="reportReason" style="
                                            width: 100%;
                                            padding: 0.75rem;
                                            border: 1px solid var(--border-color);
                                            border-radius: 0.5rem;
                                            background: var(--bg-primary);
                                            color: var(--text-primary);
                                            resize: vertical;
                                            min-height: 100px;
                                            font-family: inherit;
                                        " placeholder="Please describe the reason for reporting this user..." required></textarea>
                                    </div>
                                    <div style="display: flex; gap: 1rem;">
                                        <button type="submit" id="submitReportBtn" style="
                                            background: var(--accent-color);
                                            color: var(--text-primary);
                                            border: none;
                                            padding: 0.75rem 1.5rem;
                                            border-radius: 0.5rem;
                                            cursor: pointer;
                                            transition: all 0.3s ease;
                                        ">Submit Report</button>
                                        <button type="button" onclick="cancelReportAction()" style="
                                            background: var(--bg-secondary);
                                            color: var(--text-secondary);
                                            border: 1px solid var(--border-color);
                                            padding: 0.75rem 1.5rem;
                                            border-radius: 0.5rem;
                                            cursor: pointer;
                                            transition: all 0.3s ease;
                                        ">Cancel</button>
                                    </div>
                                </form>
                            </div>

                            <!-- Report Display Section -->
                            <div id="reportDisplaySection">
                                <div id="myReportOnUser" style="display: none; margin-bottom: 2rem;">
                                    <h4 style="color: var(--accent-color); margin-bottom: 1rem;">Your Report</h4>
                                    <div id="myReportCard" class="report-card"></div>
                                </div>

                                <div id="reportsOverview">
                                    <h4 style="color: var(--accent-color); margin-bottom: 1rem;">Reports Overview</h4>
                                    <div id="totalReportsCount" style="color: var(--text-secondary); margin-bottom: 1rem;"></div>
                                    <div id="reportActions" style="display: flex; gap: 1rem; margin-bottom: 2rem;">
                                        <button id="createReportBtn" onclick="showReportForm()" style="
                                            background: var(--accent-color);
                                            color: var(--text-primary);
                                            border: none;
                                            padding: 0.75rem 1.5rem;
                                            border-radius: 0.5rem;
                                            cursor: pointer;
                                            transition: all 0.3s ease;
                                        ">Report User</button>
                                        <button onclick="loadMyReports()" style="
                                            background: var(--bg-secondary);
                                            color: var(--text-primary);
                                            border: 1px solid var(--border-color);
                                            padding: 0.75rem 1.5rem;
                                            border-radius: 0.5rem;
                                            cursor: pointer;
                                            transition: all 0.3s ease;
                                        ">My Reports</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Review Modal -->
    <div class="modal-overlay" id="reviewModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Write Review</h3>
                <button class="close-btn" onclick="closeReviewModal()">&times;</button>
            </div>
            <form onsubmit="submitReview(event)">
                <div class="form-group">
                    <label class="form-label">Select Client</label>
                    <select id="reviewClientSelect" class="form-input" required>
                        <option value="">Select a client to review...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Rating</label>
                    <div class="rating-input">
                        <span class="rating-star" data-rating="1">â˜…</span>
                        <span class="rating-star" data-rating="2">â˜…</span>
                        <span class="rating-star" data-rating="3">â˜…</span>
                        <span class="rating-star" data-rating="4">â˜…</span>
                        <span class="rating-star" data-rating="5">â˜…</span>
                    </div>
                    <input type="hidden" id="reviewRating" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Review Title</label>
                    <input type="text" id="reviewTitle" class="form-input" placeholder="Summary of your experience" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Review Comment (Optional)</label>
                    <textarea id="reviewComment" class="form-input" rows="4" placeholder="Share your detailed experience..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeReviewModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Submit Review</button>
                </div>
            </form>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        const API_URL = window.location.protocol + '//' + window.location.host;
        let authToken = localStorage.getItem('playerAuthToken');
        let currentUser = null;
        let animationsEnabled = true;

        // Animation control function
        function toggleAnimations() {
            const root = document.documentElement;
            const icon = document.getElementById('animationIcon');
            const text = document.getElementById('animationText');

            animationsEnabled = !animationsEnabled;

            if (animationsEnabled) {
                root.style.setProperty('--animation-intensity', '1');
                root.style.setProperty('--glow-opacity', '0.8');
                icon.className = 'fas fa-pause';
                text.textContent = 'Pause Animations';
                document.body.classList.remove('animations-disabled');
            } else {
                root.style.setProperty('--animation-intensity', '0');
                root.style.setProperty('--glow-opacity', '0.3');
                icon.className = 'fas fa-play';
                text.textContent = 'Enable Animations';
                document.body.classList.add('animations-disabled');
            }

            // Save preference
            localStorage.setItem('animationsEnabled', animationsEnabled);
        }

        // Load animation preference on page load
        function loadAnimationPreference() {
            const saved = localStorage.getItem('animationsEnabled');
            if (saved === 'false') {
                toggleAnimations();
            }
        }
        let currentChatUser = null;
        let socket = null;
        let mediaRecorder = null;
        let audioChunks = [];

        // Games list for displaying client games
        let allGames = [
            { id: 1, name: "Blue Dragon", image: "bluedragon.png", category: "slots" },
            { id: 2, name: "Cash Frenzy", image: "cashfrenzy 1.png", category: "slots" },
            { id: 3, name: "Cash Machine", image: "cashmachine.png", category: "slots" },
            { id: 4, name: "Casino Ignite", image: "casinoignitee.jpg", category: "casino" },
            { id: 5, name: "Casino Royale", image: "casinoroyale.png", category: "casino" },
            { id: 6, name: "E-Games", image: "Egames.png", category: "multi-game" },
            { id: 7, name: "Fire Kirin", image: "firekirin.png", category: "fish" },
            { id: 8, name: "Game Room Online", image: "Gameroom online.png", category: "multi-game" },
            { id: 9, name: "Game Vault", image: "gamevault.png", category: "multi-game" },
            { id: 10, name: "High Stake", image: "Highstake.jpg", category: "casino" },
            { id: 11, name: "Joker 777", image: "joker 777.png", category: "slots" },
            { id: 12, name: "Juwa Online", image: "juwaonline.png", category: "multi-game" },
            { id: 13, name: "Loot", image: "loot.jpg", category: "slots" },
            { id: 14, name: "Mega Spin", image: "Megaspin.jpg", category: "slots" },
            { id: 15, name: "Milky Way", image: "milkyway 2.png", category: "multi-game" },
            { id: 16, name: "Moolah", image: "moolah.jpg", category: "slots" },
            { id: 17, name: "Orion Stars", image: "orionstars.jpg", category: "multi-game" },
            { id: 18, name: "Panda Master", image: "Panda Master.jpg", category: "multi-game" },
            { id: 19, name: "Para Casino", image: "Paracasino.jpg", category: "casino" },
            { id: 20, name: "River Monster", image: "rivermonster 1.png", category: "fish" },
            { id: 21, name: "River Sweeps", image: "riversweeps 1.png", category: "sweepstakes" },
            { id: 22, name: "River Sweeps 2", image: "riversweeps 2.png", category: "sweepstakes" },
            { id: 23, name: "River Sweeps 3", image: "riversweeps 3.png", category: "sweepstakes" },
            { id: 24, name: "Sirius", image: "sirus.png", category: "multi-game" },
            { id: 25, name: "Ultra Panda", image: "ultrapanda.png", category: "multi-game" },
            { id: 26, name: "VBlink", image: "vblink 2.png", category: "multi-game" },
            { id: 27, name: "Vega Sweeps", image: "Vega Sweeps.png", category: "sweepstakes" },
            { id: 28, name: "Vegas X", image: "vegas x.png", category: "casino" },
            { id: 29, name: "Vegas Roll", image: "vegasroll.png", category: "casino" },
            { id: 30, name: "Win Star", image: "winstar.png", category: "casino" },
            { id: 31, name: "Yolo 777", image: "yolo777.png", category: "slots" }
        ];

        // Helper function to format time ago
        function timeAgo(dateString) {
            if (!dateString) return 'Never';
            const now = new Date();
            const date = new Date(dateString);
            const diffInSeconds = Math.floor((now - date) / 1000);

            if (diffInSeconds < 60) return 'Just now';
            if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)}m ago`;
            if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)}h ago`;
            if (diffInSeconds < 604800) return `${Math.floor(diffInSeconds / 86400)}d ago`;
            return date.toLocaleDateString();
        }

        // Helper function to get online status
        function getOnlineStatus(user) {
            if (user.is_online) {
                return { class: 'online', text: 'Online' };
            }

            if (!user.last_seen) {
                return { class: 'offline', text: 'Offline' };
            }

            const lastSeen = new Date(user.last_seen);
            const now = new Date();
            const diffInMinutes = Math.floor((now - lastSeen) / (1000 * 60));

            if (diffInMinutes < 5) {
                return { class: 'away', text: 'Away' };
            }

            return { class: 'offline', text: `Last seen ${timeAgo(user.last_seen)}` };
        }

        // Helper function to create avatar HTML with online status
        function createAvatarHTML(user, className = 'user-avatar', showOnlineStatus = true) {
            const onlineStatus = showOnlineStatus ? getOnlineStatus(user) : null;
            const onlineIndicator = showOnlineStatus ? `<div class="online-indicator ${onlineStatus.class}"></div>` : '';

            if (user.profile_picture) {
                const imageUrl = user.profile_picture.startsWith('http') ?
                    user.profile_picture : `${API_URL}${user.profile_picture}`;

                return `<div class="${className}" style="position: relative;">
                    <img src="${imageUrl}" alt="${user.full_name || user.username}"
                         style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                    ${onlineIndicator}
                </div>`;
            } else {
                const initial = (user.full_name || user.username).charAt(0).toUpperCase();
                return `<div class="${className}" style="position: relative;">${initial}${onlineIndicator}</div>`;
            }
        }

        // Check authentication on load
        window.onload = async function() {
            // Load animation preference
            loadAnimationPreference();

            if (authToken) {
                try {
                    const response = await fetch(`${API_URL}/auth/me`, {
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    });
                    if (response.ok) {
                        await loadDashboard();
                    } else {
                        localStorage.removeItem('playerAuthToken');
                        authToken = null;
                    }
                } catch (error) {
                    console.error('Auth check failed:', error);
                }
            }
        };

        // Navigation
        document.querySelectorAll('.nav-item[data-section]').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const section = item.dataset.section;

                // Update active nav
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                item.classList.add('active');

                // Show section
                document.querySelectorAll('.content-area').forEach(area => area.classList.remove('active'));
                document.getElementById(`${section}-section`).classList.add('active');

                // Load section-specific data
                if (section === 'home') {
                    updateHomeStats();
                } else if (section === 'reviews') {
                    loadReviewStats();
                    loadGivenReviews(); // Load given reviews by default
                } else if (section === 'promotions') {
                    loadPromotions();
                } else if (section === 'reports') {
                    loadReportsForSection();
                }
            });
        });

        function showLoginNotification(message, type = 'info') {
            const notification = document.getElementById('loginNotification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';
            notification.style.backgroundColor = type === 'error' ? '#dc3545' : type === 'success' ? '#28a745' : '#17a2b8';
            notification.style.color = 'white';

            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        async function handleLogin(event) {
            event.preventDefault();
            try {
                const formData = new FormData();
                formData.append('username', document.getElementById('username').value);
                formData.append('password', document.getElementById('password').value);

                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                if (response.ok) {
                    authToken = data.access_token;
                    localStorage.setItem('playerAuthToken', authToken);
                    await loadDashboard();
                } else {
                    showLoginNotification(data.detail || 'Login failed', 'error');
                }
            } catch (error) {
                showLoginNotification('Connection error', 'error');
            }
        }

        function showLogin() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('loginToggle').classList.add('active');
            document.getElementById('registerToggle').classList.remove('active');
            document.getElementById('welcomeMessage').textContent = 'Welcome back, champion!';
        }

        function showRegister() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
            document.getElementById('loginToggle').classList.remove('active');
            document.getElementById('registerToggle').classList.add('active');
            document.getElementById('welcomeMessage').textContent = 'Join the Casino Royale!';
        }

        async function handleRegister(event) {
            event.preventDefault();

            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;

            if (password !== confirmPassword) {
                showNotification('Passwords do not match', 'error');
                return;
            }

            try {
                const userData = {
                    email: document.getElementById('regEmail').value,
                    username: document.getElementById('regUsername').value,
                    full_name: document.getElementById('regFullName').value,
                    password: password,
                    user_type: 'player'
                };

                const response = await fetch(`${API_URL}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userData)
                });

                const data = await response.json();
                if (response.ok) {
                    showLoginNotification('Registration successful! Please login with your credentials.', 'success');
                    showLogin();
                    document.getElementById('username').value = userData.username;
                    document.getElementById('registerForm').reset();
                } else {
                    // Handle different error response formats
                    let errorMessage = 'Registration failed';
                    if (typeof data.detail === 'string') {
                        errorMessage = data.detail;
                    } else if (typeof data.detail === 'object' && data.detail) {
                        // Handle validation error objects
                        if (Array.isArray(data.detail)) {
                            errorMessage = data.detail[0]?.msg || 'Validation error';
                        } else {
                            errorMessage = JSON.stringify(data.detail);
                        }
                    } else if (data.message) {
                        errorMessage = data.message;
                    }
                    showLoginNotification(errorMessage, 'error');
                }
            } catch (error) {
                showLoginNotification('Connection error', 'error');
            }
        }

        async function loadDashboard() {
            try {
                // Get current user info
                const response = await fetch(`${API_URL}/auth/me`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (!response.ok) throw new Error('Failed to load user data');

                currentUser = await response.json();

                // Validate user type - only players should access this dashboard
                if (currentUser.user_type !== 'player') {
                    showNotification('Access denied. This dashboard is for players only.', 'error');
                    logout();
                    return;
                }

                // Update UI elements
                updateUserAvatar('sidebarAvatar', currentUser);
                document.getElementById('sidebarName').textContent = currentUser.full_name || currentUser.username;
                document.getElementById('sidebarId').textContent = `ID: ${currentUser.user_id}`;

                document.getElementById('headerName').textContent = currentUser.username;
                document.getElementById('headerLevel').textContent = currentUser.player_level || 1;
                document.getElementById('headerId').textContent = currentUser.user_id;

                // Settings
                document.getElementById('settingsName').value = currentUser.full_name || '';
                document.getElementById('settingsEmail').value = currentUser.email || '';
                document.getElementById('settingsLevel').value = `Level ${currentUser.player_level || 1}`;

                // Load profile picture
                loadProfilePicture();

                // Load email verification status
                loadEmailVerificationStatus();

                // Show dashboard
                document.getElementById('loginSection').style.display = 'none';
                const dashboard = document.getElementById('dashboardSection');
                dashboard.style.display = 'flex';
                dashboard.classList.add('active');

                // Load data
                await Promise.all([
                    loadFriends(),
                    loadFriendRequests(),
                    loadConversations(),
                    loadClients()
                ]);

                // Update home stats
                await updateHomeStats();

                // Connect WebSocket
                connectWebSocket();

                // Load online status
                loadOnlineStatus();
            } catch (error) {
                showNotification('Failed to load dashboard', 'error');
            }
        }

        async function updateDashboardStats() {
            try {
                // Update from loaded data
                const friendCount = document.querySelectorAll('#friendsList .user-card').length;
                const requestCount = document.querySelectorAll('#friendRequests .user-card').length;
                const clientCount = document.querySelectorAll('#clientsList .user-card').length;

                // Main dashboard stats
                document.getElementById('totalFriends').textContent = friendCount;
                document.getElementById('pendingRequests').textContent = requestCount;
                document.getElementById('clientFriends').textContent = clientCount;

                // Get message stats
                const statsResponse = await fetch(`${API_URL}/chat/stats`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (statsResponse.ok) {
                    const stats = await statsResponse.json();
                    document.getElementById('totalMessages').textContent = stats.messages_sent;
                } else {
                    document.getElementById('totalMessages').textContent = '0';
                }

                // Update recent activity
                updateRecentActivity();
            } catch (error) {
                console.error('Error updating stats:', error);
            }
        }

        function updateRecentActivity() {
            const activities = [];

            const friendCount = document.querySelectorAll('#friendsList .user-card').length;
            const requestCount = document.querySelectorAll('#friendRequests .user-card').length;

            if (friendCount > 0) {
                activities.push(`You have ${friendCount} friend${friendCount > 1 ? 's' : ''}`);
            }

            if (requestCount > 0) {
                activities.push(`${requestCount} pending friend request${requestCount > 1 ? 's' : ''}`);
            }

            const convCount = document.querySelectorAll('#conversationsList .conversation-item').length;
            if (convCount > 0) {
                activities.push(`${convCount} active conversation${convCount > 1 ? 's' : ''}`);
            }

            const activityDiv = document.getElementById('recentActivity');
            if (activities.length > 0) {
                activityDiv.innerHTML = activities.map(a => `<p style="margin: 0.5rem 0;">â€¢ ${a}</p>`).join('');
            } else {
                activityDiv.innerHTML = '<p>No recent activity. Start by searching for friends!</p>';
            }
        }

        async function loadClients() {
            try {
                const response = await fetch(`${API_URL}/friends/list`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (!response.ok) return;

                const data = await response.json();
                const clientFriends = data.friends.filter(f => f.user_type === 'client');
                const container = document.getElementById('clientsList');

                if (clientFriends.length === 0) {
                    container.innerHTML = '<p style="color: var(--text-secondary);">No client friends yet. Add clients as friends to see them here.</p>';
                    return;
                }

                container.innerHTML = clientFriends.map(client => `
                    <div class="user-card">
                        <div class="user-card-avatar">
                            ${createAvatarHTML(client, 'user-card-avatar')}
                        </div>
                        <div class="user-card-info">
                            <div class="user-card-name">${client.full_name || client.username}</div>
                            <div class="user-card-id">ID: ${client.user_id}</div>
                            ${client.company_name ? `<div class="user-card-id">${client.company_name}</div>` : ''}
                        </div>
                        <button class="btn-icon btn-danger" onclick="removeFriend(${client.id})">
                            <i class="fas fa-user-minus"></i>
                        </button>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Failed to load clients:', error);
            }
        }

        async function searchUsers() {
            const query = document.getElementById('searchInput').value;
            const userType = document.getElementById('userTypeFilter').value;

            try {
                let url = `${API_URL}/users/search?`;
                if (query) url += `query=${encodeURIComponent(query)}&`;
                if (userType) url += `user_type=${userType}`;

                const response = await fetch(url, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (!response.ok) throw new Error('Search failed');

                const data = await response.json();
                const container = document.getElementById('searchResults');

                if (data.users.length === 0) {
                    container.innerHTML = '<p style="color: var(--text-secondary);">No users found</p>';
                    return;
                }

                container.innerHTML = data.users.map(user => `
                    <div class="user-card">
                        ${createAvatarHTML(user, 'user-card-avatar', `openProfileModal(${user.id})`)}
                        <div class="user-card-info" style="cursor: pointer;" onclick="openProfileModal(${user.id})">
                            <div class="user-card-name">${user.full_name || user.username}</div>
                            <div class="user-card-id">ID: ${user.user_id} â€¢ ${user.user_type}</div>
                        </div>
                        <button class="btn btn-primary" onclick="sendFriendRequest('${user.user_id}')">
                            <i class="fas fa-user-plus"></i> Add Friend
                        </button>
                    </div>
                `).join('');
            } catch (error) {
                showNotification('Search failed', 'error');
            }
        }

        async function sendFriendRequest(userId) {
            try {
                const response = await fetch(`${API_URL}/friends/request`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ receiver_user_id: userId })
                });

                if (response.ok) {
                    showNotification('Friend request sent!', 'success');
                    searchUsers();
                } else {
                    const data = await response.json();
                    showNotification(data.detail || 'Failed to send request', 'error');
                }
            } catch (error) {
                showNotification('Connection error', 'error');
            }
        }

        async function loadFriendRequests() {
            try {
                const response = await fetch(`${API_URL}/friends/requests/received`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (!response.ok) return;

                const requests = await response.json();
                const container = document.getElementById('friendRequests');

                if (requests.length === 0) {
                    container.innerHTML = '<p style="color: var(--text-secondary);">No pending friend requests</p>';
                    return;
                }

                container.innerHTML = requests.map(req => `
                    <div class="user-card">
                        ${createAvatarHTML(req.sender, 'user-card-avatar', `openProfileModal(${req.sender.id})`)}
                        <div class="user-card-info" style="cursor: pointer;" onclick="openProfileModal(${req.sender.id})">
                            <div class="user-card-name">${req.sender.full_name || req.sender.username}</div>
                            <div class="user-card-id">ID: ${req.sender.user_id}</div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn-icon btn-success" onclick="handleFriendRequest(${req.id}, 'accepted')">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="btn-icon btn-danger" onclick="handleFriendRequest(${req.id}, 'rejected')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Failed to load friend requests:', error);
            }
        }

        async function handleFriendRequest(requestId, status) {
            try {
                const response = await fetch(`${API_URL}/friends/requests/${requestId}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status: status })
                });

                if (response.ok) {
                    showNotification(`Friend request ${status}`, 'success');
                    await Promise.all([
                        loadFriends(),
                        loadFriendRequests()
                    ]);
                    await updateDashboardStats();
                } else {
                    showNotification('Failed to update friend request', 'error');
                }
            } catch (error) {
                showNotification('Connection error', 'error');
            }
        }

        async function loadFriends() {
            try {
                const response = await fetch(`${API_URL}/friends/list`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (!response.ok) throw new Error('Failed to load friends');

                const data = await response.json();
                const friendsDiv = document.getElementById('friendsList');

                if (data.friends.length === 0) {
                    friendsDiv.innerHTML = '<p style="color: var(--text-secondary);">No friends yet. Send friend requests to connect!</p>';
                    return;
                }

                friendsDiv.innerHTML = data.friends.map(friend => {
                    const onlineStatus = getOnlineStatus(friend);
                    return `
                    <div class="user-card">
                        ${createAvatarHTML(friend, 'user-card-avatar')}
                        <div class="user-card-info" style="cursor: pointer;" onclick="openProfileModal(${friend.id})">
                            <div class="user-card-name">${friend.full_name || friend.username}</div>
                            <div class="user-card-id">ID: ${friend.user_id} â€¢ ${friend.user_type}</div>
                            <div class="last-seen">${onlineStatus.text}</div>
                        </div>
                        <button class="btn-icon btn-danger" onclick="removeFriend(${friend.id})">
                            <i class="fas fa-user-minus"></i>
                        </button>
                    </div>
                `;}).join('');
            } catch (error) {
                console.error('Failed to load friends:', error);
            }
        }

        async function removeFriend(friendId) {
            if (!confirm('Are you sure you want to remove this friend?')) return;

            try {
                const response = await fetch(`${API_URL}/friends/remove/${friendId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    showNotification('Friend removed', 'success');
                    await loadFriends();
                    await loadClients();
                    await updateDashboardStats();
                } else {
                    showNotification('Failed to remove friend', 'error');
                }
            } catch (error) {
                showNotification('Connection error', 'error');
            }
        }

        // Chat functions
        async function loadConversations() {
            try {
                const response = await fetch(`${API_URL}/chat/conversations`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (!response.ok) return;

                const conversations = await response.json();
                const container = document.getElementById('conversationsList');

                if (conversations.length === 0) {
                    container.innerHTML = '<div style="padding: 1rem; text-align: center; color: var(--text-secondary);">No conversations yet</div>';
                    return;
                }

                container.innerHTML = conversations.map(conv => {
                    const lastMsg = conv.last_message;
                    const lastMsgText = lastMsg ?
                        (lastMsg.message_type === 'text' ? lastMsg.content :
                         `<i class="fas fa-${lastMsg.message_type === 'image' ? 'image' : 'microphone'}"></i> ${lastMsg.message_type}`) :
                        'No messages';

                    return `
                        <div class="conversation-item ${currentChatUser && currentChatUser.id === conv.friend.id ? 'active' : ''}"
                             onclick='openChat(${JSON.stringify(conv.friend).replace(/'/g, "&apos;")}, event)'>
                            <div class="user-card-avatar">
                                ${createAvatarHTML(conv.friend, 'user-card-avatar')}
                            </div>
                            <div style="flex: 1;">
                                <div style="font-weight: 600;">${conv.friend.username}</div>
                                <div style="color: var(--text-secondary); font-size: 0.85rem;">${lastMsgText}</div>
                            </div>
                            ${conv.unread_count > 0 ? `<span class="badge" style="background: var(--danger); color: white; padding: 2px 6px; border-radius: 10px;">${conv.unread_count}</span>` : ''}
                        </div>
                    `;
                }).join('');

                // Update message badge
                const totalUnread = conversations.reduce((sum, conv) => sum + (conv.unread_count || 0), 0);
                const badge = document.getElementById('messagesBadge');
                if (totalUnread > 0) {
                    badge.textContent = totalUnread;
                    badge.style.display = 'inline-block';
                } else {
                    badge.style.display = 'none';
                }
            } catch (error) {
                console.error('Failed to load conversations:', error);
            }
        }

        async function openChat(friend, event = null) {
            currentChatUser = friend;

            // Update UI
            document.getElementById('emptyChatState').style.display = 'none';
            document.getElementById('activeChatArea').style.display = 'flex';

            updateUserAvatar('chatAvatar', friend);
            document.getElementById('chatUserName').textContent = friend.username;
            document.getElementById('chatStatus').textContent = friend.user_type;

            // Update online indicator
            const onlineIndicator = document.getElementById('chatOnlineIndicator');
            if (onlineIndicator) {
                const onlineStatus = getOnlineStatus(friend);
                onlineIndicator.className = `online-indicator ${onlineStatus.class}`;
            }

            // Show/hide client credentials section based on friend type
            const credentialsSection = document.getElementById('clientCredentialsSection');
            if (friend.user_type === 'client') {
                credentialsSection.style.display = 'block';
                await loadClientCredentials(friend.id);
            } else {
                credentialsSection.style.display = 'none';
            }

            // Update active conversation
            document.querySelectorAll('.conversation-item').forEach(item => {
                item.classList.remove('active');
            });
            // Find and activate the correct conversation item
            if (event && event.currentTarget) {
                event.currentTarget.classList.add('active');
            } else {
                // If no event, find the item by friend id
                document.querySelectorAll('.conversation-item').forEach(item => {
                    if (item.onclick && item.onclick.toString().includes(`"id":${friend.id}`)) {
                        item.classList.add('active');
                    }
                });
            }

            // Load messages
            await loadMessages(friend.id);
        }

        async function loadMessages(friendId) {
            try {
                const response = await fetch(`${API_URL}/chat/messages/${friendId}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (!response.ok) throw new Error('Failed to load messages');

                const data = await response.json();
                const messages = data.messages || [];
                const container = document.getElementById('messagesContainer');

                container.innerHTML = messages.map(msg => {
                    const isOwn = msg.sender_id === currentUser.id;
                    let content = '';

                    if (msg.message_type === 'text') {
                        content = msg.content;
                    } else if (msg.message_type === 'image') {
                        const imageUrl = msg.file_url.startsWith('http') ? msg.file_url : `${API_URL}${msg.file_url}`;
                        console.log('Image URL fixed:', msg.file_url, '->', imageUrl);
                        content = `<img src="${imageUrl}" style="max-width: 200px; border-radius: 10px;">`;
                    } else if (msg.message_type === 'voice') {
                        const voiceUrl = msg.file_url.startsWith('http') ? msg.file_url : `${API_URL}${msg.file_url}`;
                        console.log('Voice URL fixed:', msg.file_url, '->', voiceUrl);
                        content = `<audio controls><source src="${voiceUrl}" type="audio/webm"></audio>`;
                    }

                    return `
                        <div class="message ${isOwn ? 'own' : ''}">
                            <div class="message-bubble">
                                ${content}
                            </div>
                        </div>
                    `;
                }).join('');

                container.scrollTop = container.scrollHeight;
            } catch (error) {
                console.error('Failed to load messages:', error);
            }
        }

        async function sendChatMessage() {
            const input = document.getElementById('messageInput');
            const content = input.value.trim();

            if (!content || !currentChatUser) return;

            try {
                const formData = new FormData();
                formData.append('receiver_id', currentChatUser.id);
                formData.append('content', content);

                const response = await fetch(`${API_URL}/chat/send/text`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });

                if (response.ok) {
                    input.value = '';
                    await loadMessages(currentChatUser.id);
                    await loadConversations();
                } else {
                    showNotification('Failed to send message', 'error');
                }
            } catch (error) {
                showNotification('Connection error', 'error');
            }
        }

        // Typing indicator functions
        let typingTimeout;
        let isCurrentlyTyping = false;

        function sendTypingIndicator(isTyping) {
            if (!socket || socket.readyState !== WebSocket.OPEN || !currentChatUser) return;

            socket.send(JSON.stringify({
                type: 'typing',
                receiver_id: currentChatUser.id,
                is_typing: isTyping
            }));
        }

        function handleTyping() {
            if (!isCurrentlyTyping) {
                isCurrentlyTyping = true;
                sendTypingIndicator(true);
            }

            clearTimeout(typingTimeout);
            typingTimeout = setTimeout(() => {
                isCurrentlyTyping = false;
                sendTypingIndicator(false);
            }, 2000);
        }

        function showTypingIndicator(isTyping) {
            const typingIndicator = document.getElementById('typingIndicator');
            const chatStatus = document.getElementById('chatStatus');

            if (typingIndicator && chatStatus) {
                if (isTyping) {
                    typingIndicator.style.display = 'block';
                    chatStatus.style.display = 'none';
                } else {
                    typingIndicator.style.display = 'none';
                    chatStatus.style.display = 'block';
                }
            }
        }

        function handleMessageKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendChatMessage();
            }
        }

        async function handleImageSelect(event) {
            const file = event.target.files[0];
            if (!file || !currentChatUser) return;

            const formData = new FormData();
            formData.append('receiver_id', currentChatUser.id);
            formData.append('file', file);  // Fixed: Changed 'image' to 'file'

            try {
                const response = await fetch(`${API_URL}/chat/send/image`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${authToken}` },
                    body: formData
                });

                if (response.ok) {
                    await loadMessages(currentChatUser.id);
                    await loadConversations();
                } else {
                    showNotification('Failed to send image', 'error');
                }
            } catch (error) {
                showNotification('Connection error', 'error');
            }
        }

        async function startVoiceRecording() {
            if (!currentChatUser) return;

            if (!mediaRecorder) {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);

                    // Track recording start time for duration calculation
                    window.recordingStartTime = Date.now();

                    mediaRecorder.ondataavailable = (event) => {
                        audioChunks.push(event.data);
                    };

                    mediaRecorder.onstop = async () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                        audioChunks = [];

                        // Calculate duration in seconds
                        const duration = Math.floor((Date.now() - window.recordingStartTime) / 1000);

                        const formData = new FormData();
                        formData.append('receiver_id', currentChatUser.id);
                        formData.append('duration', duration);  // Fixed: Added required duration parameter
                        formData.append('file', audioBlob, 'voice.webm');  // Fixed: Changed 'voice' to 'file'

                        try {
                            const response = await fetch(`${API_URL}/chat/send/voice`, {
                                method: 'POST',
                                headers: { 'Authorization': `Bearer ${authToken}` },
                                body: formData
                            });

                            if (response.ok) {
                                await loadMessages(currentChatUser.id);
                                await loadConversations();
                            } else {
                                showNotification('Failed to send voice message', 'error');
                            }
                        } catch (error) {
                            showNotification('Failed to send voice message', 'error');
                        }
                    };

                    mediaRecorder.start();
                    showNotification('Recording... Click again to stop', 'info');
                } catch (error) {
                    showNotification('Microphone access denied', 'error');
                }
            } else {
                mediaRecorder.stop();
                mediaRecorder = null;
                showNotification('Voice message sent', 'success');
            }
        }

        // WebSocket
        function connectWebSocket() {
            console.log('Player Dashboard v2.1 - File URL Fix Active');
            const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            socket = new WebSocket(`${wsProtocol}//${window.location.host}/ws?token=${authToken}`);

            socket.onmessage = async (event) => {
                const data = JSON.parse(event.data);

                if (data.type === 'new_message') {
                    if (currentChatUser && data.sender_id === currentChatUser.id) {
                        await loadMessages(currentChatUser.id);
                    }
                    await loadConversations();
                    showNotification(`New message from ${data.sender_name}`, 'info');
                } else if (data.type === 'user_online') {
                    updateUserOnlineStatus(data.user_id, true);
                    showNotification(`${data.username} is now online`, 'info');
                } else if (data.type === 'user_offline') {
                    updateUserOnlineStatus(data.user_id, false);
                    showNotification(`${data.username} is now offline`, 'info');
                } else if (data.type === 'typing') {
                    // Handle typing indicator
                    if (currentChatUser && currentChatUser.id === data.user_id) {
                        showTypingIndicator(data.is_typing);
                    }
                }
            };

            socket.onerror = (error) => {
                console.error('WebSocket error:', error);
            };
        }

        // Online Status Functions
        function updateUserOnlineStatus(userId, isOnline, username = '') {
            // Update online indicators throughout the UI
            const avatars = document.querySelectorAll('.user-avatar, .user-card-avatar');
            avatars.forEach(avatar => {
                const parentCard = avatar.closest('.user-card, .conversation-item');
                if (parentCard && parentCard.querySelector(`[onclick*="${userId}"]`)) {
                    const indicator = avatar.querySelector('.online-indicator');
                    if (indicator) {
                        indicator.className = `online-indicator ${isOnline ? 'online' : 'offline'}`;
                    }

                    // Update last seen text
                    const lastSeenElement = parentCard.querySelector('.last-seen');
                    if (lastSeenElement) {
                        lastSeenElement.textContent = isOnline ? 'Online' : 'Offline';
                    }
                }
            });

            // Update status in chat header if this is the current chat user
            if (currentChatUser && currentChatUser.id === userId) {
                const chatStatus = document.getElementById('chatStatus');
                if (chatStatus) {
                    chatStatus.textContent = isOnline ? 'Online' : 'Offline';
                    chatStatus.style.color = isOnline ? '#4CAF50' : '#757575';
                }

                // Update chat header online indicator
                const chatOnlineIndicator = document.getElementById('chatOnlineIndicator');
                if (chatOnlineIndicator) {
                    chatOnlineIndicator.className = `online-indicator ${isOnline ? 'online' : 'offline'}`;
                }

                // Update chat avatar indicator
                const chatAvatar = document.querySelector('#chatSection .online-indicator');
                if (chatAvatar) {
                    chatAvatar.className = `online-indicator ${isOnline ? 'online' : 'offline'}`;
                }
            }
        }

        async function loadOnlineStatus() {
            try {
                const response = await fetch(`${API_URL}/users/online-status`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    // Update UI with online friends
                    data.online_friends.forEach(userId => {
                        updateUserOnlineStatus(userId, true);
                    });
                }
            } catch (error) {
                console.error('Error loading online status:', error);
            }
        }

        // Review Functions
        let currentReviewTab = 'given';
        let selectedRating = 0;

        async function loadReviewStats() {
            try {
                const [givenResponse, receivedResponse] = await Promise.all([
                    fetch(`${API_URL}/reviews/given`, {
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    }),
                    fetch(`${API_URL}/reviews/my-reviews`, {
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    })
                ]);

                if (givenResponse.ok && receivedResponse.ok) {
                    const givenData = await givenResponse.json();
                    const receivedData = await receivedResponse.json();

                    document.getElementById('reviewsGiven').textContent = givenData.total_count;
                    document.getElementById('reviewsReceived').textContent = receivedData.total_count;
                    document.getElementById('myRating').textContent = receivedData.average_rating ? receivedData.average_rating.toFixed(1) : '0.0';

                    // Calculate average rating given
                    if (givenData.reviews.length > 0) {
                        const avgGiven = givenData.reviews.reduce((sum, review) => sum + review.rating, 0) / givenData.reviews.length;
                        document.getElementById('avgRatingGiven').textContent = avgGiven.toFixed(1);
                    }
                }
            } catch (error) {
                console.error('Error loading review stats:', error);
            }
        }

        function switchReviewTab(tab) {
            currentReviewTab = tab;

            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Load content based on tab
            if (tab === 'given') {
                loadGivenReviews();
            } else if (tab === 'received') {
                loadReceivedReviews();
            } else if (tab === 'clients') {
                loadReviewableClients();
            }
        }

        async function loadGivenReviews() {
            try {
                const response = await fetch(`${API_URL}/reviews/given`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayReviews(data.reviews, 'given');
                }
            } catch (error) {
                console.error('Error loading given reviews:', error);
            }
        }

        async function loadReceivedReviews() {
            try {
                const response = await fetch(`${API_URL}/reviews/my-reviews`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayReviews(data.reviews, 'received');
                }
            } catch (error) {
                console.error('Error loading received reviews:', error);
            }
        }

        async function loadReviewableClients() {
            try {
                const response = await fetch(`${API_URL}/friends/list`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    const clients = data.friends.filter(friend => friend.user_type === 'client');
                    displayReviewableClients(clients);
                }
            } catch (error) {
                console.error('Error loading reviewable clients:', error);
            }
        }

        function displayReviews(reviews, type) {
            const container = document.getElementById('reviewsContent');

            if (reviews.length === 0) {
                container.innerHTML = `<div class="empty-state">No reviews ${type === 'given' ? 'given' : 'received'} yet.</div>`;
                return;
            }

            container.innerHTML = reviews.map(review => `
                <div class="review-card">
                    <div class="review-header">
                        <div class="review-user" style="cursor: pointer;" onclick="openProfileModal(${type === 'given' ? review.reviewee.id : review.reviewer.id})">
                            ${createAvatarHTML(type === 'given' ? review.reviewee : review.reviewer, 'review-avatar')}
                            <div class="user-info">
                                <div class="user-name">${type === 'given' ? review.reviewee.full_name : review.reviewer.full_name || 'Anonymous'}</div>
                                <div class="user-id">@${type === 'given' ? review.reviewee.user_id : review.reviewer.user_id}</div>
                            </div>
                        </div>
                        <div class="review-rating">
                            ${'â˜…'.repeat(review.rating)}${'â˜†'.repeat(5 - review.rating)}
                        </div>
                    </div>
                    <div class="review-content">
                        <h4 class="review-title">${review.title}</h4>
                        ${review.comment ? `<p class="review-comment">${review.comment}</p>` : ''}
                        <div class="review-date">${new Date(review.created_at).toLocaleDateString()}</div>
                    </div>
                    ${type === 'given' ? `
                        <div class="review-actions">
                            <button class="btn-icon" onclick="deleteReview(${review.id})" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function displayReviewableClients(clients) {
            const container = document.getElementById('reviewsContent');

            if (clients.length === 0) {
                container.innerHTML = '<div class="empty-state">No clients available to review. Add some client friends first!</div>';
                return;
            }

            container.innerHTML = clients.map(client => `
                <div class="reviewable-client-card">
                    <div class="client-info">
                        ${createAvatarHTML(client, 'user-avatar')}
                        <div class="client-details">
                            <div class="user-name">${client.full_name || 'Anonymous'}</div>
                            <div class="user-id">@${client.user_id}</div>
                            <div class="user-stats">${client.company_name || 'No company'}</div>
                        </div>
                    </div>
                    <button class="btn-primary" onclick="openReviewModal(${client.id})">
                        <i class="fas fa-star"></i> Review
                    </button>
                </div>
            `).join('');
        }

        function showWriteReviewModal() {
            loadReviewableClients();
            switchReviewTab('clients');
        }

        async function openReviewModal(clientId) {
            try {
                // Check if can review
                const canReviewResponse = await fetch(`${API_URL}/reviews/can-review/${clientId}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (canReviewResponse.ok) {
                    const canReviewData = await canReviewResponse.json();

                    if (!canReviewData.can_review) {
                        showNotification(canReviewData.reason, 'error');
                        return;
                    }
                }

                // Load client list for modal
                const response = await fetch(`${API_URL}/friends/list`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    const clients = data.friends.filter(friend => friend.user_type === 'client');

                    const select = document.getElementById('reviewClientSelect');
                    select.innerHTML = '<option value="">Select a client to review...</option>' +
                        clients.map(client => `
                            <option value="${client.id}" ${client.id === clientId ? 'selected' : ''}>
                                ${client.full_name || 'Anonymous'} (@${client.user_id})
                            </option>
                        `).join('');

                    // Reset form
                    selectedRating = 0;
                    document.getElementById('reviewRating').value = '';
                    document.getElementById('reviewTitle').value = '';
                    document.getElementById('reviewComment').value = '';
                    updateRatingDisplay();

                    document.getElementById('reviewModal').classList.add('active');
                }
            } catch (error) {
                showNotification('Error opening review modal', 'error');
            }
        }

        function closeReviewModal() {
            document.getElementById('reviewModal').classList.remove('active');
        }

        // Rating system
        document.addEventListener('DOMContentLoaded', function() {
            const ratingStars = document.querySelectorAll('.rating-star');

            ratingStars.forEach(star => {
                star.addEventListener('click', function() {
                    selectedRating = parseInt(this.dataset.rating);
                    document.getElementById('reviewRating').value = selectedRating;
                    updateRatingDisplay();
                });

                star.addEventListener('mouseover', function() {
                    const rating = parseInt(this.dataset.rating);
                    highlightStars(rating);
                });
            });

            // Reset on mouse leave
            const ratingInput = document.querySelector('.rating-input');
            if (ratingInput) {
                ratingInput.addEventListener('mouseleave', function() {
                    updateRatingDisplay();
                });
            }
        });

        function highlightStars(rating) {
            const stars = document.querySelectorAll('.rating-star');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }

        function updateRatingDisplay() {
            highlightStars(selectedRating);
        }

        async function submitReview(event) {
            event.preventDefault();

            const clientId = document.getElementById('reviewClientSelect').value;
            const rating = document.getElementById('reviewRating').value;
            const title = document.getElementById('reviewTitle').value;
            const comment = document.getElementById('reviewComment').value;

            if (!clientId || !rating || !title) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/reviews/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        reviewee_id: parseInt(clientId),
                        rating: parseInt(rating),
                        title: title,
                        comment: comment || null
                    })
                });

                if (response.ok) {
                    showNotification('Review submitted successfully!', 'success');
                    closeReviewModal();
                    loadReviewStats();
                    loadGivenReviews();
                } else {
                    const error = await response.json();
                    showNotification(error.detail || 'Failed to submit review', 'error');
                }
            } catch (error) {
                showNotification('Failed to submit review', 'error');
            }
        }

        // Profile Modal Functions
        async function openProfileModal(userId) {
            const modal = document.getElementById('profileModal');
            modal.classList.add('active');

            try {
                // Fetch profile data
                const response = await fetch(`${API_URL}/profiles/${userId}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (!response.ok) {
                    if (response.status === 401) {
                        // Try without auth for public profile
                        const publicResponse = await fetch(`${API_URL}/profiles/${userId}`);
                        if (!publicResponse.ok) throw new Error('Failed to load profile');
                        const profileData = await publicResponse.json();
                        displayProfile(profileData);
                    } else {
                        throw new Error('Failed to load profile');
                    }
                } else {
                    const profileData = await response.json();
                    console.log('=== API RESPONSE ===');
                    console.log('Status:', response.status);
                    console.log('Profile Data:', profileData);
                    console.log('===================');
                    displayProfile(profileData);
                }

                // Load reviews
                loadProfileReviews(userId);
            } catch (error) {
                console.error('Error loading profile:', error);
                showNotification('Failed to load profile', 'error');
                closeProfileModal();
            }
        }

        function closeProfileModal() {
            const modal = document.getElementById('profileModal');
            modal.classList.remove('active');
        }

        function displayProfile(profile) {
            // DEBUG: Log profile data
            console.log('=== PROFILE DATA ===');
            console.log('User Type:', profile.user_type);
            console.log('Available Games:', profile.available_games);
            console.log('Payment Methods:', profile.accepted_payment_methods);
            console.log('Full Profile:', profile);
            console.log('===================');

            // Set avatar with profile picture
            const profileAvatarElement = document.getElementById('profileAvatar');
            if (profile.profile_picture) {
                const imageUrl = profile.profile_picture.startsWith('http') ?
                    profile.profile_picture : `${API_URL}${profile.profile_picture}`;
                profileAvatarElement.innerHTML = `<img src="${imageUrl}" alt="${profile.full_name || profile.username}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
            } else {
                profileAvatarElement.textContent = (profile.username || 'U').charAt(0).toUpperCase();
            }

            // Set name and info
            document.getElementById('profileName').textContent =
                profile.full_name || profile.username;

            let infoHtml = `@${profile.user_id} â€¢ ${profile.user_type}`;
            if (profile.user_type === 'player') {
                infoHtml += ` â€¢ Level ${profile.player_level}`;
            } else if (profile.company_name) {
                infoHtml += ` â€¢ ${profile.company_name}`;
            }

            // Add "since joined" date for clients
            if (profile.user_type === 'client' && profile.created_at) {
                const joinDate = new Date(profile.created_at);
                const formattedDate = joinDate.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                infoHtml += ` â€¢ Member since ${formattedDate}`;
            }

            document.getElementById('profileInfo').innerHTML = infoHtml;

            // Display stats
            let statsHtml = '';

            // Common stats
            statsHtml += `
                <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px;">
                    <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary-gold);">${profile.total_friends || 0}</div>
                    <div style="color: var(--text-secondary); font-size: 0.9rem;">Friends</div>
                </div>
                <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px;">
                    <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary-gold);">${profile.reviews_received || 0}</div>
                    <div style="color: var(--text-secondary); font-size: 0.9rem;">Reviews</div>
                </div>
                <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px;">
                    <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary-gold);">${profile.average_rating ? profile.average_rating.toFixed(1) : '0.0'}</div>
                    <div style="color: var(--text-secondary); font-size: 0.9rem;">Avg Rating</div>
                </div>
            `;

            // Type-specific stats
            if (profile.user_type === 'player') {
                statsHtml += `
                    <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary-gold);">${profile.total_clients || 0}</div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem;">Clients</div>
                    </div>
                `;
            } else {
                statsHtml += `
                    <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary-gold);">${profile.total_players || 0}</div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem;">Players</div>
                    </div>
                `;
            }

            statsHtml += `
                <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px;">
                    <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary-gold);">${profile.account_age_days || 0}</div>
                    <div style="color: var(--text-secondary); font-size: 0.9rem;">Days Old</div>
                </div>
            `;

            document.getElementById('profileStats').innerHTML = statsHtml;

            // Display payment methods for clients
            const paymentMethodsSection = document.getElementById('profilePaymentMethods');
            if (profile.user_type === 'client' && profile.accepted_payment_methods && profile.accepted_payment_methods.length > 0) {
                paymentMethodsSection.style.display = 'block';
                const paymentMethodsList = document.getElementById('profilePaymentMethodsList');
                paymentMethodsList.innerHTML = profile.accepted_payment_methods.map(method => `
                    <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px; display: flex; align-items: center; gap: 0.75rem; border: 1px solid rgba(255,215,0,0.2);">
                        <img src="${method.icon_url}" alt="${method.display_name}" style="width: 24px; height: 24px; object-fit: contain;">
                        <span style="font-size: 0.9rem; color: var(--text-primary);">${method.display_name}</span>
                    </div>
                `).join('');
            } else {
                paymentMethodsSection.style.display = 'none';
            }

            // Display available games for clients
            const gamesSection = document.getElementById('profileGames');
            console.log('=== GAMES SECTION DEBUG ===');
            console.log('User type check:', profile.user_type === 'client');
            console.log('Games exist check:', !!profile.available_games);
            console.log('Games length:', profile.available_games ? profile.available_games.length : 0);
            console.log('Will display games:', profile.user_type === 'client' && profile.available_games && profile.available_games.length > 0);

            if (profile.user_type === 'client' && profile.available_games && profile.available_games.length > 0) {
                console.log('âœ… Displaying games section');
                // Use games data from API response (Fixed: was using localStorage)
                gamesSection.style.display = 'block';
                const gamesList = document.getElementById('profileGamesList');
                gamesList.innerHTML = profile.available_games.map(game => `
                    <div style="background: rgba(255,255,255,0.05); padding: 0.5rem; border-radius: 8px; text-align: center; border: 1px solid rgba(255,215,0,0.2);">
                        <div style="width: 50px; height: 50px; margin: 0 auto 0.5rem; border-radius: 4px; overflow: hidden; background: rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center;">
                            ${game.icon_url ?
                                `<img src="${game.icon_url}" alt="${game.display_name}"
                                     style="width: 100%; height: 100%; object-fit: cover;"
                                     onerror="this.style.display='none'; this.parentElement.querySelector('.fa-gamepad').style.display='flex';">`
                                : ''}
                            <i class="fas fa-gamepad" style="font-size: 1.5rem; color: var(--primary-gold); ${game.icon_url ? 'display: none;' : 'display: flex;'}"></i>
                        </div>
                        <div style="font-size: 0.75rem; color: var(--text-primary); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                            ${game.display_name}
                        </div>
                    </div>
                `).join('');
            } else {
                console.log('âŒ NOT displaying games section');
                console.log('Reason: Either not a client, no games array, or empty games array');
                gamesSection.style.display = 'none';
            }
            console.log('==========================');
        }

        async function loadProfileReviews(userId) {
            try {
                const response = await fetch(`${API_URL}/profiles/${userId}/reviews`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (!response.ok) {
                    // Try without auth
                    const publicResponse = await fetch(`${API_URL}/profiles/${userId}/reviews`);
                    if (!publicResponse.ok) throw new Error('Failed to load reviews');
                    const data = await publicResponse.json();
                    displayProfileReviews(data);
                } else {
                    const data = await response.json();
                    displayProfileReviews(data);
                }
            } catch (error) {
                console.error('Error loading profile reviews:', error);
                document.getElementById('profileReviews').innerHTML =
                    '<p style="color: var(--text-secondary);">Failed to load reviews</p>';
            }
        }

        function displayProfileReviews(data) {
            const container = document.getElementById('profileReviews');

            if (data.reviews.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary);">No reviews yet</p>';
                return;
            }

            container.innerHTML = `
                <div style="margin-bottom: 1rem;">
                    <span style="color: var(--text-secondary);">Average Rating: </span>
                    <span style="color: var(--primary-gold); font-weight: bold;">
                        ${data.average_rating.toFixed(1)} ${'â˜…'.repeat(Math.round(data.average_rating))}
                    </span>
                </div>
                ${data.reviews.map(review => `
                    <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <div>
                                <strong>${review.reviewer.full_name || review.reviewer.username}</strong>
                                <span style="color: var(--text-secondary);"> @${review.reviewer.user_id}</span>
                            </div>
                            <div style="color: var(--primary-gold);">
                                ${'â˜…'.repeat(review.rating)}${'â˜†'.repeat(5 - review.rating)}
                            </div>
                        </div>
                        <h4 style="margin-bottom: 0.5rem;">${review.title}</h4>
                        ${review.comment ? `<p style="color: var(--text-secondary);">${review.comment}</p>` : ''}
                        <div style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 0.5rem;">
                            ${new Date(review.created_at).toLocaleDateString()}
                        </div>
                    </div>
                `).join('')}
            `;
        }

        async function loadProfileFriends(userId) {
            try {
                const response = await fetch(`${API_URL}/profiles/${userId}/friends`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (!response.ok) {
                    // Try without auth
                    const publicResponse = await fetch(`${API_URL}/profiles/${userId}/friends`);
                    if (!publicResponse.ok) throw new Error('Failed to load friends');
                    const data = await publicResponse.json();
                    displayProfileFriends(data);
                } else {
                    const data = await response.json();
                    displayProfileFriends(data);
                }
            } catch (error) {
                console.error('Error loading profile friends:', error);
                document.getElementById('profileFriends').innerHTML =
                    '<p style="color: var(--text-secondary);">Failed to load friends</p>';
            }
        }

        function displayProfileFriends(data) {
            const container = document.getElementById('profileFriends');

            if (data.friends.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary);">No friends yet</p>';
                return;
            }

            container.innerHTML = `
                <div style="margin-bottom: 1rem; color: var(--text-secondary);">
                    Total Friends: <span style="color: var(--primary-gold); font-weight: bold;">${data.total_count}</span>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem;">
                    ${data.friends.map(friend => `
                        <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px; cursor: pointer;"
                             onclick="openProfileModal(${friend.id})">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <div style="width: 40px; height: 40px; background: var(--primary-gold);
                                            border-radius: 50%; display: flex; align-items: center;
                                            justify-content: center; color: var(--bg-dark); font-weight: bold; cursor: pointer;"
                                     onclick="openProfileModal(${friend.id})">
                                    ${friend.profile_picture ?
                                        `<img src="${friend.profile_picture.startsWith('http') ? friend.profile_picture : API_URL + friend.profile_picture}"
                                              alt="${friend.full_name || friend.username}"
                                              style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">` :
                                        friend.username.charAt(0).toUpperCase()
                                    }
                                </div>
                                <div>
                                    <div style="font-weight: bold;">${friend.full_name || friend.username}</div>
                                    <div style="color: var(--text-secondary); font-size: 0.9rem;">
                                        @${friend.user_id} â€¢ ${friend.user_type}
                                        ${friend.player_level ? ` â€¢ Lvl ${friend.player_level}` : ''}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function switchProfileTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.profile-tab').forEach(btn => {
                if (btn.dataset.tab === tab) {
                    btn.classList.add('active');
                    btn.style.color = 'var(--text-primary)';
                    btn.style.borderBottom = '2px solid var(--primary-gold)';
                } else {
                    btn.classList.remove('active');
                    btn.style.color = 'var(--text-secondary)';
                    btn.style.borderBottom = 'none';
                }
            });

            // Show/hide tab content
            if (tab === 'reviews') {
                document.getElementById('profileReviewsTab').style.display = 'block';
                document.getElementById('profileReportsTab').style.display = 'none';
            } else if (tab === 'reports') {
                document.getElementById('profileReviewsTab').style.display = 'none';
                document.getElementById('profileReportsTab').style.display = 'block';

                // Load reports when reports tab is opened
                const modal = document.getElementById('profileModal');
                const userIdElement = modal.querySelector('#profileUserId');
                if (userIdElement && userIdElement.textContent) {
                    const userId = parseInt(userIdElement.textContent);
                    loadUserReports(userId);
                }
            }
        }

        async function deleteReview(reviewId) {
            if (confirm('Are you sure you want to delete this review?')) {
                try {
                    const response = await fetch(`${API_URL}/reviews/${reviewId}`, {
                        method: 'DELETE',
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    });

                    if (response.ok) {
                        showNotification('Review deleted successfully', 'success');
                        loadReviewStats();
                        if (currentReviewTab === 'given') {
                            loadGivenReviews();
                        }
                    } else {
                        showNotification('Failed to delete review', 'error');
                    }
                } catch (error) {
                    showNotification('Failed to delete review', 'error');
                }
            }
        }

        function logout() {
            localStorage.removeItem('playerAuthToken');
            window.location.reload();
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';

            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // Promotions Functions
        let currentPromotionTab = 'all';
        let allPromotions = [];

        async function loadPromotions() {
            try {
                const response = await fetch(`${API_URL}/promotions/available`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    // Handle both array response and object with promotions property
                    allPromotions = Array.isArray(data) ? data : (data.promotions || []);
                    updatePromotionBadge(allPromotions);
                    displayPromotions(currentPromotionTab);
                }
            } catch (error) {
                console.error('Error loading promotions:', error);
            }
        }

        function updatePromotionBadge(promotions) {
            if (!promotions || !Array.isArray(promotions)) {
                promotions = [];
            }
            const eligibleCount = promotions.filter(p => p.can_claim && !p.already_claimed).length;
            const badge = document.getElementById('promotionsBadge');

            if (eligibleCount > 0) {
                badge.textContent = eligibleCount;
                badge.style.display = 'block';
            } else {
                badge.style.display = 'none';
            }
        }

        function switchPromotionTab(tab) {
            currentPromotionTab = tab;
            const tabs = document.querySelectorAll('#promotions-section .tab-btn');
            tabs.forEach(t => {
                t.classList.remove('active');
                if (t.textContent.toLowerCase().includes(tab.toLowerCase()) ||
                    (tab === 'all' && t.textContent === 'All Promotions')) {
                    t.classList.add('active');
                }
            });
            displayPromotions(tab);
        }

        function displayPromotions(filter) {
            const container = document.getElementById('promotionsList');
            if (!container) return;

            // Ensure allPromotions is an array
            if (!Array.isArray(allPromotions)) {
                allPromotions = [];
            }
            let filtered = allPromotions;

            if (filter === 'eligible') {
                filtered = allPromotions.filter(p => p.can_claim && !p.already_claimed);
            } else if (filter === 'claimed') {
                filtered = allPromotions.filter(p => p.already_claimed);
            }

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 3rem; color: var(--text-light);">
                        <i class="fas fa-gift" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                        <p>No promotions available</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filtered.map(promo => {
                const endDate = new Date(promo.end_date);
                const now = new Date();
                const hoursLeft = Math.ceil((endDate - now) / (1000 * 60 * 60));
                const daysLeft = Math.ceil(hoursLeft / 24);

                return `
                    <div class="promotion-card">
                        <div class="promotion-header">
                            <div>
                                <div class="promotion-title">${promo.title}</div>
                                <span class="promotion-type">${promo.promotion_type.replace('_', ' ')}</span>
                            </div>
                        </div>
                        <div class="promotion-client">
                            <div class="promotion-client-avatar">
                                ${promo.client_name.charAt(0).toUpperCase()}
                            </div>
                            <div>
                                <div style="font-weight: 600;">${promo.client_company || promo.client_name}</div>
                                <div style="font-size: 0.875rem; color: var(--text-light);">Casino Partner</div>
                            </div>
                        </div>
                        <div class="promotion-value">
                            ${promo.value} ${promo.promotion_type.includes('cashback') ? '%' : 'Credits'}
                        </div>
                        <div class="promotion-details">
                            <div class="promotion-detail">
                                <i class="fas fa-layer-group"></i>
                                <span>Level ${promo.min_player_level}+</span>
                            </div>
                            <div class="promotion-detail">
                                <i class="fas fa-dice"></i>
                                <span>${promo.wagering_requirement}x wagering</span>
                            </div>
                        </div>
                        <div class="promotion-countdown">
                            <i class="fas fa-clock"></i>
                            ${hoursLeft > 48 ? `Ends in ${daysLeft} days` : `${hoursLeft} hours left`}
                        </div>
                        ${promo.already_claimed ?
                            `<div class="claimed-badge">
                                <i class="fas fa-check-circle"></i> Already Claimed
                            </div>` :
                            promo.can_claim ?
                                `<button class="claim-button" onclick="claimPromotion(${promo.id})">
                                    <i class="fas fa-gift"></i> Claim Now
                                </button>` :
                                `<button class="claim-button" disabled>
                                    Not Eligible
                                </button>`
                        }
                    </div>
                `;
            }).join('');
        }

        async function claimPromotion(promotionId) {
            try {
                // Find the promotion details
                const promo = allPromotions.find(p => p.id === promotionId);
                if (!promo) {
                    showNotification('Promotion not found', 'error');
                    return;
                }

                // Switch to Messages tab
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                document.querySelector('.nav-item[data-section="messages"]').classList.add('active');
                document.querySelectorAll('.content-area').forEach(area => area.classList.remove('active'));
                document.getElementById('messages-section').classList.add('active');

                // Open chat with the client who created the promotion
                const clientUser = {
                    id: promo.client_id,
                    username: promo.client_name || 'Client',
                    user_type: 'client'
                };
                await openChat(clientUser);

                // Send automatic claim request message
                const claimMessage = `ðŸŽ¯ Promotion Claim Request\n\n` +
                    `I would like to claim the promotion: "${promo.title}"\n` +
                    `Type: ${promo.promotion_type.replace('_', ' ')}\n` +
                    `Value: ${promo.value}${promo.promotion_type === 'cashback' ? '%' : ' credits'}\n` +
                    `Promotion ID: #${promotionId}\n\n` +
                    `Please approve this claim to apply the promotion to my account.`;

                // Send the message
                const messageData = new FormData();
                messageData.append('receiver_id', promo.client_id);
                messageData.append('content', claimMessage);

                const response = await fetch(`${API_URL}/chat/send/text`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: messageData
                });

                if (response.ok) {
                    showNotification('Claim request sent to the casino!', 'info');
                    // Reload messages to show the sent message
                    await loadMessages(promo.client_id);
                } else {
                    showNotification('Failed to send claim request', 'error');
                }
            } catch (error) {
                console.error('Error sending claim request:', error);
                showNotification('Failed to send claim request', 'error');
            }
        }

        async function showMyClaimsModal() {
            showNotification('Claims history coming soon!', 'info');
        }

        async function showWalletModal() {
            showNotification('Wallet feature coming soon!', 'info');
        }

        // Profile Picture Functions
        function selectProfilePicture() {
            document.getElementById('profilePictureInput').click();
        }

        document.getElementById('profilePictureInput').addEventListener('change', async function(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Validate file type
            if (!file.type.startsWith('image/')) {
                showNotification('Please select an image file', 'error');
                return;
            }

            // Validate file size (5MB max)
            if (file.size > 5 * 1024 * 1024) {
                showNotification('File size too large. Maximum 5MB allowed', 'error');
                return;
            }

            // Show preview
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.getElementById('profilePictureImage');
                const placeholder = document.getElementById('profilePicturePlaceholder');
                const deleteBtn = document.getElementById('deleteProfilePictureBtn');

                img.src = e.target.result;
                img.style.display = 'block';
                placeholder.style.display = 'none';
                deleteBtn.style.display = 'block';
            };
            reader.readAsDataURL(file);

            // Upload file
            await uploadProfilePicture(file);
        });

        async function uploadProfilePicture(file) {
            try {
                const formData = new FormData();
                formData.append('file', file);

                const response = await fetch(`${API_URL}/profiles/${currentUser.id}/profile-picture`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });

                if (response.ok) {
                    const result = await response.json();
                    showNotification('Profile picture uploaded successfully!', 'success');

                    // Update current user object
                    currentUser.profile_picture = result.profile_picture_url;

                    // Update profile picture in header
                    updateHeaderProfilePicture();
                } else {
                    const error = await response.json();
                    showNotification(error.detail || 'Failed to upload profile picture', 'error');
                }
            } catch (error) {
                console.error('Error uploading profile picture:', error);
                showNotification('Failed to upload profile picture', 'error');
            }
        }

        async function deleteProfilePicture() {
            try {
                const response = await fetch(`${API_URL}/profiles/${currentUser.id}/profile-picture`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const img = document.getElementById('profilePictureImage');
                    const placeholder = document.getElementById('profilePicturePlaceholder');
                    const deleteBtn = document.getElementById('deleteProfilePictureBtn');

                    img.style.display = 'none';
                    placeholder.style.display = 'block';
                    deleteBtn.style.display = 'none';

                    // Update current user object
                    currentUser.profile_picture = null;

                    // Update profile picture in header
                    updateHeaderProfilePicture();

                    showNotification('Profile picture deleted successfully!', 'success');
                } else {
                    const error = await response.json();
                    showNotification(error.detail || 'Failed to delete profile picture', 'error');
                }
            } catch (error) {
                console.error('Error deleting profile picture:', error);
                showNotification('Failed to delete profile picture', 'error');
            }
        }

        function updateHeaderProfilePicture() {
            // Update the main user avatar
            updateUserAvatar('sidebarAvatar', currentUser);
        }

        function updateUserAvatar(elementId, user) {
            const avatarElement = document.getElementById(elementId);
            if (!avatarElement) return;

            if (user.profile_picture) {
                const imageUrl = user.profile_picture.startsWith('http') ?
                    user.profile_picture : `${API_URL}${user.profile_picture}`;

                avatarElement.innerHTML = `<img src="${imageUrl}" alt="${user.full_name || user.username}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
            } else {
                avatarElement.textContent = (user.full_name || user.username).charAt(0).toUpperCase();
            }
        }

        function createAvatarHTML(user, className = 'user-avatar', onClick = null) {
            const clickHandler = onClick ? `onclick="${onClick}"` : '';

            if (user.profile_picture) {
                const imageUrl = user.profile_picture.startsWith('http') ?
                    user.profile_picture : `${API_URL}${user.profile_picture}`;

                return `<div class="${className}" ${clickHandler}>
                    <img src="${imageUrl}" alt="${user.full_name || user.username}"
                         style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                </div>`;
            } else {
                const initial = (user.full_name || user.username).charAt(0).toUpperCase();
                return `<div class="${className}" ${clickHandler}>${initial}</div>`;
            }
        }

        function loadProfilePicture() {
            if (currentUser.profile_picture) {
                const img = document.getElementById('profilePictureImage');
                const placeholder = document.getElementById('profilePicturePlaceholder');
                const deleteBtn = document.getElementById('deleteProfilePictureBtn');

                const imageUrl = currentUser.profile_picture.startsWith('http') ?
                    currentUser.profile_picture : `${API_URL}${currentUser.profile_picture}`;

                img.src = imageUrl;
                img.style.display = 'block';
                placeholder.style.display = 'none';
                deleteBtn.style.display = 'block';
            }
        }

        // Email Verification Functions
        async function loadEmailVerificationStatus() {
            try {
                const response = await fetch(`${API_URL}/email/status`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const status = await response.json();
                    renderEmailVerificationSection(status);
                }
            } catch (error) {
                console.error('Failed to load email verification status:', error);
            }
        }

        function renderEmailVerificationSection(status) {
            const section = document.getElementById('emailVerificationSection');

            if (!status.secondary_email) {
                // No email set - show input to add email
                section.innerHTML = `
                    <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px;">
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                            Add a secondary email address to verify your account
                        </p>
                        <div style="display: flex; gap: 1rem; align-items: center;">
                            <input type="email" id="newEmailInput" placeholder="Enter email address"
                                   style="flex: 1; padding: 0.75rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,215,0,0.3); border-radius: 5px; color: white;" />
                            <button class="btn btn-primary" onclick="sendEmailVerification()">
                                <i class="fas fa-envelope"></i> Add Email
                            </button>
                        </div>
                    </div>
                `;
            } else if (!status.is_email_verified) {
                // Email set but not verified
                const isPending = status.verification_pending;
                section.innerHTML = `
                    <div style="background: rgba(255,193,7,0.1); border: 1px solid rgba(255,193,7,0.3); padding: 1rem; border-radius: 8px;">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <i class="fas fa-exclamation-triangle" style="color: #ffc107; font-size: 1.2rem;"></i>
                            <div style="flex: 1;">
                                <strong>Email Verification Pending</strong>
                                <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">
                                    ${status.secondary_email}
                                </p>
                            </div>
                        </div>
                        ${isPending ?
                            `<p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.9rem;">
                                Check your email and click the verification link.
                            </p>` : ''
                        }
                        <div style="display: flex; gap: 1rem;">
                            <button class="btn btn-secondary" onclick="resendVerificationEmail()" ${isPending ? '' : 'disabled'}>
                                <i class="fas fa-paper-plane"></i> Resend Email
                            </button>
                            <button class="btn btn-danger" onclick="removeSecondaryEmail()">
                                <i class="fas fa-trash"></i> Remove Email
                            </button>
                        </div>
                    </div>
                `;
            } else {
                // Email verified
                section.innerHTML = `
                    <div style="background: rgba(76,175,80,0.1); border: 1px solid rgba(76,175,80,0.3); padding: 1rem; border-radius: 8px;">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <i class="fas fa-check-circle" style="color: #4caf50; font-size: 1.2rem;"></i>
                            <div style="flex: 1;">
                                <strong style="color: #4caf50;">Email Verified</strong>
                                <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">
                                    ${status.secondary_email}
                                </p>
                            </div>
                        </div>
                        <button class="btn btn-danger" onclick="removeSecondaryEmail()">
                            <i class="fas fa-trash"></i> Remove Email
                        </button>
                    </div>
                `;
            }
        }

        async function sendEmailVerification() {
            const email = document.getElementById('newEmailInput').value.trim();
            if (!email) {
                showNotification('Please enter an email address', 'error');
                return;
            }

            if (!email.includes('@') || !email.includes('.')) {
                showNotification('Please enter a valid email address', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/email/send-verification`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email })
                });

                const result = await response.json();

                if (response.ok) {
                    showNotification('Verification email sent! Check your inbox.', 'success');
                    await loadEmailVerificationStatus(); // Reload to show new status
                } else {
                    showNotification(result.detail || 'Failed to send verification email', 'error');
                }
            } catch (error) {
                showNotification('Connection error', 'error');
            }
        }

        async function resendVerificationEmail() {
            try {
                const response = await fetch(`${API_URL}/email/resend-verification`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                const result = await response.json();

                if (response.ok) {
                    showNotification('Verification email resent!', 'success');
                } else {
                    showNotification(result.detail || 'Failed to resend verification email', 'error');
                }
            } catch (error) {
                showNotification('Connection error', 'error');
            }
        }

        async function removeSecondaryEmail() {
            if (!confirm('Are you sure you want to remove your secondary email?')) return;

            try {
                const response = await fetch(`${API_URL}/email/remove`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    showNotification('Secondary email removed', 'success');
                    await loadEmailVerificationStatus(); // Reload to show new status
                } else {
                    showNotification('Failed to remove email', 'error');
                }
            } catch (error) {
                showNotification('Connection error', 'error');
            }
        }

        // Game Credentials Functions
        async function loadMyGameCredentials() {
            try {
                const response = await fetch(`${API_URL}/game-credentials/my-credentials`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayPlayerCredentials(data.credentials);
                } else {
                    console.error('Failed to load game credentials');
                    showNotification('Failed to load game credentials', 'error');
                }
            } catch (error) {
                console.error('Error loading game credentials:', error);
                showNotification('Failed to load game credentials', 'error');
            }
        }

        function displayPlayerCredentials(credentials) {
            const emptyState = document.getElementById('credentialsEmptyState');
            const credentialsGrid = document.getElementById('credentialsGrid');

            if (credentials.length === 0) {
                emptyState.style.display = 'block';
                credentialsGrid.style.display = 'none';
                return;
            }

            emptyState.style.display = 'none';
            credentialsGrid.style.display = 'grid';

            credentialsGrid.innerHTML = credentials.map(credential => `
                <div class="credential-card">
                    <div class="credential-header">
                        <div class="credential-icon">
                            <i class="fas fa-gamepad"></i>
                        </div>
                        <h3 class="credential-title">${credential.game_display_name}</h3>
                    </div>
                    <div class="credential-info">
                        <div class="credential-field">
                            <span class="credential-label">Username</span>
                            <div style="display: flex; align-items: center;">
                                <span class="credential-value" id="username-${credential.id}">${credential.game_username}</span>
                                <button class="copy-btn" onclick="copyToClipboard('username-${credential.id}', '${credential.game_username}')" title="Copy username">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>
                        <div class="credential-field">
                            <span class="credential-label">Password</span>
                            <div style="display: flex; align-items: center;">
                                <span class="credential-value" id="password-${credential.id}">${credential.game_password}</span>
                                <button class="copy-btn" onclick="copyToClipboard('password-${credential.id}', '${credential.game_password}')" title="Copy password">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="credential-date">
                        Created: ${new Date(credential.created_at).toLocaleDateString()}
                        ${credential.updated_at !== credential.created_at ?
                            `<br>Updated: ${new Date(credential.updated_at).toLocaleDateString()}` : ''}
                    </div>
                </div>
            `).join('');
        }

        async function copyToClipboard(elementId, text) {
            try {
                await navigator.clipboard.writeText(text);

                // Visual feedback
                const element = document.getElementById(elementId);
                const originalColor = element.style.color;
                element.style.color = 'var(--primary-gold)';

                showNotification('Copied to clipboard!', 'success');

                setTimeout(() => {
                    element.style.color = originalColor;
                }, 1000);
            } catch (err) {
                // Fallback for browsers that don't support clipboard API
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    document.execCommand('copy');
                    showNotification('Copied to clipboard!', 'success');
                } catch (error) {
                    showNotification('Failed to copy to clipboard', 'error');
                }
                document.body.removeChild(textArea);
            }
        }

        // Load credentials when game-credentials section is opened
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listener for the game credentials navigation
            const gameCredentialsNav = document.querySelector('.nav-item[data-section="game-credentials"]');
            if (gameCredentialsNav) {
                gameCredentialsNav.addEventListener('click', function() {
                    setTimeout(() => {
                        loadMyGameCredentials();
                    }, 100); // Small delay to ensure section is visible
                });
            }
        });

        // Client Credentials in Messages Functions
        async function loadClientCredentials(clientId) {
            try {
                const response = await fetch(`${API_URL}/game-credentials/my-credentials`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    // Filter credentials created by this specific client
                    const clientCredentials = data.credentials.filter(cred => cred.created_by_client_id === clientId);
                    displayClientCredentials(clientCredentials);
                } else {
                    console.error('Failed to load client credentials');
                }
            } catch (error) {
                console.error('Error loading client credentials:', error);
            }
        }

        function displayClientCredentials(credentials) {
            const container = document.getElementById('clientCredentialsList');
            const countSpan = document.getElementById('credentialsCount');

            // Update the count
            countSpan.textContent = credentials.length;

            if (credentials.length === 0) {
                container.innerHTML = '<div class="client-credentials-empty">No game credentials from this client yet.</div>';
                return;
            }

            container.innerHTML = credentials.map(credential => `
                <div style="background: rgba(26, 0, 0, 0.5); border: 1px solid var(--primary-gold); border-radius: 8px; padding: 0.5rem; margin-bottom: 0.5rem;">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <i class="fas fa-gamepad" style="color: var(--primary-gold); font-size: 0.875rem;"></i>
                        <span style="font-weight: 600; font-size: 0.875rem; color: var(--primary-gold);">${credential.game_display_name}</span>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 0.75rem;">
                        <div style="display: flex; align-items: center; gap: 0.25rem;">
                            <span style="color: var(--text-secondary);">User:</span>
                            <span style="color: var(--text-primary); font-family: monospace;" id="client-username-${credential.id}">${credential.game_username}</span>
                            <button style="background: none; border: none; color: var(--primary-gold); cursor: pointer; padding: 2px;"
                                    onclick="copyClientCredential('client-username-${credential.id}', '${credential.game_username}')" title="Copy">
                                <i class="fas fa-copy" style="font-size: 0.65rem;"></i>
                            </button>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.25rem;">
                            <span style="color: var(--text-secondary);">Pass:</span>
                            <span style="color: var(--text-primary); font-family: monospace;" id="client-password-${credential.id}">${credential.game_password}</span>
                            <button style="background: none; border: none; color: var(--primary-gold); cursor: pointer; padding: 2px;"
                                    onclick="copyClientCredential('client-password-${credential.id}', '${credential.game_password}')" title="Copy">
                                <i class="fas fa-copy" style="font-size: 0.65rem;"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function toggleClientCredentials() {
            const content = document.getElementById('clientCredentialsList');
            const toggle = document.getElementById('credentialsToggle');
            const icon = toggle.querySelector('i');

            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.style.transform = 'rotate(180deg)';
            } else {
                content.style.display = 'none';
                icon.style.transform = 'rotate(0deg)';
            }
        }

        async function copyClientCredential(elementId, text) {
            try {
                await navigator.clipboard.writeText(text);

                // Visual feedback
                const element = document.getElementById(elementId);
                const originalColor = element.style.color;
                element.style.color = 'var(--primary-gold)';

                showNotification('Copied to clipboard!', 'success');

                setTimeout(() => {
                    element.style.color = originalColor;
                }, 1000);
            } catch (err) {
                // Fallback for browsers that don't support clipboard API
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    document.execCommand('copy');
                    showNotification('Copied to clipboard!', 'success');
                } catch (error) {
                    showNotification('Failed to copy to clipboard', 'error');
                }
                document.body.removeChild(textArea);
            }
        }

        // Reporting System Functions
        let currentProfileUserId = null;
        let currentEditingReport = null;

        async function loadUserReports(userId) {
            currentProfileUserId = userId;
            try {
                const response = await fetch(`${API_URL}/reports/user/${userId}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();

                    // Update total reports count
                    document.getElementById('totalReportsCount').textContent =
                        `This user has received ${data.total_reports} report(s)`;

                    // Show/hide report creation button based on can_report
                    const createBtn = document.getElementById('createReportBtn');
                    if (data.can_report) {
                        createBtn.style.display = 'inline-block';
                        createBtn.textContent = 'Report User';
                    } else if (data.my_report) {
                        createBtn.style.display = 'none';
                        // Show user's existing report
                        showMyReport(data.my_report);
                    } else {
                        createBtn.style.display = 'none';
                    }
                } else {
                    showNotification('Failed to load reports', 'error');
                }
            } catch (error) {
                console.error('Error loading user reports:', error);
                showNotification('Error loading reports', 'error');
            }
        }

        function showMyReport(report) {
            const myReportSection = document.getElementById('myReportOnUser');
            const myReportCard = document.getElementById('myReportCard');

            myReportCard.innerHTML = createReportCard(report, true);
            myReportSection.style.display = 'block';
        }

        function createReportCard(report, isMyReport = false) {
            return `
                <div class="report-meta">
                    <div>
                        <strong style="color: var(--text-primary);">${isMyReport ? 'Your Report' : `Report by ${report.reporter_name}`}</strong>
                        <div style="color: var(--text-secondary); font-size: 0.875rem;">
                            ${new Date(report.created_at).toLocaleDateString()}
                        </div>
                    </div>
                    <span class="report-status ${report.status.toLowerCase()}">${report.status}</span>
                </div>
                <div class="report-reason">${report.reason}</div>
                ${isMyReport ? `
                    <div class="report-actions">
                        <button class="edit-report-btn" onclick="editReport(${report.id}, '${report.reason.replace(/'/g, "\\'")}')">
                            Edit Report
                        </button>
                        <button class="delete-report-btn" onclick="deleteReport(${report.id})">
                            Delete Report
                        </button>
                    </div>
                ` : ''}
            `;
        }

        function showReportForm() {
            document.getElementById('reportDisplaySection').style.display = 'none';
            document.getElementById('reportActionSection').style.display = 'block';
            document.getElementById('reportReason').value = '';
            document.getElementById('submitReportBtn').textContent = 'Submit Report';
            currentEditingReport = null;
        }

        function editReport(reportId, currentReason) {
            document.getElementById('reportDisplaySection').style.display = 'none';
            document.getElementById('reportActionSection').style.display = 'block';
            document.getElementById('reportReason').value = currentReason;
            document.getElementById('submitReportBtn').textContent = 'Update Report';
            currentEditingReport = reportId;
        }

        function cancelReportAction() {
            document.getElementById('reportActionSection').style.display = 'none';
            document.getElementById('reportDisplaySection').style.display = 'block';
            currentEditingReport = null;
        }

        async function submitReport(event) {
            event.preventDefault();

            const reason = document.getElementById('reportReason').value.trim();
            if (!reason) {
                showNotification('Please provide a reason for the report', 'error');
                return;
            }

            try {
                let response;

                if (currentEditingReport) {
                    // Update existing report
                    response = await fetch(`${API_URL}/reports/${currentEditingReport}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${authToken}`
                        },
                        body: JSON.stringify({ reason })
                    });
                } else {
                    // Create new report
                    response = await fetch(`${API_URL}/reports/`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${authToken}`
                        },
                        body: JSON.stringify({
                            reported_user_id: currentProfileUserId,
                            reason
                        })
                    });
                }

                if (response.ok) {
                    const data = await response.json();
                    showNotification(currentEditingReport ? 'Report updated successfully' : 'Report submitted successfully', 'success');
                    cancelReportAction();

                    // Show the updated report
                    showMyReport(data);

                    // Hide create button
                    document.getElementById('createReportBtn').style.display = 'none';
                } else {
                    const errorData = await response.json();
                    showNotification(errorData.detail || 'Failed to submit report', 'error');
                }
            } catch (error) {
                console.error('Error submitting report:', error);
                showNotification('Error submitting report', 'error');
            }
        }

        async function deleteReport(reportId) {
            if (!confirm('Are you sure you want to delete this report?')) {
                return;
            }

            try {
                const response = await fetch(`${API_URL}/reports/${reportId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    showNotification('Report deleted successfully', 'success');

                    // Hide my report section and show create button
                    document.getElementById('myReportOnUser').style.display = 'none';
                    document.getElementById('createReportBtn').style.display = 'inline-block';
                    document.getElementById('createReportBtn').textContent = 'Report User';
                } else {
                    const errorData = await response.json();
                    showNotification(errorData.detail || 'Failed to delete report', 'error');
                }
            } catch (error) {
                console.error('Error deleting report:', error);
                showNotification('Error deleting report', 'error');
            }
        }

        async function loadMyReports() {
            try {
                const response = await fetch(`${API_URL}/reports/my-reports`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();

                    // Create modal to show reports
                    const reportsHtml = `
                        <div class="modal" style="display: block;">
                            <div class="modal-content" style="max-width: 800px;">
                                <div class="modal-header">
                                    <h3>My Reports</h3>
                                    <span class="close" onclick="this.closest('.modal').remove()">&times;</span>
                                </div>
                                <div class="modal-body" style="max-height: 600px; overflow-y: auto;">
                                    <div style="margin-bottom: 2rem;">
                                        <h4 style="color: var(--accent-color); margin-bottom: 1rem;">Reports I Made (${data.reports_made.length})</h4>
                                        ${data.reports_made.length > 0 ?
                                            data.reports_made.map(report => `
                                                <div class="report-card">
                                                    <strong>Against: ${report.reported_user_name} (@${report.reported_user_username})</strong>
                                                    ${createReportCard(report, false)}
                                                </div>
                                            `).join('') :
                                            '<p style="color: var(--text-secondary);">You haven\'t made any reports.</p>'
                                        }
                                    </div>
                                    <div>
                                        <h4 style="color: var(--accent-color); margin-bottom: 1rem;">Reports Against Me (${data.reports_received.length})</h4>
                                        ${data.reports_received.length > 0 ?
                                            data.reports_received.map(report => `
                                                <div class="report-card">
                                                    ${createReportCard(report, false)}
                                                </div>
                                            `).join('') :
                                            '<p style="color: var(--text-secondary);">No reports have been made against you.</p>'
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;

                    document.body.insertAdjacentHTML('beforeend', reportsHtml);
                } else {
                    showNotification('Failed to load your reports', 'error');
                }
            } catch (error) {
                console.error('Error loading my reports:', error);
                showNotification('Error loading reports', 'error');
            }
        }

        // Add event listener for report form
        document.addEventListener('DOMContentLoaded', function() {
            const reportForm = document.getElementById('reportForm');
            if (reportForm) {
                reportForm.addEventListener('submit', submitReport);
            }
        });

        // Reports Section Functions for Main Dashboard
        let currentReportTab = 'made';
        let allReportsData = { reports_made: [], reports_received: [] };

        async function loadAllReports() {
            try {
                const response = await fetch(`${API_URL}/reports/my-reports`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    allReportsData = await response.json();
                    updateReportStats();
                    displayReports(currentReportTab);
                } else {
                    showNotification('Failed to load reports', 'error');
                }
            } catch (error) {
                console.error('Error loading reports:', error);
                showNotification('Error loading reports', 'error');
            }
        }

        function updateReportStats() {
            // Update stats with null checks
            const reportsMadeEl = document.getElementById('reportsMadeCount');
            const reportsReceivedEl = document.getElementById('reportsReceivedCount');
            const pendingReportsEl = document.getElementById('pendingReportsCount');
            const resolvedReportsEl = document.getElementById('resolvedReportsCount');

            if (reportsMadeEl) reportsMadeEl.textContent = allReportsData.reports_made.length;
            if (reportsReceivedEl) reportsReceivedEl.textContent = allReportsData.reports_received.length;

            // Count pending and resolved
            let pendingCount = 0;
            let resolvedCount = 0;

            [...allReportsData.reports_made, ...allReportsData.reports_received].forEach(report => {
                if (report.status === 'pending') pendingCount++;
                if (report.status === 'resolved') resolvedCount++;
            });

            if (pendingReportsEl) pendingReportsEl.textContent = pendingCount;
            if (resolvedReportsEl) resolvedReportsEl.textContent = resolvedCount;
        }

        function switchReportTab(tab) {
            currentReportTab = tab;

            // Update tab buttons
            document.querySelectorAll('.report-tab-btn').forEach(btn => {
                if ((tab === 'made' && btn.textContent.includes('I Made')) ||
                    (tab === 'received' && btn.textContent.includes('About Me'))) {
                    btn.classList.add('active');
                    btn.style.color = 'var(--text-primary)';
                    btn.style.borderBottom = '2px solid var(--primary-gold)';
                } else {
                    btn.classList.remove('active');
                    btn.style.color = 'var(--text-secondary)';
                    btn.style.borderBottom = '2px solid transparent';
                }
            });

            // Show/hide report lists
            const madeList = document.getElementById('reportsMadeList');
            const receivedList = document.getElementById('reportsReceivedList');

            if (tab === 'made') {
                madeList.style.display = 'block';
                receivedList.style.display = 'none';
                displayReportsInSection('made');
            } else {
                madeList.style.display = 'none';
                receivedList.style.display = 'block';
                displayReportsInSection('received');
            }
        }

        async function loadReportsForSection() {
            try {
                const response = await fetch(`${API_URL}/reports/my-reports`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (!response.ok) throw new Error('Failed to load reports');

                allReportsData = await response.json();

                // Update counts
                document.getElementById('reportsMadeCount').textContent = allReportsData.reports_made?.length || 0;
                document.getElementById('reportsReceivedCount').textContent = allReportsData.reports_received?.length || 0;

                // Display reports made by default
                switchReportTab('made');
            } catch (error) {
                console.error('Error loading reports:', error);
                showNotification('Failed to load reports', 'error');
            }
        }

        function displayReportsInSection(tab) {
            const container = tab === 'made' ? document.getElementById('reportsMadeList') : document.getElementById('reportsReceivedList');
            const reports = tab === 'made' ? allReportsData.reports_made : allReportsData.reports_received;

            if (!container) return;

            if (!reports || reports.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                        ${tab === 'made' ? 'You have not made any reports.' : 'No reports have been made about you.'}
                    </div>
                `;
                return;
            }

            container.innerHTML = reports.map(report => `
                <div class="report-card">
                    <div class="report-meta">
                        <div>
                            <strong>${tab === 'made' ? 'Reported' : 'Reporter'}: ${tab === 'made' ? report.reported_user_username : report.reporter_username}</strong>
                            <span style="color: var(--text-secondary); margin-left: 0.5rem;">
                                (${tab === 'made' ? report.reported_user_name : report.reporter_name})
                            </span>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            ${tab === 'made' ? `
                                <button class="btn-icon btn-secondary" onclick="editReport(${report.id}, '${report.reason.replace(/'/g, "\\'")}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-icon btn-danger" onclick="deleteReport(${report.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                            <span class="badge ${report.status === 'pending' ? 'badge-warning' : report.status === 'resolved' ? 'badge-success' : 'badge-info'}">${report.status}</span>
                        </div>
                    </div>
                    <div class="report-reason">
                        ${report.reason}
                    </div>
                    <div class="report-time">
                        Reported on ${new Date(report.created_at).toLocaleDateString()}
                    </div>
                </div>
            `).join('');
        }

        function displayReports(tab) {
            const containerId = tab === 'made' ? 'reportsMadeList' : 'reportsReceivedList';
            const container = document.getElementById(containerId);

            if (!container) {
                console.error(`Reports container not found: ${containerId}`);
                return;
            }

            const reports = tab === 'made' ? allReportsData.reports_made : allReportsData.reports_received;

            if (reports.length === 0) {
                container.innerHTML = `
                    <p style="color: var(--text-secondary); text-align: center; padding: 2rem;">
                        ${tab === 'made' ? "You haven't made any reports yet." : "No reports have been made against you."}
                    </p>
                `;
                return;
            }

            container.innerHTML = reports.map(report => `
                <div class="report-card" style="
                    background: var(--bg-secondary);
                    border: 1px solid var(--border-color);
                    border-radius: 0.75rem;
                    padding: 1.5rem;
                    margin-bottom: 1rem;
                    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                ">
                    <div class="report-meta" style="
                        display: flex;
                        justify-content: space-between;
                        align-items: flex-start;
                        margin-bottom: 1rem;
                    ">
                        <div>
                            <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">
                                ${tab === 'made' ?
                                    `Report against ${report.reported_user_name} (@${report.reported_user_username})` :
                                    `Reported by ${report.reporter_name} (@${report.reporter_username})`
                                }
                            </h4>
                            <div style="color: var(--text-secondary); font-size: 0.875rem;">
                                <i class="fas fa-calendar"></i> ${new Date(report.created_at).toLocaleDateString()}
                            </div>
                        </div>
                        <span class="report-status ${report.status.toLowerCase()}" style="
                            padding: 0.25rem 0.75rem;
                            border-radius: 1rem;
                            font-size: 0.75rem;
                            font-weight: 600;
                            text-transform: uppercase;
                        ">${report.status}</span>
                    </div>

                    <div class="report-reason" style="
                        background: var(--bg-primary);
                        border: 1px solid var(--border-color);
                        border-radius: 0.5rem;
                        padding: 1rem;
                        margin: 1rem 0;
                        color: var(--text-primary);
                    ">
                        <strong style="color: var(--accent-color);">Reason:</strong><br>
                        ${report.reason}
                    </div>

                    ${tab === 'made' && report.status === 'pending' ? `
                        <div class="report-actions" style="
                            display: flex;
                            gap: 0.75rem;
                            margin-top: 1rem;
                        ">
                            <button class="btn-secondary" onclick="editMainReport(${report.id}, '${report.reason.replace(/'/g, "\\'")}')" style="
                                padding: 0.5rem 1rem;
                                border-radius: 0.375rem;
                                font-size: 0.875rem;
                            ">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn-danger" onclick="deleteMainReport(${report.id})" style="
                                background: #dc3545;
                                color: #fff;
                                padding: 0.5rem 1rem;
                                border-radius: 0.375rem;
                                border: none;
                                cursor: pointer;
                                font-size: 0.875rem;
                            ">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        async function editMainReport(reportId, currentReason) {
            const newReason = prompt('Edit your report reason:', currentReason);
            if (newReason && newReason !== currentReason) {
                try {
                    const response = await fetch(`${API_URL}/reports/${reportId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${authToken}`
                        },
                        body: JSON.stringify({ reason: newReason })
                    });

                    if (response.ok) {
                        showNotification('Report updated successfully', 'success');
                        loadAllReports();
                    } else {
                        const errorData = await response.json();
                        showNotification(errorData.detail || 'Failed to update report', 'error');
                    }
                } catch (error) {
                    console.error('Error updating report:', error);
                    showNotification('Error updating report', 'error');
                }
            }
        }

        async function deleteMainReport(reportId) {
            if (!confirm('Are you sure you want to delete this report?')) {
                return;
            }

            try {
                const response = await fetch(`${API_URL}/reports/${reportId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    showNotification('Report deleted successfully', 'success');
                    loadAllReports();
                } else {
                    const errorData = await response.json();
                    showNotification(errorData.detail || 'Failed to delete report', 'error');
                }
            } catch (error) {
                console.error('Error deleting report:', error);
                showNotification('Error deleting report', 'error');
            }
        }

        // Load reports when dashboard loads
        window.addEventListener('load', () => {
            if (authToken) {
                setTimeout(loadAllReports, 2000); // Load after other data
            }
        });

        // Home section stats
        async function updateHomeStats() {
            try {
                const friendCount = document.querySelectorAll('#friendsList .user-card').length;
                const messageCount = document.querySelectorAll('#conversationsList .conversation-item').length;

                // Get promotions count
                const promotionsResponse = await fetch(`${API_URL}/promotions/available`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const promos = promotionsResponse.ok ? await promotionsResponse.json() : [];

                document.getElementById('homeTotalFriends').textContent = friendCount || 0;
                document.getElementById('homeTotalMessages').textContent = messageCount || 0;
                document.getElementById('homeActivePromos').textContent = promos.length || 0;

                // Initialize memory game when home section loads
                startMemoryGame();
            } catch (error) {
                console.error('Failed to update home stats:', error);
            }
        }

        // Casino Games Functions
        // Dice Game
        let diceStreak = 0;

        function rollDice() {
            const button = document.getElementById('rollButton');
            const diceDisplay = document.getElementById('diceDisplay');
            const diceResult = document.getElementById('diceResult');
            const diceBet = parseInt(document.getElementById('diceBet').value);

            if (diceBet < 1 || diceBet > 12) {
                showNotification('Bet must be between 1 and 12!', 'error');
                return;
            }

            button.disabled = true;
            diceDisplay.style.animation = 'shake 0.5s';

            setTimeout(() => {
                const dice1 = Math.floor(Math.random() * 6) + 1;
                const dice2 = Math.floor(Math.random() * 6) + 1;
                const total = dice1 + dice2;

                const diceEmojis = ['', 'âš€', 'âš', 'âš‚', 'âšƒ', 'âš„', 'âš…'];
                diceDisplay.textContent = diceEmojis[dice1] + diceEmojis[dice2];

                if (total === diceBet) {
                    diceResult.textContent = `ðŸŽ¯ Perfect! You rolled ${total}!`;
                    diceResult.style.color = '#4CAF50';
                    diceStreak++;
                    document.getElementById('diceStreak').textContent = diceStreak;
                    confettiEffect();
                } else {
                    diceResult.textContent = `You rolled ${total}. Try again!`;
                    diceResult.style.color = '#f44336';
                    diceStreak = 0;
                    document.getElementById('diceStreak').textContent = diceStreak;
                }

                button.disabled = false;
                diceDisplay.style.animation = '';
            }, 500);
        }

        // Slot Machine Game
        let slotWins = 0;
        let slotLosses = 0;
        const slotSymbols = ['ðŸ’', 'ðŸ‹', 'ðŸ””', 'ðŸ’Ž', '7ï¸âƒ£', 'ðŸ€', 'â­'];

        function spinSlots() {
            const button = document.getElementById('spinButton');
            const reel1 = document.getElementById('reel1');
            const reel2 = document.getElementById('reel2');
            const reel3 = document.getElementById('reel3');
            const slotResult = document.getElementById('slotResult');

            button.disabled = true;

            // Spinning animation
            let spins = 0;
            const spinInterval = setInterval(() => {
                reel1.textContent = slotSymbols[Math.floor(Math.random() * slotSymbols.length)];
                reel2.textContent = slotSymbols[Math.floor(Math.random() * slotSymbols.length)];
                reel3.textContent = slotSymbols[Math.floor(Math.random() * slotSymbols.length)];
                spins++;

                if (spins >= 15) {
                    clearInterval(spinInterval);

                    // Final result
                    const result1 = slotSymbols[Math.floor(Math.random() * slotSymbols.length)];
                    const result2 = slotSymbols[Math.floor(Math.random() * slotSymbols.length)];
                    const result3 = slotSymbols[Math.floor(Math.random() * slotSymbols.length)];

                    reel1.textContent = result1;
                    reel2.textContent = result2;
                    reel3.textContent = result3;

                    if (result1 === result2 && result2 === result3) {
                        if (result1 === '7ï¸âƒ£') {
                            slotResult.textContent = 'ðŸŽ° JACKPOT! Triple 7s!';
                            slotResult.style.color = '#FFD700';
                            confettiEffect();
                        } else {
                            slotResult.textContent = 'ðŸŽ‰ Winner! Three matching symbols!';
                            slotResult.style.color = '#4CAF50';
                        }
                        slotWins++;
                        document.getElementById('slotWins').textContent = slotWins;
                    } else if (result1 === result2 || result2 === result3 || result1 === result3) {
                        slotResult.textContent = 'âœ¨ Two matches! Close one!';
                        slotResult.style.color = '#FFA500';
                    } else {
                        slotResult.textContent = 'No match. Try again!';
                        slotResult.style.color = '#f44336';
                        slotLosses++;
                        document.getElementById('slotLosses').textContent = slotLosses;
                    }

                    button.disabled = false;
                }
            }, 100);
        }

        // Card Memory Game
        let memoryCards = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let moves = 0;
        let gameTimer = null;
        let seconds = 0;
        let isProcessing = false;

        const cardSymbols = ['ðŸ’Ž', 'ðŸŽ°', 'ðŸ€', 'â­', 'ðŸŽ²', 'ðŸ’°', 'ðŸ””', 'ðŸ’'];

        function startMemoryGame() {
            // Reset game state
            memoryCards = [];
            flippedCards = [];
            matchedPairs = 0;
            moves = 0;
            seconds = 0;
            isProcessing = false;

            // Clear timer
            if (gameTimer) {
                clearInterval(gameTimer);
            }

            // Create card pairs
            const cards = [];
            cardSymbols.forEach((symbol, index) => {
                cards.push({ id: index * 2, symbol: symbol, matched: false });
                cards.push({ id: index * 2 + 1, symbol: symbol, matched: false });
            });

            // Shuffle cards
            memoryCards = cards.sort(() => Math.random() - 0.5);

            // Update display
            updateMemoryDisplay();
            document.getElementById('memoryResult').textContent = 'Find all matching pairs!';
            document.getElementById('memoryResult').style.color = 'var(--primary-gold)';

            // Start timer
            gameTimer = setInterval(updateTimer, 1000);
        }

        function updateMemoryDisplay() {
            const board = document.getElementById('gameBoard');
            board.innerHTML = memoryCards.map((card, index) => `
                <div class="memory-card ${card.matched ? 'matched' : ''}"
                     data-index="${index}"
                     onclick="flipCard(${index})"
                     style="
                        background: ${card.matched || flippedCards.includes(index) ?
                            'linear-gradient(135deg, var(--primary-gold), var(--secondary-gold))' :
                            'linear-gradient(135deg, #2a2a3e, #1a1a2e)'};
                        border: 2px solid ${card.matched ? '#4CAF50' : 'var(--primary-gold)'};
                        border-radius: 10px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 2rem;
                        cursor: ${card.matched ? 'default' : 'pointer'};
                        min-height: 70px;
                        transition: all 0.3s ease;
                        transform: ${flippedCards.includes(index) || card.matched ? 'rotateY(0)' : 'rotateY(180deg)'};
                        opacity: ${card.matched ? '0.6' : '1'};
                     ">
                    ${flippedCards.includes(index) || card.matched ? card.symbol : '?'}
                </div>
            `).join('');

            document.getElementById('moveCount').textContent = moves;
            document.getElementById('pairsFound').textContent = `${matchedPairs}/8`;
        }

        function flipCard(index) {
            if (isProcessing || memoryCards[index].matched || flippedCards.includes(index)) {
                return;
            }

            // Flip the card
            flippedCards.push(index);
            updateMemoryDisplay();

            // Check for match when 2 cards are flipped
            if (flippedCards.length === 2) {
                moves++;
                isProcessing = true;

                const [first, second] = flippedCards;

                if (memoryCards[first].symbol === memoryCards[second].symbol) {
                    // Match found!
                    setTimeout(() => {
                        memoryCards[first].matched = true;
                        memoryCards[second].matched = true;
                        matchedPairs++;
                        flippedCards = [];
                        isProcessing = false;
                        updateMemoryDisplay();

                        // Check for win
                        if (matchedPairs === 8) {
                            clearInterval(gameTimer);
                            const resultDiv = document.getElementById('memoryResult');
                            resultDiv.textContent = `ðŸŽ‰ Congratulations! You won in ${moves} moves and ${formatTime(seconds)}!`;
                            resultDiv.style.color = '#4CAF50';
                            confettiEffect();
                        }
                    }, 500);
                } else {
                    // No match
                    setTimeout(() => {
                        flippedCards = [];
                        isProcessing = false;
                        updateMemoryDisplay();
                    }, 1000);
                }
            }
        }

        function updateTimer() {
            seconds++;
            document.getElementById('gameTimer').textContent = formatTime(seconds);
        }

        function formatTime(totalSeconds) {
            const minutes = Math.floor(totalSeconds / 60);
            const secs = totalSeconds % 60;
            return `${minutes}:${secs.toString().padStart(2, '0')}`;
        }

        // Confetti effect for wins
        function confettiEffect() {
            const colors = ['#FFD700', '#FF6B6B', '#4CAF50', '#4FC3F7', '#BA68C8'];
            const confetti = [];

            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.style.position = 'fixed';
                particle.style.width = '10px';
                particle.style.height = '10px';
                particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = '-10px';
                particle.style.borderRadius = '50%';
                particle.style.zIndex = '9999';
                particle.style.pointerEvents = 'none';
                document.body.appendChild(particle);
                confetti.push(particle);

                let pos = -10;
                const fall = setInterval(() => {
                    pos += Math.random() * 5 + 2;
                    particle.style.top = pos + 'px';
                    particle.style.transform = `translateX(${Math.sin(pos / 10) * 20}px) rotate(${pos * 2}deg)`;

                    if (pos > window.innerHeight) {
                        clearInterval(fall);
                        particle.remove();
                    }
                }, 20);
            }
        }

        // Add animations for games
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-10px); }
                75% { transform: translateX(10px); }
            }
            .memory-card {
                transform-style: preserve-3d;
                perspective: 1000px;
            }
            .memory-card:hover:not(.matched) {
                transform: scale(1.05) !important;
                box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>