<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŽ° Casino Royal Client Dashboard ðŸŽ²</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gold: #FFD700;
            --secondary-gold: #FFA500;
            --neon-red: #FF073A;
            --neon-blue: #0DCDFF;
            --neon-green: #39FF14;
            --neon-purple: #BC13FE;
            --casino-red: #CC0000;
            --casino-green: #00AA00;
            --bg-dark: #0a0a0a;
            --bg-darker: #000000;
            --bg-casino: #1a0000;
            --text-primary: #ffffff;
            --text-secondary: #e0e0e0;
            --text-accessible: #ffffff;
            --text-neon: #00FFFF;
            --focus-ring: 3px solid #00FFFF;
            --success: #39FF14;
            --danger: #FF073A;
            --info: #0DCDFF;

            /* Animation control variables */
            --animation-duration: 2s;
            --animation-intensity: 1;
            --glow-opacity: 0.8;
        }

        /* Accessibility: Reduced Motion Support */
        @media (prefers-reduced-motion: reduce) {
            :root {
                --animation-duration: 0.01ms;
                --animation-intensity: 0;
                --glow-opacity: 0.3;
            }

            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                transform: none !important;
            }
        }

        /* Focus Management */
        *:focus {
            outline: var(--focus-ring);
            outline-offset: 2px;
        }

        body {
            font-family: 'Orbitron', 'Segoe UI', monospace;
            background: radial-gradient(circle at center, #1a0000 0%, #000000 50%, #0a0000 100%);
            background-attachment: fixed;
            color: var(--text-primary);
            display: flex;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* Casino Background Effects */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(circle at 20% 80%, var(--neon-red) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, var(--neon-blue) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, var(--primary-gold) 0%, transparent 50%);
            opacity: calc(0.05 * var(--glow-opacity));
            z-index: -1;
            animation: casino-glow 12s ease-in-out infinite alternate;
            will-change: opacity;
            transform: translateZ(0);
        }

        @keyframes casino-glow {
            0% { opacity: calc(0.03 * var(--glow-opacity)); }
            100% { opacity: calc(0.08 * var(--glow-opacity)); }
        }

        /* Optimized Neon text effects */
        .neon-text {
            text-shadow:
                0 0 5px currentColor,
                0 0 10px currentColor,
                0 0 15px currentColor;
            animation: neon-flicker 3s ease-in-out infinite alternate;
        }

        @keyframes neon-flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, rgba(26, 0, 0, 0.9) 0%, rgba(10, 0, 0, 0.95) 100%);
            border-right: 2px solid var(--primary-gold);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            position: relative;
        }

        .sidebar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 215, 0, 0.05), transparent);
            pointer-events: none;
        }

        .sidebar.collapsed {
            width: 80px;
        }

        .logo-section {
            padding: 2rem;
            border-bottom: 2px solid var(--primary-gold);
            text-align: center;
            background: rgba(255, 215, 0, 0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
        }

        .logo i {
            font-size: 2.5rem;
            color: var(--primary-gold);
            text-shadow: 0 0 10px var(--primary-gold);
            animation: neon-flicker 3s ease-in-out infinite alternate;
        }

        .logo-text {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary-gold), var(--secondary-gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .sidebar.collapsed .logo-text {
            display: none;
        }

        /* User Profile in Sidebar */
        .user-profile {
            padding: 1.5rem;
            border-bottom: 2px solid var(--primary-gold);
            text-align: center;
            background: rgba(255, 215, 0, 0.05);
        }

        .user-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-gold), var(--secondary-gold));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--bg-dark);
            box-shadow:
                0 0 15px rgba(255, 215, 0, 0.6),
                inset 0 0 15px rgba(255, 255, 255, 0.2);
            animation: avatar-glow 3s ease-in-out infinite alternate;
        }

        @keyframes avatar-glow {
            0% { box-shadow: 0 0 15px rgba(255, 215, 0, 0.6), inset 0 0 15px rgba(255, 255, 255, 0.2); }
            100% { box-shadow: 0 0 25px rgba(255, 215, 0, 0.8), inset 0 0 15px rgba(255, 255, 255, 0.3); }
        }

        .user-name {
            font-weight: 700;
            margin-bottom: 0.25rem;
            color: var(--primary-gold);
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
        }

        .user-role {
            font-size: 0.875rem;
            color: var(--neon-blue);
            text-shadow: 0 0 5px var(--neon-blue);
            font-weight: 600;
        }

        .user-id {
            font-size: 0.75rem;
            color: #888;
            margin-top: 0.25rem;
        }

        .sidebar.collapsed .user-name,
        .sidebar.collapsed .user-role,
        .sidebar.collapsed .user-id {
            display: none;
        }

        /* Navigation Menu */
        .nav-menu {
            flex: 1;
            padding: 1rem 0;
            overflow-y: auto;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 1rem 1.5rem;
            color: var(--text-primary);
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            font-weight: 600;
            border-left: 4px solid transparent;
        }

        .nav-item::after {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border: 6px solid transparent;
            border-right-color: var(--primary-gold);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .nav-item:hover {
            background: rgba(255, 215, 0, 0.15);
            color: var(--primary-gold);
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
            border-left-color: var(--primary-gold);
            box-shadow: inset 0 0 20px rgba(255, 215, 0, 0.1);
        }

        .nav-item.active {
            background: rgba(255, 215, 0, 0.25);
            border-left-color: var(--primary-gold);
            color: var(--primary-gold);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
            box-shadow: inset 0 0 25px rgba(255, 215, 0, 0.15);
        }

        .nav-item.active::after {
            opacity: 1;
        }

        .nav-item i {
            font-size: 1.25rem;
            width: 30px;
            text-align: center;
            color: var(--primary-gold);
            text-shadow: 0 0 5px currentColor;
        }

        .nav-item span {
            margin-left: 1rem;
            font-weight: 600;
        }

        .nav-badge {
            margin-left: auto;
            background: #ff4444;
            color: white;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-weight: 600;
        }

        .sidebar.collapsed .nav-item span,
        .sidebar.collapsed .nav-badge {
            display: none;
        }

        .sidebar.collapsed .nav-item {
            justify-content: center;
            padding: 1rem;
        }

        .sidebar.collapsed .nav-item i {
            margin: 0;
        }

        /* Toggle Button */
        .toggle-btn {
            padding: 1rem;
            border-top: 1px solid rgba(255, 215, 0, 0.1);
            text-align: center;
        }

        .toggle-btn button {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            color: #FFD700;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .toggle-btn button:hover {
            background: rgba(255, 215, 0, 0.2);
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: linear-gradient(135deg, rgba(10, 0, 0, 0.95), rgba(26, 0, 0, 0.9));
            backdrop-filter: blur(5px);
            position: relative;
        }

        .main-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 70% 30%, rgba(255, 215, 0, 0.03), transparent 50%);
            pointer-events: none;
        }

        /* Top Header */
        .top-header {
            background: linear-gradient(135deg, rgba(26, 0, 0, 0.9), rgba(22, 33, 62, 0.8));
            backdrop-filter: blur(15px);
            border-bottom: 2px solid var(--primary-gold);
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 20px rgba(255, 215, 0, 0.2);
            position: relative;
            z-index: 10;
        }

        .top-header::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary-gold), transparent);
            animation: header-glow 3s ease-in-out infinite alternate;
        }

        @keyframes header-glow {
            0% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .header-title {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .notification-btn {
            position: relative;
            background: rgba(255, 215, 0, 0.1);
            border: none;
            color: #FFD700;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .notification-btn:hover {
            background: rgba(255, 215, 0, 0.2);
        }

        .notification-dot {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 8px;
            height: 8px;
            background: #ff4444;
            border-radius: 50%;
        }

        .logout-btn {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid rgba(255, 0, 0, 0.3);
            color: #ff6b6b;
            padding: 0.5rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: rgba(255, 0, 0, 0.2);
        }

        /* Content Sections */
        .content-area {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            display: none;
        }

        .content-area.active {
            display: block;
        }

        /* Dashboard Section */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(26, 26, 46, 0.6);
            border: 1px solid rgba(255, 215, 0, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.1);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .stat-icon i {
            font-size: 1.5rem;
            color: #1a1a2e;
        }

        .stat-label {
            color: #888;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #FFD700;
        }

        /* Players Section */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .search-bar {
            display: flex;
            gap: 0.5rem;
        }

        .search-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.2);
            color: #fff;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            width: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border: none;
            color: #1a1a2e;
            padding: 0.5rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.3);
        }

        /* Table */
        .table-container {
            background: rgba(26, 26, 46, 0.6);
            border: 1px solid rgba(255, 215, 0, 0.1);
            border-radius: 12px;
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: rgba(255, 215, 0, 0.1);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: #FFD700;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        tr:hover {
            background: rgba(255, 215, 0, 0.05);
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status-active {
            background: rgba(0, 255, 0, 0.1);
            color: #00ff00;
            border: 1px solid rgba(0, 255, 0, 0.3);
        }

        .status-inactive {
            background: rgba(255, 0, 0, 0.1);
            color: #ff6b6b;
            border: 1px solid rgba(255, 0, 0, 0.3);
        }

        /* Messages Section */
        .messages-container {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 1.5rem;
            height: calc(100vh - 200px);
        }

        .conversations-panel {
            background: rgba(26, 26, 46, 0.6);
            border: 1px solid rgba(255, 215, 0, 0.1);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
        }

        .conversations-header {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 215, 0, 0.1);
        }

        .conversations-list {
            flex: 1;
            padding: 0.75rem;
            overflow-y: auto;
            overflow-x: hidden;
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 215, 0, 0.3) transparent;
        }

        .conversations-list::-webkit-scrollbar {
            width: 6px;
        }

        .conversations-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .conversations-list::-webkit-scrollbar-thumb {
            background: rgba(255, 215, 0, 0.3);
            border-radius: 3px;
            transition: background 0.3s ease;
        }

        .conversations-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 215, 0, 0.5);
        }

        .conversation-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .conversation-item:hover {
            background: rgba(255, 215, 0, 0.05);
        }

        .conversation-item.active {
            background: rgba(255, 215, 0, 0.1);
            border-left: 3px solid #FFD700;
        }

        .conversation-avatar {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            position: relative;
            font-weight: bold;
            color: #1a1a2e;
        }

        .conversation-info {
            flex: 1;
            min-width: 0;
        }

        .conversation-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .conversation-last-msg {
            font-size: 0.875rem;
            color: #888;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .conversation-badge {
            background: #ff4444;
            color: white;
            font-size: 0.75rem;
            padding: 0.2rem 0.4rem;
            border-radius: 10px;
            margin-left: 0.5rem;
        }

        /* Chat Area */
        .chat-panel {
            background: rgba(26, 26, 46, 0.6);
            border: 1px solid rgba(255, 215, 0, 0.1);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
        }

        .chat-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid rgba(255, 215, 0, 0.1);
            display: flex;
            align-items: center;
        }

        .chat-user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .messages-area {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 1.5rem;
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 215, 0, 0.3) transparent;
            scroll-behavior: smooth;
        }

        .messages-area::-webkit-scrollbar {
            width: 6px;
        }

        .messages-area::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .messages-area::-webkit-scrollbar-thumb {
            background: rgba(255, 215, 0, 0.3);
            border-radius: 3px;
            transition: background 0.3s ease;
        }

        .messages-area::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 215, 0, 0.5);
        }

        .message {
            display: flex;
            margin-bottom: 1rem;
            animation: fadeInMessage 0.3s ease-out;
            opacity: 0;
            animation-fill-mode: forwards;
        }

        .message.own {
            justify-content: flex-end;
        }

        .message-bubble {
            max-width: 70%;
            padding: 0.75rem 1rem;
            border-radius: 15px;
            background: rgba(255, 215, 0, 0.1);
            transition: all 0.2s ease;
            position: relative;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            word-wrap: break-word;
        }

        .message-bubble:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        @keyframes fadeInMessage {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.own .message-bubble {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 165, 0, 0.2));
        }

        .message-time {
            font-size: 0.75rem;
            color: #888;
            margin-top: 0.25rem;
        }

        .chat-input-area {
            padding: 1rem;
            background: rgba(255, 215, 0, 0.05);
            border-top: 1px solid rgba(255, 215, 0, 0.1);
            display: flex;
            gap: 0.5rem;
        }

        .chat-input {
            flex: 1;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 10px;
            color: #fff;
            outline: none;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .chat-input:focus {
            border-color: rgba(255, 215, 0, 0.5);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.1);
        }

        .chat-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            border: 2px solid var(--primary-gold);
            background: rgba(255, 215, 0, 0.1);
            color: var(--primary-gold);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-family: 'Orbitron', sans-serif;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.3), transparent);
            transition: left 0.5s ease;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            background: rgba(255, 215, 0, 0.2);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.5);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .chat-btn {
            background: rgba(255, 215, 0, 0.1);
            border: none;
            color: #FFD700;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .chat-btn:hover {
            background: rgba(255, 215, 0, 0.2);
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.2);
        }

        .chat-btn:active {
            transform: scale(0.95);
        }

        .chat-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .chat-btn:hover::before {
            left: 100%;
        }

        .send-btn {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #1a1a2e;
        }

        /* Settings Section */
        .settings-grid {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 1.5rem;
        }

        .settings-nav {
            background: rgba(26, 26, 46, 0.6);
            border: 1px solid rgba(255, 215, 0, 0.1);
            border-radius: 12px;
            padding: 1rem;
        }

        .settings-nav-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            margin-bottom: 0.5rem;
        }

        .settings-nav-item:hover {
            background: rgba(255, 215, 0, 0.05);
        }

        .settings-nav-item.active {
            background: rgba(255, 215, 0, 0.1);
            border-left: 3px solid #FFD700;
        }

        .settings-nav-item i {
            margin-right: 1rem;
            color: #FFD700;
        }

        .settings-content {
            background: rgba(26, 26, 46, 0.6);
            border: 1px solid rgba(255, 215, 0, 0.1);
            border-radius: 12px;
            padding: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: #FFD700;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.2);
            color: #fff;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            outline: none;
        }

        .form-input:focus {
            border-color: #FFD700;
        }

        /* Profile Picture Styles */
        .profile-picture-section {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .profile-picture-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 2px solid rgba(255, 215, 0, 0.3);
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.05);
            position: relative;
        }

        .profile-picture-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-picture-placeholder {
            text-align: center;
            color: #666;
        }

        .profile-picture-actions {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .profile-picture-actions button {
            min-width: 140px;
        }

        /* Payment Methods Styles */
        .payment-methods-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .payment-method-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 215, 0, 0.2);
            border-radius: 12px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            position: relative;
        }

        .payment-method-card:hover {
            border-color: rgba(255, 215, 0, 0.4);
            background: rgba(255, 255, 255, 0.08);
        }

        .payment-method-card.selected {
            border-color: var(--primary-gold);
            background: rgba(255, 215, 0, 0.1);
        }

        .payment-method-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .payment-method-icon img {
            width: 32px;
            height: 32px;
            object-fit: contain;
        }

        .payment-method-info {
            flex: 1;
        }

        .payment-method-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .payment-method-type {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .payment-method-checkbox {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .payment-method-checkbox.checked {
            background: var(--primary-gold);
            border-color: var(--primary-gold);
        }

        .payment-method-checkbox.checked::after {
            content: 'âœ“';
            color: var(--bg-dark);
            font-weight: bold;
            font-size: 0.8rem;
        }

        .loading-spinner {
            text-align: center;
            color: var(--text-secondary);
            padding: 2rem;
        }

        /* Profile Payment Methods */
        .profile-payment-methods {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .profile-payment-method {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 8px;
            padding: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            min-width: 120px;
        }

        .profile-payment-method-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .profile-payment-method-icon img {
            width: 24px;
            height: 24px;
            object-fit: contain;
        }

        .profile-payment-method-name {
            font-size: 0.9rem;
            color: var(--text-primary);
            font-weight: 500;
        }

        /* Profile Available Games */
        .profile-available-games {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 0.75rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .profile-game-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 8px;
            padding: 0.5rem;
            text-align: center;
            transition: transform 0.2s ease;
        }

        .profile-game-card:hover {
            transform: translateY(-2px);
            background: rgba(255, 215, 0, 0.1);
        }

        .profile-game-icon {
            width: 50px;
            height: 50px;
            margin: 0 auto 0.5rem;
            border-radius: 4px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
        }

        .profile-game-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-game-name {
            font-size: 0.75rem;
            color: var(--text-primary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Games Selection Styles */
        .games-selection-section {
            margin-top: 2rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 10px;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .games-selection-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .games-categories {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .game-category-tab {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 20px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }

        .game-category-tab.active {
            background: rgba(255, 215, 0, 0.2);
            border-color: var(--primary-gold);
            color: var(--primary-gold);
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 1rem;
            max-height: 400px;
            overflow-y: auto;
            padding: 0.5rem;
        }

        .game-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .game-card:hover {
            background: rgba(255, 215, 0, 0.1);
            transform: translateY(-2px);
        }

        .game-card.selected {
            border-color: var(--primary-gold);
            background: rgba(255, 215, 0, 0.15);
        }

        .game-icon {
            width: 60px;
            height: 60px;
            margin: 0 auto 0.5rem;
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
        }

        .game-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .game-name {
            font-size: 0.85rem;
            color: var(--text-primary);
            margin: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .selected-count {
            color: var(--primary-gold);
            font-weight: bold;
        }

        .profile-section {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
        }

        /* Friends Section */
        .friends-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .friend-card {
            background: rgba(26, 26, 46, 0.6);
            border: 1px solid rgba(255, 215, 0, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.3s ease;
        }

        .friend-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.1);
        }

        .friend-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: #1a1a2e;
            position: relative;
        }

        .online-indicator {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid #1a1a2e;
            z-index: 2;
        }

        .online-indicator.online {
            background: #4CAF50;
            box-shadow: 0 0 8px rgba(76, 175, 80, 0.6);
        }

        .online-indicator.offline {
            background: #f44336;
        }

        .online-indicator.away {
            background: #FF9800;
        }

        .last-seen {
            font-size: 0.75rem;
            color: #888;
            margin-top: 2px;
        }

        .friend-info {
            flex: 1;
        }

        .friend-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .friend-id {
            font-size: 0.875rem;
            color: #888;
        }

        .friend-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-icon {
            background: rgba(255, 215, 0, 0.1);
            border: none;
            color: #FFD700;
            width: 35px;
            height: 35px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-icon:hover {
            background: rgba(255, 215, 0, 0.2);
        }

        .btn-danger {
            background: rgba(255, 0, 0, 0.1);
            color: #ff6b6b;
        }

        .btn-danger:hover {
            background: rgba(255, 0, 0, 0.2);
        }

        /* Reviews */
        .review-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
        }

        .tab-btn {
            padding: 1rem 2rem;
            background: none;
            border: none;
            color: #b8b8b8;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            color: #FFD700;
            border-bottom-color: #FFD700;
        }

        .tab-btn:hover {
            color: #FFD700;
        }

        .reviews-list {
            display: grid;
            gap: 1rem;
        }

        .review-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 10px;
            border: 1px solid rgba(255, 215, 0, 0.1);
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .review-user {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .review-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #1a1a2e;
        }

        .review-info h4 {
            margin: 0;
            color: #FFD700;
        }

        .review-date {
            color: #b8b8b8;
            font-size: 0.85rem;
        }

        .review-rating {
            display: flex;
            gap: 0.25rem;
        }

        .star {
            color: #FFD700;
            font-size: 1.2rem;
        }

        .star.empty {
            color: #333;
        }

        .review-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #FFD700;
            margin: 1rem 0 0.5rem;
        }

        .review-comment {
            color: #e0e0e0;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .review-actions {
            display: flex;
            gap: 0.5rem;
        }

        .review-actions button {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .btn-edit {
            background: rgba(33, 150, 243, 0.2);
            color: #2196f3;
        }

        .btn-delete {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
        }

        .btn-review {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #1a1a2e;
            font-weight: 600;
        }

        .reviewable-player-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 10px;
            border: 1px solid rgba(255, 215, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .player-details {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            color: #FFD700;
            margin-bottom: 0.25rem;
        }

        .user-id {
            color: #b8b8b8;
            font-size: 0.85rem;
            margin-bottom: 0.25rem;
        }

        .user-stats {
            color: #888;
            font-size: 0.8rem;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: #1a1a2e;
            border: 1px solid #FFD700;
            border-radius: 15px;
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            color: #FFD700;
            font-size: 1.5rem;
        }

        .close-btn {
            background: none;
            border: none;
            color: #FFD700;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 0.25rem;
            line-height: 1;
        }

        .close-btn:hover {
            color: #FFA500;
            transform: scale(1.1);
        }

        .rating-input {
            display: flex;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .rating-star {
            font-size: 2rem;
            color: #333;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .rating-star.active,
        .rating-star:hover {
            color: #FFD700;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #1a1a2e;
            border: 1px solid #FFD700;
            border-radius: 8px;
            padding: 1rem 1.5rem;
            color: #FFD700;
            display: none;
            z-index: 10000;
            animation: slideIn 0.3s ease;
        }

        .notification.show {
            display: block;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Login/Register Forms */
        .auth-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
        }

        .auth-card {
            background: rgba(26, 26, 46, 0.9);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 20px;
            padding: 3rem;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .auth-logo {
            font-size: 3rem;
            color: #FFD700;
            margin-bottom: 1rem;
        }

        .auth-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .auth-subtitle {
            color: #888;
        }

        .auth-form {
            margin-top: 2rem;
        }

        .auth-footer {
            text-align: center;
            margin-top: 2rem;
            color: #888;
        }

        .auth-footer a {
            color: #FFD700;
            text-decoration: none;
        }

        .hidden {
            display: none !important;
        }

        /* Game Credentials Section */
        .credentials-section {
            background: rgba(255, 215, 0, 0.02);
            border-radius: 8px;
            animation: slideIn 0.3s ease-out;
        }

        .credentials-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .credentials-header h4 {
            color: #FFD700;
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .btn-small {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            color: #FFD700;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-small:hover {
            background: rgba(255, 215, 0, 0.2);
            border-color: rgba(255, 215, 0, 0.5);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(255, 215, 0, 0.1);
        }

        .credential-form {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 215, 0, 0.1);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            animation: fadeIn 0.3s ease-out;
        }

        .credential-form .form-group {
            margin-bottom: 1rem;
        }

        .credential-form label {
            display: block;
            color: #FFD700;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .credential-form input,
        .credential-form select {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.2);
            color: #fff;
            padding: 0.75rem;
            border-radius: 6px;
            outline: none;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .credential-form input:focus,
        .credential-form select:focus {
            border-color: rgba(255, 215, 0, 0.5);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.1);
        }

        .credentials-list {
            max-height: 300px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 215, 0, 0.3) transparent;
        }

        .credentials-list::-webkit-scrollbar {
            width: 4px;
        }

        .credentials-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 2px;
        }

        .credentials-list::-webkit-scrollbar-thumb {
            background: rgba(255, 215, 0, 0.3);
            border-radius: 2px;
        }

        .credential-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 215, 0, 0.1);
            border-radius: 6px;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
            animation: fadeInUp 0.3s ease-out;
        }

        .credential-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 215, 0, 0.2);
            transform: translateY(-1px);
        }

        .credential-item h5 {
            color: #FFD700;
            margin: 0 0 0.5rem 0;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .credential-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .credential-info span {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.8rem;
        }

        .credential-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }

        .btn-edit,
        .btn-delete {
            padding: 0.4rem 0.8rem;
            border: none;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .btn-edit {
            background: rgba(52, 152, 219, 0.2);
            color: #3498db;
            border: 1px solid rgba(52, 152, 219, 0.3);
        }

        .btn-edit:hover {
            background: rgba(52, 152, 219, 0.3);
            transform: translateY(-1px);
        }

        .btn-delete {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        .btn-delete:hover {
            background: rgba(231, 76, 60, 0.3);
            transform: translateY(-1px);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                z-index: 1000;
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .messages-container {
                grid-template-columns: 1fr;
            }

            .conversations-panel {
                display: none;
            }

            .settings-grid {
                grid-template-columns: 1fr;
            }

            .settings-nav {
                display: none;
            }
        }
        /* Promotions Styles */
        .promotions-list {
            display: grid;
            gap: 1rem;
            margin-top: 1rem;
        }

        .promotion-card {
            background: rgba(26, 26, 46, 0.6);
            border: 1px solid rgba(255, 215, 0, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .promotion-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.1);
        }

        .promotion-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .promotion-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #FFD700;
        }

        .promotion-type {
            background: rgba(255, 215, 0, 0.15);
            color: #FFD700;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            text-transform: uppercase;
        }

        .promotion-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .promotion-status.active {
            background: rgba(76, 175, 80, 0.15);
            color: #4CAF50;
        }

        .promotion-status.expired {
            background: rgba(244, 67, 54, 0.15);
            color: #f44336;
        }

        .promotion-status.depleted {
            background: rgba(255, 152, 0, 0.15);
            color: #ff9800;
        }

        .promotion-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .promotion-detail {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .promotion-detail i {
            color: #FFD700;
            width: 20px;
        }

        .promotion-detail-label {
            color: #888;
            font-size: 0.875rem;
        }

        .promotion-detail-value {
            font-weight: 600;
        }

        .promotion-progress {
            margin: 1rem 0;
        }

        .promotion-progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .promotion-progress-bar {
            background: rgba(255, 215, 0, 0.1);
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
        }

        .promotion-progress-fill {
            background: linear-gradient(90deg, #FFD700, #FFA500);
            height: 100%;
            transition: width 0.3s ease;
        }

        .promotion-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        /* Profile Modal Styles */
        .profile-modal {
            max-width: 700px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .profile-modal-content {
            padding: 1rem;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 2rem;
            padding: 1.5rem;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 165, 0, 0.1));
            border-radius: 10px;
            margin-bottom: 2rem;
        }

        .profile-avatar-large {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: bold;
            color: #1a1a2e;
        }

        .profile-main-info h3 {
            color: #FFD700;
            margin-bottom: 0.5rem;
            font-size: 1.5rem;
        }

        .profile-username {
            color: #b8b8b8;
            margin-bottom: 0.5rem;
        }

        .profile-type-badge {
            display: inline-block;
            padding: 0.25rem 1rem;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #1a1a2e;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .profile-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .profile-stat-card {
            background: rgba(255, 215, 0, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
        }

        .profile-stat-card .stat-value {
            font-size: 2rem;
            color: #FFD700;
            font-weight: bold;
        }

        .profile-stat-card .stat-label {
            color: #b8b8b8;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .profile-info-section {
            margin-bottom: 2rem;
            padding: 1rem;
            background: rgba(255, 215, 0, 0.02);
            border-radius: 10px;
        }

        .profile-info-section h4 {
            color: #FFD700;
            margin-bottom: 1rem;
        }

        .profile-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .profile-info-item {
            display: flex;
            flex-direction: column;
        }

        .info-label {
            color: #b8b8b8;
            font-size: 0.85rem;
            margin-bottom: 0.25rem;
        }

        .info-value {
            color: #ffffff;
            font-size: 1rem;
        }

        .profile-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 215, 0, 0.3);
        }

        .profile-tab-btn {
            background: none;
            border: none;
            color: #b8b8b8;
            padding: 1rem;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            border-bottom: 2px solid transparent;
        }

        .profile-tab-btn.active {
            color: #FFD700;
            border-bottom-color: #FFD700;
        }

        .profile-tab-btn:hover {
            color: #FFA500;
        }

        .profile-tab-content {
            min-height: 200px;
        }

        .profile-tab-pane {
            display: none;
        }

        .profile-tab-pane.active {
            display: block;
        }

        .profile-reviews-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .profile-review-card {
            background: rgba(255, 215, 0, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 10px;
            padding: 1rem;
        }

        .profile-review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .profile-review-rating {
            color: #FFD700;
            font-size: 1.2rem;
        }

        .profile-review-author {
            color: #b8b8b8;
            font-size: 0.9rem;
        }

        .profile-review-title {
            color: #FFD700;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .profile-review-comment {
            color: #ffffff;
            line-height: 1.5;
        }

        .profile-friends-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
        }

        .profile-friend-card {
            background: rgba(255, 215, 0, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .profile-friend-card:hover {
            transform: translateY(-2px);
            border-color: #FFD700;
        }

        .profile-friend-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-radius: 50%;
            margin: 0 auto 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: #1a1a2e;
        }

        .profile-friend-name {
            color: #ffffff;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }

        .profile-friend-username {
            color: #b8b8b8;
            font-size: 0.8rem;
        }

        .profile-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 215, 0, 0.2);
        }

        .profile-link {
            cursor: pointer;
            color: #FFD700;
            text-decoration: none;
            transition: color 0.3s;
        }

        .profile-link:hover {
            color: var(--secondary-gold);
            text-decoration: underline;
            text-shadow: 0 0 5px rgba(255, 165, 0, 0.6);
        }

        /* Additional Casino Theme Enhancements */
        .stat-card, .promotion-card, .friend-card {
            background: linear-gradient(135deg, rgba(26, 0, 0, 0.9), rgba(10, 0, 0, 0.8));
            border: 2px solid var(--primary-gold);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(255, 215, 0, 0.15);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .stat-card:hover, .promotion-card:hover, .friend-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(255, 215, 0, 0.25);
        }

        /* Enhanced Form Elements */
        input, textarea, select {
            background: rgba(26, 0, 0, 0.8) !important;
            border: 2px solid var(--primary-gold) !important;
            color: var(--text-primary) !important;
            font-family: 'Orbitron', sans-serif !important;
            border-radius: 8px !important;
        }

        input:focus, textarea:focus, select:focus {
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5) !important;
            border-color: var(--secondary-gold) !important;
            outline: none !important;
        }

        /* Neon Text for Headers */
        h1, h2, h3, h4 {
            color: var(--primary-gold);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.6);
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
        }

        /* Enhanced Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(26, 0, 0, 0.5);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-gold);
            border-radius: 4px;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-gold);
        }

        /* Performance Optimizations */
        .stat-card, .promotion-card, .friend-card, .btn {
            will-change: transform;
            transform: translateZ(0);
        }

        /* Report Card Styling */
        .report-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            padding: 1.25rem;
            margin-bottom: 1rem;
        }

        .report-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .report-status {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .report-status.pending {
            background: #FFA500;
            color: #000;
        }

        .report-status.reviewed {
            background: #2196F3;
            color: #fff;
        }

        .report-status.resolved {
            background: #4CAF50;
            color: #fff;
        }

        .report-status.dismissed {
            background: #757575;
            color: #fff;
        }

        .report-reason {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 1rem 0;
            color: var(--text-primary);
        }

        .report-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .report-actions button {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            border: none;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }

        .edit-report-btn {
            background: var(--accent-color);
            color: var(--text-primary);
        }

        .delete-report-btn {
            background: #dc3545;
            color: #fff;
        }

        .report-actions button:hover {
            opacity: 0.8;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <!-- Login Section -->
    <div id="loginSection" class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <i class="fas fa-dice auth-logo"></i>
                <h1 class="auth-title">Casino Royale</h1>
                <p class="auth-subtitle">Client Portal</p>
            </div>
            <form id="loginForm" class="auth-form">
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" id="loginUsername" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" id="loginPassword" class="form-input" maxlength="72" required>
                </div>
                <button type="submit" class="btn-primary" style="width: 100%; padding: 1rem;">
                    Login
                </button>
            </form>
            <div class="auth-footer">
                Don't have an account? <a href="#" id="showRegister">Register</a>
            </div>
        </div>
    </div>

    <!-- Register Section -->
    <div id="registerSection" class="auth-container hidden">
        <div class="auth-card">
            <div class="auth-header">
                <i class="fas fa-dice auth-logo"></i>
                <h1 class="auth-title">Casino Royale</h1>
                <p class="auth-subtitle">Create Client Account</p>
            </div>
            <form id="registerForm" class="auth-form">
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" id="fullName" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" id="email" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" id="username" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" id="password" class="form-input" maxlength="72" required>
                    <small style="color: #888; font-size: 0.75rem;">Maximum 72 characters</small>
                </div>
                <div class="form-group">
                    <label class="form-label">Company Name</label>
                    <input type="text" id="companyName" class="form-input" required>
                </div>
                <button type="submit" class="btn-primary" style="width: 100%; padding: 1rem;">
                    Register
                </button>
            </form>
            <div class="auth-footer">
                Already have an account? <a href="#" id="showLogin">Login</a>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboardSection" class="hidden" style="display: flex; width: 100%; height: 100vh;">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="logo-section">
                <div class="logo">
                    <i class="fas fa-dice"></i>
                    <span class="logo-text">Casino Royale</span>
                </div>
            </div>

            <div class="user-profile">
                <div class="user-avatar" id="userAvatar">C</div>
                <div class="user-name" id="userName">Client Name</div>
                <div class="user-role">Client Account</div>
                <div class="user-id" id="userId">ID: XXXXXX</div>
            </div>

            <nav class="nav-menu">
                <a href="#" class="nav-item active" data-section="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-section="players">
                    <i class="fas fa-users"></i>
                    <span>Players</span>
                </a>
                <a href="#" class="nav-item" data-section="friends">
                    <i class="fas fa-user-friends"></i>
                    <span>Friends</span>
                    <span class="nav-badge" id="friendRequestBadge" style="display: none;">0</span>
                </a>
                <a href="#" class="nav-item" data-section="messages">
                    <i class="fas fa-comments"></i>
                    <span>Messages</span>
                    <span class="nav-badge" id="messageBadge" style="display: none;">0</span>
                </a>
                <a href="#" class="nav-item" data-section="promotions">
                    <i class="fas fa-gift"></i>
                    <span>Promotions</span>
                    <span class="nav-badge" id="promotionsBadge" style="display: none;">0</span>
                </a>
                <a href="#" class="nav-item" data-section="analytics">
                    <i class="fas fa-chart-bar"></i>
                    <span>Analytics</span>
                </a>
                <a href="#" class="nav-item" data-section="reviews">
                    <i class="fas fa-star"></i>
                    <span>Reviews</span>
                </a>
                <a href="#" class="nav-item" data-section="reports">
                    <i class="fas fa-flag"></i>
                    <span>Reports</span>
                </a>
                <a href="#" class="nav-item" data-section="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
            </nav>

            <div class="toggle-btn">
                <button onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <header class="top-header">
                <h2 class="header-title" id="headerTitle">Dashboard</h2>
                <div class="header-actions">
                    <button class="notification-btn">
                        <i class="fas fa-bell"></i>
                        <span class="notification-dot"></span>
                    </button>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </header>

            <!-- Dashboard Content -->
            <div class="content-area active" id="dashboard-section">
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-label">Total Players</div>
                        <div class="stat-value" id="totalPlayers">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-user-friends"></i>
                        </div>
                        <div class="stat-label">Friends</div>
                        <div class="stat-value" id="totalFriends">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <div class="stat-label">Messages</div>
                        <div class="stat-value" id="totalMessages">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-label">Pending Requests</div>
                        <div class="stat-value" id="pendingRequests">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-circle" style="color: #4CAF50;"></i>
                        </div>
                        <div class="stat-label">Online Now</div>
                        <div class="stat-value" id="onlineCount">0</div>
                    </div>
                </div>

                <h3 style="margin: 2rem 0 1rem;">Recent Activity</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Activity</th>
                                <th>User</th>
                                <th>Time</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="activityTable">
                            <tr>
                                <td colspan="4" style="text-align: center; color: #888;">Loading activity...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Players Section -->
            <div class="content-area" id="players-section">
                <div class="section-header">
                    <h3 class="section-title">Player Management</h3>
                    <div style="display: flex; gap: 1rem;">
                        <button class="btn-primary" onclick="showRegisterPlayerModal()">
                            <i class="fas fa-user-plus"></i> Register Player
                        </button>
                        <button class="btn-primary" onclick="showBulkRegisterModal()">
                            <i class="fas fa-users"></i> Bulk Register
                        </button>
                    </div>
                </div>

                <div class="dashboard-grid" style="margin-bottom: 2rem;">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-label">Total Players</div>
                        <div class="stat-value" id="myPlayersCount">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <div class="stat-label">Active Players</div>
                        <div class="stat-value" id="activePlayersCount">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-user-clock"></i>
                        </div>
                        <div class="stat-label">New Today</div>
                        <div class="stat-value" id="newPlayersToday">0</div>
                    </div>
                </div>

                <div class="section-header">
                    <h4>My Registered Players</h4>
                    <div class="search-bar">
                        <input type="text" class="search-input" id="playerSearchInput" placeholder="Search players...">
                        <button class="btn-primary" onclick="searchPlayers()">Search</button>
                    </div>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Player Name</th>
                                <th>Username</th>
                                <th>Email</th>
                                <th>Player ID</th>
                                <th>Level</th>
                                <th>Credits</th>
                                <th>Status</th>
                                <th>Registered</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="playersTable">
                            <!-- Players will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Friends Section -->
            <div class="content-area" id="friends-section">
                <div class="section-header">
                    <h3 class="section-title">Friends</h3>
                    <button class="btn-primary" onclick="showAddFriend()">
                        <i class="fas fa-plus"></i> Add Friend
                    </button>
                </div>

                <h4 style="margin: 1.5rem 0 1rem; color: #FFD700;">Friend Requests</h4>
                <div class="friends-grid" id="friendRequests">
                    <!-- Friend requests will be loaded here -->
                </div>

                <h4 style="margin: 1.5rem 0 1rem; color: #FFD700;">My Friends</h4>
                <div class="friends-grid" id="friendsList">
                    <!-- Friends will be loaded here -->
                </div>
            </div>

            <!-- Messages Section -->
            <div class="content-area" id="messages-section">
                <div class="messages-container">
                    <div class="conversations-panel">
                        <div class="conversations-header">
                            <h3>Conversations</h3>
                        </div>
                        <div class="conversations-list" id="conversationsList">
                            <!-- Conversations will be loaded here -->
                        </div>
                    </div>
                    <div class="chat-panel">
                        <div id="emptyChatState" style="flex: 1; display: flex; align-items: center; justify-content: center; flex-direction: column;">
                            <i class="fas fa-comments" style="font-size: 4rem; color: #444; margin-bottom: 1rem;"></i>
                            <h3 style="color: #888;">Select a conversation</h3>
                            <p style="color: #666;">Choose a friend to start chatting</p>
                        </div>
                        <div id="activeChatArea" class="hidden" style="display: flex; flex-direction: column; height: 100%;">
                            <div class="chat-header">
                                <div class="chat-user-info">
                                    <div class="conversation-avatar" id="chatAvatar">U</div>
                                    <div>
                                        <div class="conversation-name" id="chatUserName">User Name</div>
                                        <div id="typingIndicator" style="font-size: 0.875rem; color: #4CAF50; display: none;">
                                            <i class="fas fa-ellipsis-h"></i> typing...
                                        </div>
                                        <div id="onlineStatus" style="font-size: 0.875rem; color: #888;">Online</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Game Credentials Section (only shown for player conversations) -->
                            <div id="gameCredentialsSection" style="display: none; border-bottom: 2px solid var(--primary-gold); background: linear-gradient(135deg, rgba(255, 215, 0, 0.05), rgba(255, 215, 0, 0.02));">
                                <div style="padding: 0.5rem 0.75rem; cursor: pointer; display: flex; align-items: center; justify-content: space-between;" onclick="toggleGameCredentials()">
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <i class="fas fa-key" style="color: var(--primary-gold); font-size: 0.875rem;"></i>
                                        <span style="color: var(--primary-gold); font-size: 0.875rem; font-weight: 600;" id="gameCredentialsTitle">
                                            Game Credentials
                                        </span>
                                    </div>
                                    <button class="btn-icon" style="background: none; border: none; color: var(--primary-gold); padding: 0;" id="gameCredentialsToggle">
                                        <i class="fas fa-chevron-down" style="font-size: 0.75rem; transition: transform 0.3s;"></i>
                                    </button>
                                </div>
                                <div id="gameCredentialsContent" style="display: none; padding: 0.75rem; max-height: 200px; overflow-y: auto; border-top: 1px solid rgba(255, 215, 0, 0.1);">
                                    <!-- Game credentials content will be loaded here -->
                                </div>
                            </div>

                            <div class="messages-area" id="messagesContainer">
                                <!-- Messages will be loaded here -->
                            </div>
                            <div class="chat-input-area">
                                <button class="btn-icon btn-secondary" onclick="selectImage()">
                                    <i class="fas fa-image"></i>
                                </button>
                                <button class="btn-icon btn-secondary" onclick="toggleVoiceRecording()">
                                    <i class="fas fa-microphone"></i>
                                </button>
                                <input type="text" class="chat-input" id="messageInput" placeholder="Type a message...">
                                <button class="btn btn-primary" onclick="sendChatMessage()">Send</button>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <!-- Promotions Section -->
            <div class="content-area" id="promotions-section">
                <div class="section-header">
                    <h3 class="section-title">Promotions Management</h3>
                    <button class="btn-primary" onclick="showCreatePromotionModal()">
                        <i class="fas fa-plus"></i> Create Promotion
                    </button>
                </div>

                <!-- Promotion Stats -->
                <div class="dashboard-grid" style="margin: 1.5rem 0;">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-gift"></i>
                        </div>
                        <div class="stat-label">Active Promotions</div>
                        <div class="stat-value" id="activePromotions">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-label">Total Claims</div>
                        <div class="stat-value" id="totalClaims">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-coins"></i>
                        </div>
                        <div class="stat-label">Credits Distributed</div>
                        <div class="stat-value" id="creditsDistributed">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-percentage"></i>
                        </div>
                        <div class="stat-label">Avg. Claim Rate</div>
                        <div class="stat-value" id="avgClaimRate">0%</div>
                    </div>
                </div>

                <!-- Promotions Tabs -->
                <div class="review-tabs" style="margin: 1.5rem 0;">
                    <button class="tab-btn active" onclick="switchPromotionTab('active')">Active Promotions</button>
                    <button class="tab-btn" onclick="switchPromotionTab('expired')">Expired</button>
                    <button class="tab-btn" onclick="switchPromotionTab('all')">All Promotions</button>
                </div>

                <!-- Promotions List -->
                <div id="promotionsList" class="promotions-list">
                    <!-- Promotions will be loaded here -->
                </div>
            </div>

            <!-- Analytics Section -->
            <div class="content-area" id="analytics-section">
                <h3>Analytics Dashboard</h3>
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-label">Total Friends</div>
                        <div class="stat-value" id="analyticsActiveFriends">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-comments"></i>
                        </div>
                        <div class="stat-label">Messages Sent</div>
                        <div class="stat-value" id="analyticsMessagesSent">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-handshake"></i>
                        </div>
                        <div class="stat-label">Friend Requests</div>
                        <div class="stat-value" id="analyticsFriendRequests">0</div>
                    </div>
                </div>
            </div>

            <!-- Reports Section -->
            <div class="content-area" id="reports-section">
                <div class="section">
                    <div class="section-header">
                        <h3 class="section-title">Reports Management</h3>
                    </div>

                    <div class="dashboard-grid" style="margin-bottom: 2rem;">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-paper-plane"></i>
                            </div>
                            <div class="stat-label">Reports Made</div>
                            <div class="stat-value" id="reportsMadeCount">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-inbox"></i>
                            </div>
                            <div class="stat-label">Reports Received</div>
                            <div class="stat-value" id="reportsReceivedCount">0</div>
                        </div>
                    </div>

                    <!-- Reports Tabs -->
                    <div class="tabs" style="margin: 2rem 0;">
                        <button class="report-tab-btn active" onclick="switchReportTab('made')">Reports I Made</button>
                        <button class="report-tab-btn" onclick="switchReportTab('received')">Reports About Me</button>
                    </div>

                    <!-- Reports Made List -->
                    <div id="reportsMadeList" class="reports-list">
                        <!-- Reports will be loaded here -->
                    </div>

                    <!-- Reports Received List -->
                    <div id="reportsReceivedList" class="reports-list" style="display: none;">
                        <!-- Reports will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Reviews Section -->
            <div class="content-area" id="reviews-section">
                <div class="section">
                    <div class="section-header">
                        <h3 class="section-title">Player Reviews</h3>
                        <button class="btn-primary" onclick="showWriteReviewModal()">
                            <i class="fas fa-star"></i> Write Review
                        </button>
                    </div>

                    <!-- Review Stats -->
                    <div class="dashboard-grid" style="margin-bottom: 2rem;">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="stat-label">Reviews Given</div>
                            <div class="stat-value" id="reviewsGiven">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-star-half-alt"></i>
                            </div>
                            <div class="stat-label">Average Rating Given</div>
                            <div class="stat-value" id="avgRatingGiven">0.0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-medal"></i>
                            </div>
                            <div class="stat-label">Reviews Received</div>
                            <div class="stat-value" id="reviewsReceived">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div class="stat-label">My Rating</div>
                            <div class="stat-value" id="myRating">0.0</div>
                        </div>
                    </div>

                    <!-- Review Tabs -->
                    <div class="review-tabs">
                        <button class="tab-btn active" onclick="switchReviewTab('given')">Reviews I've Given</button>
                        <button class="tab-btn" onclick="switchReviewTab('received')">Reviews I've Received</button>
                        <button class="tab-btn" onclick="switchReviewTab('players')">Review Players</button>
                    </div>

                    <!-- Reviews Content -->
                    <div id="reviewsContent" class="reviews-list"></div>
                </div>
            </div>

            <!-- Settings Section -->
            <div class="content-area" id="settings-section">
                <div class="settings-grid">
                    <div class="settings-nav">
                        <div class="settings-nav-item active">
                            <i class="fas fa-user"></i>
                            <span>Profile</span>
                        </div>
                        <div class="settings-nav-item">
                            <i class="fas fa-lock"></i>
                            <span>Security</span>
                        </div>
                        <div class="settings-nav-item">
                            <i class="fas fa-bell"></i>
                            <span>Notifications</span>
                        </div>
                        <div class="settings-nav-item">
                            <i class="fas fa-palette"></i>
                            <span>Appearance</span>
                        </div>
                    </div>
                    <div class="settings-content">
                        <h3 style="margin-bottom: 1.5rem;">Profile Settings</h3>
                        <div class="form-group">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-input" id="settingsName" />
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-input" id="settingsEmail" />
                        </div>
                        <div class="form-group">
                            <label class="form-label">Company Name</label>
                            <input type="text" class="form-input" id="settingsCompany" />
                        </div>

                        <!-- Profile Picture Section -->
                        <div class="form-group">
                            <label class="form-label">Profile Picture</label>
                            <div class="profile-picture-section">
                                <div class="profile-picture-preview" id="profilePicturePreview">
                                    <img id="profilePictureImage" src="" alt="Profile" style="display: none;" />
                                    <div class="profile-picture-placeholder" id="profilePicturePlaceholder">
                                        <i class="fas fa-user" style="font-size: 3rem; color: #666;"></i>
                                        <p style="margin: 0.5rem 0 0 0; color: #666;">No profile picture</p>
                                    </div>
                                </div>
                                <div class="profile-picture-actions">
                                    <input type="file" id="profilePictureInput" accept="image/*" style="display: none;" />
                                    <button type="button" class="btn btn-secondary" onclick="selectProfilePicture()">
                                        <i class="fas fa-upload"></i> Upload Picture
                                    </button>
                                    <button type="button" class="btn btn-danger" id="deleteProfilePictureBtn" onclick="deleteProfilePicture()" style="display: none;">
                                        <i class="fas fa-trash"></i> Remove
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Payment Methods Section -->
                        <div class="form-group">
                            <label class="form-label">Accepted Payment Methods</label>
                            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">
                                Select the payment methods you accept from players
                            </p>
                            <div class="payment-methods-grid" id="paymentMethodsGrid">
                                <div class="loading-spinner">Loading payment methods...</div>
                            </div>
                            <button type="button" class="btn btn-primary" onclick="savePaymentMethods()" style="margin-top: 1rem;">
                                <i class="fas fa-save"></i> Save Payment Methods
                            </button>
                        </div>

                        <!-- Games Selection Section -->
                        <div class="games-selection-section">
                            <div class="games-selection-title">
                                <h4 style="margin: 0; color: var(--primary-gold);">
                                    <i class="fas fa-gamepad" style="margin-right: 0.5rem;"></i>
                                    Available Games You Provide
                                </h4>
                                <span class="selected-count" id="selectedGamesCount">0 selected</span>
                            </div>

                            <div class="games-categories" id="gameCategories">
                                <div class="game-category-tab active" data-category="all">All Games</div>
                                <div class="game-category-tab" data-category="casino">Casino</div>
                                <div class="game-category-tab" data-category="slots">Slots</div>
                                <div class="game-category-tab" data-category="fish">Fish Games</div>
                                <div class="game-category-tab" data-category="sweepstakes">Sweepstakes</div>
                                <div class="game-category-tab" data-category="multi-game">Multi-Game</div>
                            </div>

                            <div class="games-grid" id="gamesGrid">
                                <!-- Games will be loaded here -->
                            </div>

                            <div style="margin-top: 1rem; display: flex; gap: 1rem;">
                                <button type="button" class="btn btn-secondary" onclick="selectAllGames()">
                                    Select All
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="clearGameSelection()">
                                    Clear All
                                </button>
                                <button type="button" class="btn btn-primary" onclick="saveGameSelection()">
                                    <i class="fas fa-save"></i> Save Games
                                </button>
                            </div>
                        </div>

                        <button class="btn-primary">Save Changes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden file input for image upload -->
    <input type="file" id="imageInput" accept="image/*" style="display: none;" onchange="handleImageSelect(event)">

    <!-- Review Modal -->
    <div class="modal-overlay" id="reviewModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Write Review</h3>
                <button class="close-btn" onclick="closeReviewModal()">&times;</button>
            </div>
            <form onsubmit="submitReview(event)">
                <div class="form-group">
                    <label class="form-label">Select Player</label>
                    <select id="reviewPlayerSelect" class="form-input" required>
                        <option value="">Select a player to review...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Rating</label>
                    <div class="rating-input">
                        <span class="rating-star" data-rating="1">â˜…</span>
                        <span class="rating-star" data-rating="2">â˜…</span>
                        <span class="rating-star" data-rating="3">â˜…</span>
                        <span class="rating-star" data-rating="4">â˜…</span>
                        <span class="rating-star" data-rating="5">â˜…</span>
                    </div>
                    <input type="hidden" id="reviewRating" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Review Title</label>
                    <input type="text" id="reviewTitle" class="form-input" placeholder="Summary of your experience" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Review Comment (Optional)</label>
                    <textarea id="reviewComment" class="form-input" rows="4" placeholder="Share your detailed experience..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeReviewModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Submit Review</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create Promotion Modal -->
    <div class="modal-overlay" id="createPromotionModal" style="display: none;">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2>Create New Promotion</h2>
                <button class="close-btn" onclick="closeCreatePromotionModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="createPromotionForm">
                    <div class="form-group">
                        <label>Promotion Title *</label>
                        <input type="text" id="promotionTitle" placeholder="e.g., Welcome Bonus, Weekend Special" required>
                    </div>

                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="promotionDescription" placeholder="Describe your promotion..."></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Promotion Type *</label>
                            <select id="promotionType" required>
                                <option value="">Select Type</option>
                                <option value="bonus">Bonus Credits</option>
                                <option value="cashback">Cashback</option>
                                <option value="free_spins">Free Spins</option>
                                <option value="credits">Credits</option>
                                <option value="deposit_bonus">Deposit Bonus</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Value (Credits/%) *</label>
                            <input type="number" id="promotionValue" min="1" placeholder="e.g., 100" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Max Claims Per Player</label>
                            <input type="number" id="maxClaimsPerPlayer" min="1" value="1" placeholder="1">
                        </div>

                        <div class="form-group">
                            <label>Total Budget (Optional)</label>
                            <input type="number" id="totalBudget" min="0" placeholder="Leave empty for unlimited">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Min Player Level</label>
                            <input type="number" id="minPlayerLevel" min="1" value="1" placeholder="1">
                        </div>

                        <div class="form-group">
                            <label>End Date *</label>
                            <input type="datetime-local" id="endDate" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Wagering Requirement (x)</label>
                        <input type="number" id="wageringRequirement" min="1" value="1" placeholder="e.g., 10 (means 10x wagering)">
                    </div>

                    <div class="form-group">
                        <label>Target Players</label>
                        <div class="target-players-section">
                            <div class="target-players-header">
                                <label>
                                    <input type="checkbox" id="selectAllPlayers" checked onchange="toggleAllPlayers()">
                                    <span>All Connected Players</span>
                                </label>
                            </div>
                            <div id="playersList" style="display: none; max-height: 200px; overflow-y: auto; margin-top: 1rem;">
                                <!-- Players will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Terms & Conditions</label>
                        <textarea id="promotionTerms" placeholder="Enter any terms and conditions..."></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="closeCreatePromotionModal()">Cancel</button>
                        <button type="submit" class="btn-primary">Create Promotion</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Promotion Details Modal -->
    <div class="modal-overlay" id="promotionDetailsModal" style="display: none;">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 id="promotionDetailsTitle">Promotion Details</h2>
                <button class="close-btn" onclick="closePromotionDetailsModal()">&times;</button>
            </div>
            <div class="modal-body" id="promotionDetailsContent">
                <!-- Content will be loaded here -->
            </div>
            <div class="modal-footer" style="display: flex; justify-content: flex-end; padding-top: 1.5rem; border-top: 1px solid rgba(255, 215, 0, 0.2); margin-top: 1.5rem;">
                <button class="btn-secondary" onclick="closePromotionDetailsModal()" style="padding: 0.75rem 1.5rem;">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div class="modal-overlay" id="profileModal">
        <div class="modal profile-modal">
            <div class="modal-header">
                <h2 id="profileModalTitle">User Profile</h2>
                <button class="close-btn" onclick="closeProfileModal()">&times;</button>
            </div>

            <div class="profile-modal-content">
                <!-- Profile Header -->
                <div class="profile-header">
                    <div class="profile-avatar-large">
                        <span id="profileAvatarText">?</span>
                    </div>
                    <div class="profile-main-info">
                        <h3 id="profileFullName">Loading...</h3>
                        <p class="profile-username">@<span id="profileUsername">loading</span></p>
                        <p class="profile-type-badge">
                            <span id="profileTypeBadge">User</span>
                        </p>
                    </div>
                </div>

                <!-- Profile Stats -->
                <div class="profile-stats-grid">
                    <div class="profile-stat-card">
                        <div class="stat-value" id="profileFriendsCount">0</div>
                        <div class="stat-label">Friends</div>
                    </div>
                    <div class="profile-stat-card">
                        <div class="stat-value" id="profileReviewsCount">0</div>
                        <div class="stat-label">Reviews</div>
                    </div>
                    <div class="profile-stat-card">
                        <div class="stat-value" id="profileRating">0.0</div>
                        <div class="stat-label">Rating</div>
                    </div>
                    <div class="profile-stat-card" id="profileSpecificStat">
                        <div class="stat-value" id="profileSpecificValue">0</div>
                        <div class="stat-label" id="profileSpecificLabel">Connected</div>
                    </div>
                </div>

                <!-- Profile Info -->
                <div class="profile-info-section">
                    <h4>Account Information</h4>
                    <div class="profile-info-grid">
                        <div class="profile-info-item">
                            <span class="info-label">Member Since:</span>
                            <span class="info-value" id="profileCreatedAt">-</span>
                        </div>
                        <div class="profile-info-item">
                            <span class="info-label">Account Age:</span>
                            <span class="info-value" id="profileAccountAge">-</span>
                        </div>
                        <div class="profile-info-item" id="profileCompanyItem" style="display:none;">
                            <span class="info-label">Company:</span>
                            <span class="info-value" id="profileCompany">-</span>
                        </div>
                        <div class="profile-info-item" id="profileLevelItem" style="display:none;">
                            <span class="info-label">Player Level:</span>
                            <span class="info-value" id="profileLevel">-</span>
                        </div>
                        <div class="profile-info-item" id="profileEmailVerificationItem" style="display:none;">
                            <span class="info-label">Email Verification:</span>
                            <span class="info-value" id="profileEmailVerification">-</span>
                        </div>
                    </div>
                </div>

                <!-- Payment Methods Section -->
                <div class="profile-section" id="profilePaymentMethodsSection" style="display: none;">
                    <h4 style="color: var(--primary-gold); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-credit-card"></i> Accepted Payment Methods
                    </h4>
                    <div class="profile-payment-methods" id="profilePaymentMethods">
                        <div style="color: var(--text-secondary);">No payment methods selected</div>
                    </div>
                </div>

                <!-- Available Games Section -->
                <div class="profile-section" id="profileGamesSection" style="display: none;">
                    <h4 style="color: var(--primary-gold); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-gamepad"></i> Available Games
                    </h4>
                    <div class="profile-available-games" id="profileAvailableGames">
                        <div style="color: var(--text-secondary);">No games available</div>
                    </div>
                </div>

                <!-- Profile Tabs -->
                <div class="profile-tabs">
                    <button class="profile-tab-btn active" onclick="switchProfileTab('reviews')">
                        Reviews (<span id="profileReviewsTabCount">0</span>)
                    </button>
                    <button class="profile-tab-btn" onclick="switchProfileTab('reports')">
                        Reports
                    </button>
                </div>

                <!-- Tab Content -->
                <div class="profile-tab-content">
                    <!-- Reviews Tab -->
                    <div id="profileReviewsTab" class="profile-tab-pane active">
                        <div id="profileReviewsList" class="profile-reviews-list">
                            <!-- Reviews will be loaded here -->
                        </div>
                    </div>

                    <!-- Reports Tab -->
                    <div id="profileReportsTab" class="profile-tab-pane" style="display:none;">
                        <div id="profileReports">
                            <!-- Create/Edit Report Section -->
                            <div id="reportActionSection" style="display: none;">
                                <h4 style="color: var(--accent-color); margin-bottom: 1rem;">Report User</h4>
                                <form id="reportForm">
                                    <div class="form-group" style="margin-bottom: 1rem;">
                                        <label style="color: var(--text-primary); margin-bottom: 0.5rem; display: block;">Reason for Report:</label>
                                        <textarea id="reportReason" style="
                                            width: 100%;
                                            padding: 0.75rem;
                                            border: 1px solid var(--border-color);
                                            border-radius: 0.5rem;
                                            background: var(--bg-primary);
                                            color: var(--text-primary);
                                            resize: vertical;
                                            min-height: 100px;
                                            font-family: inherit;
                                        " placeholder="Please describe the reason for reporting this user..." required></textarea>
                                    </div>
                                    <div style="display: flex; gap: 1rem;">
                                        <button type="submit" id="submitReportBtn" style="
                                            background: var(--accent-color);
                                            color: var(--text-primary);
                                            border: none;
                                            padding: 0.75rem 1.5rem;
                                            border-radius: 0.5rem;
                                            cursor: pointer;
                                            transition: all 0.3s ease;
                                        ">Submit Report</button>
                                        <button type="button" onclick="cancelReportAction()" style="
                                            background: var(--bg-secondary);
                                            color: var(--text-secondary);
                                            border: 1px solid var(--border-color);
                                            padding: 0.75rem 1.5rem;
                                            border-radius: 0.5rem;
                                            cursor: pointer;
                                            transition: all 0.3s ease;
                                        ">Cancel</button>
                                    </div>
                                </form>
                            </div>

                            <!-- Report Display Section -->
                            <div id="reportDisplaySection">
                                <div id="myReportOnUser" style="display: none; margin-bottom: 2rem;">
                                    <h4 style="color: var(--accent-color); margin-bottom: 1rem;">Your Report</h4>
                                    <div id="myReportCard" class="report-card"></div>
                                </div>

                                <div id="reportsOverview">
                                    <h4 style="color: var(--accent-color); margin-bottom: 1rem;">Reports Overview</h4>
                                    <div id="totalReportsCount" style="color: var(--text-secondary); margin-bottom: 1rem;"></div>
                                    <div id="reportActions" style="display: flex; gap: 1rem; margin-bottom: 2rem;">
                                        <button id="createReportBtn" onclick="showReportForm()" style="
                                            background: var(--accent-color);
                                            color: var(--text-primary);
                                            border: none;
                                            padding: 0.75rem 1.5rem;
                                            border-radius: 0.5rem;
                                            cursor: pointer;
                                            transition: all 0.3s ease;
                                        ">Report User</button>
                                        <button onclick="loadMyReports()" style="
                                            background: var(--bg-secondary);
                                            color: var(--text-primary);
                                            border: 1px solid var(--border-color);
                                            padding: 0.75rem 1.5rem;
                                            border-radius: 0.5rem;
                                            cursor: pointer;
                                            transition: all 0.3s ease;
                                        ">My Reports</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Profile Actions -->
                <div class="profile-actions" id="profileActions">
                    <!-- Actions will be dynamically added based on relationship -->
                </div>
            </div>
        </div>
    </div>

    <!-- Register Player Modal -->
    <div class="modal-overlay" id="registerPlayerModal" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Register New Player</h3>
                <button class="close-btn" onclick="closeRegisterPlayerModal()">&times;</button>
            </div>
            <form onsubmit="registerPlayer(event)">
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" id="playerUsername" class="form-input" placeholder="Player username" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" id="playerEmail" class="form-input" placeholder="player@example.com" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" id="playerFullName" class="form-input" placeholder="Player's full name" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password (Optional)</label>
                    <input type="password" id="playerPassword" class="form-input" maxlength="72" placeholder="Leave blank to auto-generate">
                    <small style="color: #888;">If left blank, a temporary password will be generated. Max 72 characters.</small>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeRegisterPlayerModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Register Player</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Bulk Register Players Modal -->
    <div class="modal-overlay" id="bulkRegisterModal" style="display: none;">
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header">
                <h3 class="modal-title">Bulk Register Players</h3>
                <button class="close-btn" onclick="closeBulkRegisterModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Import Players (CSV Format)</label>
                    <textarea id="bulkPlayerData" class="form-input" rows="10" placeholder="username,email,full_name,password&#10;player1,player1@example.com,John Doe,&#10;player2,player2@example.com,Jane Smith,password123&#10;..." style="font-family: monospace;"></textarea>
                    <small style="color: #888;">Format: username,email,full_name,password (password is optional)</small>
                </div>
                <div class="bulk-register-preview" id="bulkRegisterPreview" style="display: none;">
                    <h4 style="color: #FFD700; margin-bottom: 1rem;">Preview</h4>
                    <div class="table-container">
                        <table class="data-table" id="bulkPreviewTable">
                            <thead>
                                <tr>
                                    <th>Username</th>
                                    <th>Email</th>
                                    <th>Full Name</th>
                                    <th>Password</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeBulkRegisterModal()">Cancel</button>
                    <button type="button" class="btn-primary" onclick="previewBulkRegister()">Preview</button>
                    <button type="button" class="btn-primary" onclick="executeBulkRegister()" id="executeBulkBtn" style="display: none;">Register All</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <script>
        const API_URL = window.location.protocol + '//' + window.location.host;
        let authToken = localStorage.getItem('authToken');
        let currentUser = null;
        let currentChatUser = null;
        let currentPlayerId = null;
        let socket = null;

        // Check if already logged in
        if (authToken) {
            checkAuth();
        }

        // Show/Hide sections
        document.getElementById('showRegister').addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('registerSection').classList.remove('hidden');
        });

        document.getElementById('showLogin').addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('registerSection').classList.add('hidden');
            document.getElementById('loginSection').classList.remove('hidden');
        });

        // Navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const section = item.dataset.section;

                // Update active nav
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                item.classList.add('active');

                // Update content
                document.querySelectorAll('.content-area').forEach(c => c.classList.remove('active'));
                document.getElementById(`${section}-section`).classList.add('active');

                // Update header title
                document.getElementById('headerTitle').textContent =
                    section.charAt(0).toUpperCase() + section.slice(1);

                // Load section-specific data
                if (section === 'reviews') {
                    loadReviewStats();
                    loadGivenReviews(); // Load given reviews by default
                } else if (section === 'promotions') {
                    loadPromotions();
                } else if (section === 'reports') {
                    loadReportsForSection();
                }
            });
        });

        // Toggle Sidebar
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('collapsed');
        }

        // Login form
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const formData = new FormData();
                formData.append('username', username);
                formData.append('password', password);

                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (response.ok) {
                    if (data.user_type !== 'client') {
                        showNotification('Please use the player portal', 'error');
                        return;
                    }
                    authToken = data.access_token;
                    localStorage.setItem('authToken', authToken);
                    await loadDashboard();
                } else {
                    showNotification(data.detail || 'Login failed', 'error');
                }
            } catch (error) {
                showNotification('Connection error', 'error');
            }
        });

        // Register form
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const userData = {
                full_name: document.getElementById('fullName').value,
                email: document.getElementById('email').value,
                username: document.getElementById('username').value,
                password: document.getElementById('password').value,
                user_type: 'client',
                company_name: document.getElementById('companyName').value
            };

            try {
                const response = await fetch(`${API_URL}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(userData)
                });

                const data = await response.json();

                if (response.ok) {
                    showNotification('Registration successful! Please login.', 'success');
                    document.getElementById('showLogin').click();
                } else {
                    // Make error messages more user-friendly
                    let errorMessage = data.detail || 'Registration failed';

                    if (errorMessage.toLowerCase().includes('email already registered')) {
                        errorMessage = 'This email is already registered. Please use a different email or try logging in.';
                    } else if (errorMessage.toLowerCase().includes('username already taken')) {
                        errorMessage = 'This username is already taken. Please choose a different username.';
                    }

                    showNotification(errorMessage, 'error');
                }
            } catch (error) {
                showNotification('Connection error', 'error');
            }
        });

        async function checkAuth() {
            try {
                const response = await fetch(`${API_URL}/auth/me`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    await loadDashboard();
                } else {
                    localStorage.removeItem('authToken');
                    authToken = null;
                }
            } catch (error) {
                localStorage.removeItem('authToken');
                authToken = null;
            }
        }

        async function loadDashboard() {
            try {
                // Get current user info
                const response = await fetch(`${API_URL}/auth/me`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (!response.ok) throw new Error('Failed to load user data');

                currentUser = await response.json();

                // Validate user type - only clients should access this dashboard
                if (currentUser.user_type !== 'client') {
                    showNotification('Access denied. This dashboard is for clients only.', 'error');
                    logout();
                    return;
                }

                // Update UI
                document.getElementById('userName').textContent = currentUser.full_name || currentUser.username;
                document.getElementById('userId').textContent = `ID: ${currentUser.user_id}`;
                updateUserAvatar('userAvatar', currentUser);

                // Settings
                document.getElementById('settingsName').value = currentUser.full_name || '';
                document.getElementById('settingsEmail').value = currentUser.email || '';
                document.getElementById('settingsCompany').value = currentUser.company_name || '';

                // Load profile picture
                loadProfilePicture();

                // Load payment methods
                loadPaymentMethods();

                // Load available games
                loadAvailableGames();

                // Hide login/register, show dashboard
                document.getElementById('loginSection').classList.add('hidden');
                document.getElementById('registerSection').classList.add('hidden');
                document.getElementById('dashboardSection').classList.remove('hidden');

                // Load data
                await Promise.all([
                    loadFriends(),
                    loadFriendRequests(),
                    loadConversations(),
                    loadPlayers(),
                    loadRecentActivity()
                ]);

                // Update stats
                updateDashboardStats();

                // Connect WebSocket
                connectWebSocket();

                // Load online status
                loadOnlineStatus();
            } catch (error) {
                showNotification('Failed to load dashboard', 'error');
            }
        }

        async function updateDashboardStats() {
            try {
                // Update from loaded data
                const friendCount = document.querySelectorAll('#friendsList .friend-card').length;
                const requestCount = document.querySelectorAll('#friendRequests .friend-card').length;
                const playerRows = document.querySelectorAll('#playersTable tr');
                const playerCount = playerRows.length > 0 && !playerRows[0].textContent.includes('No player friends') ? playerRows.length : 0;

                // Main dashboard stats
                document.getElementById('totalPlayers').textContent = playerCount > 0 ? playerCount : '0';
                document.getElementById('totalFriends').textContent = friendCount;
                document.getElementById('pendingRequests').textContent = requestCount;

                // Get message count
                const messageCount = await getMessageCount();
                document.getElementById('totalMessages').textContent = messageCount;

                // Get online count
                const onlineCount = await getOnlineCount();
                document.getElementById('onlineCount').textContent = onlineCount;

                // Analytics stats
                document.getElementById('analyticsActiveFriends').textContent = friendCount;
                document.getElementById('analyticsFriendRequests').textContent = requestCount;
                document.getElementById('analyticsMessagesSent').textContent = messageCount;
            } catch (error) {
                console.error('Error updating stats:', error);
            }
        }

        async function getMessageCount() {
            try {
                const response = await fetch(`${API_URL}/chat/stats`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                if (!response.ok) return '0';
                const stats = await response.json();
                return stats.messages_sent.toString();
            } catch (error) {
                return '0';
            }
        }

        async function getOnlineCount() {
            try {
                const response = await fetch(`${API_URL}/online/count`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    return data.total_online || 0;
                }
                return 0;
            } catch (error) {
                console.error('Error getting online count:', error);
                return 0;
            }
        }

        async function loadRecentActivity() {
            try {
                const response = await fetch(`${API_URL}/client/recent-activity?limit=10`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (!response.ok) {
                    console.error('Failed to load recent activity');
                    return;
                }

                const data = await response.json();
                const activityTable = document.getElementById('activityTable');

                if (data.activities && data.activities.length > 0) {
                    activityTable.innerHTML = data.activities.map(activity => {
                        const statusBadgeClass = activity.status === 'Pending' ? 'status-active' :
                                                 activity.status === 'Accepted' ? 'status-active' :
                                                 activity.status === 'Active' ? 'status-active' :
                                                 activity.status === 'Unread' ? 'status-active' :
                                                 'status-inactive';

                        const timeAgo = getTimeAgo(new Date(activity.timestamp));

                        return `
                            <tr>
                                <td>${activity.description}</td>
                                <td>${activity.user}</td>
                                <td>${timeAgo}</td>
                                <td><span class="status-badge ${statusBadgeClass}">${activity.status || 'N/A'}</span></td>
                            </tr>
                        `;
                    }).join('');
                } else {
                    activityTable.innerHTML = `
                        <tr>
                            <td colspan="4" style="text-align: center; color: #888;">No recent activity</td>
                        </tr>
                    `;
                }
            } catch (error) {
                console.error('Error loading recent activity:', error);
                const activityTable = document.getElementById('activityTable');
                activityTable.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; color: #888;">Failed to load activity</td>
                    </tr>
                `;
            }
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins} min${diffMins > 1 ? 's' : ''} ago`;
            if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
            if (diffDays < 7) return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
            return date.toLocaleDateString();
        }

        async function loadPlayers() {
            try {
                // Load player stats first
                loadPlayerStats();

                // Get players managed by this client
                const response = await fetch(`${API_URL}/client/my-players`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (!response.ok) return;

                const players = await response.json();
                const playersTable = document.getElementById('playersTable');

                if (players.length === 0) {
                    playersTable.innerHTML = '<tr><td colspan="7" style="text-align: center;">No players registered yet. Click "Register Player" to add players.</td></tr>';
                    return;
                }

                playersTable.innerHTML = players.map(player => {
                    const isOnline = player.is_online;
                    const statusClass = isOnline ? 'status-active' : 'status-inactive';
                    const statusText = isOnline ? 'Online' : 'Offline';

                    return `
                        <tr>
                            <td>${player.username}</td>
                            <td>${player.email}</td>
                            <td>${player.full_name || 'N/A'}</td>
                            <td>${player.credits || 0}</td>
                            <td>Level ${player.player_level || 1}</td>
                            <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                            <td>
                                <button class="btn-primary" onclick="viewPlayerDetails(${player.id})">Details</button>
                                <button class="btn-secondary" onclick="manageCredentials(${player.id})">Credentials</button>
                            </td>
                        </tr>
                    `;
                }).join('');
            } catch (error) {
                console.error('Failed to load players:', error);
            }
        }

        async function loadPlayerStats() {
            try {
                const response = await fetch(`${API_URL}/client/player-stats`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (!response.ok) return;

                const stats = await response.json();

                // Update stats cards
                const totalPlayersEl = document.querySelector('.stats-card:nth-child(1) .stats-value');
                const activePlayersEl = document.querySelector('.stats-card:nth-child(2) .stats-value');
                const newTodayEl = document.querySelector('.stats-card:nth-child(3) .stats-value');

                if (totalPlayersEl) totalPlayersEl.textContent = stats.total_players;
                if (activePlayersEl) activePlayersEl.textContent = stats.online_players;
                if (newTodayEl) newTodayEl.textContent = stats.new_today;
            } catch (error) {
                console.error('Failed to load player stats:', error);
            }
        }

        // Player Registration Functions
        function showRegisterPlayerModal() {
            document.getElementById('registerPlayerModal').style.display = 'block';
        }

        function closeRegisterPlayerModal() {
            document.getElementById('registerPlayerModal').style.display = 'none';
            // Clear form
            document.getElementById('playerUsername').value = '';
            document.getElementById('playerEmail').value = '';
            document.getElementById('playerFullName').value = '';
            document.getElementById('playerPassword').value = '';
        }

        async function registerPlayer(event) {
            event.preventDefault();

            const playerData = {
                username: document.getElementById('playerUsername').value,
                email: document.getElementById('playerEmail').value,
                full_name: document.getElementById('playerFullName').value,
                password: document.getElementById('playerPassword').value || null
            };

            try {
                const response = await fetch(`${API_URL}/client/register-player`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(playerData)
                });

                if (response.ok) {
                    const result = await response.json();

                    let message = 'Player registered successfully!';
                    if (result.temp_password) {
                        message += `\n\nTemporary Password: ${result.temp_password}\n\nPlease save this password and share it with the player.`;
                        alert(message);
                    } else {
                        showNotification(message, 'success');
                    }

                    closeRegisterPlayerModal();
                    loadPlayers();
                } else {
                    const error = await response.json();

                    // Make error messages more user-friendly
                    let errorMessage = error.detail || 'Registration failed';

                    if (errorMessage.toLowerCase().includes('email already registered')) {
                        errorMessage = 'This email is already registered. Please use a different email address.';
                    } else if (errorMessage.toLowerCase().includes('username already taken')) {
                        errorMessage = 'This username is already taken. Please choose a different username.';
                    }

                    showNotification(errorMessage, 'error');
                }
            } catch (error) {
                showNotification('Connection error', 'error');
            }
        }

        function showBulkRegisterModal() {
            document.getElementById('bulkRegisterModal').style.display = 'block';
        }

        function closeBulkRegisterModal() {
            document.getElementById('bulkRegisterModal').style.display = 'none';
            document.getElementById('bulkPlayerData').value = '';
            document.getElementById('bulkRegisterPreview').style.display = 'none';
            document.getElementById('executeBulkBtn').style.display = 'none';
        }

        function previewBulkRegister() {
            const csvData = document.getElementById('bulkPlayerData').value.trim();
            if (!csvData) {
                showNotification('Please enter player data', 'error');
                return;
            }

            const lines = csvData.split('\n');
            const players = [];

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line || (i === 0 && line.toLowerCase().includes('username'))) continue;

                const parts = line.split(',').map(p => p.trim());
                if (parts.length < 3) {
                    showNotification(`Invalid format on line ${i + 1}`, 'error');
                    return;
                }

                players.push({
                    username: parts[0],
                    email: parts[1],
                    full_name: parts[2],
                    password: parts[3] || null
                });
            }

            if (players.length === 0) {
                showNotification('No valid player data found', 'error');
                return;
            }

            // Show preview
            const previewTable = document.querySelector('#bulkPreviewTable tbody');
            previewTable.innerHTML = players.map(p => `
                <tr>
                    <td>${p.username}</td>
                    <td>${p.email}</td>
                    <td>${p.full_name}</td>
                    <td>${p.password ? 'â€¢â€¢â€¢â€¢â€¢' : 'Auto-generate'}</td>
                </tr>
            `).join('');

            document.getElementById('bulkRegisterPreview').style.display = 'block';
            document.getElementById('executeBulkBtn').style.display = 'inline-block';

            // Store parsed data for execution
            window.bulkRegisterData = players;
        }

        async function executeBulkRegister() {
            if (!window.bulkRegisterData || window.bulkRegisterData.length === 0) {
                showNotification('No data to register', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/client/bulk-register-players`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(window.bulkRegisterData)
                });

                if (response.ok) {
                    const result = await response.json();

                    let message = `Successfully registered ${result.success} players.`;
                    if (result.failed > 0) {
                        message += ` Failed: ${result.failed}.`;
                    }

                    // Show results with temp passwords if any
                    if (result.created_players && result.created_players.length > 0) {
                        const tempPasswords = result.created_players
                            .filter(p => p.temp_password)
                            .map(p => `${p.username}: ${p.temp_password}`)
                            .join('\n');

                        if (tempPasswords) {
                            message += '\n\nTemporary Passwords:\n' + tempPasswords;
                            alert(message);
                        } else {
                            showNotification(message, 'success');
                        }
                    } else {
                        showNotification(message, result.failed > 0 ? 'warning' : 'success');
                    }

                    closeBulkRegisterModal();
                    loadPlayers();
                } else {
                    const error = await response.json();
                    showNotification(error.detail || 'Bulk registration failed', 'error');
                }
            } catch (error) {
                showNotification('Connection error', 'error');
            }
        }

        function searchPlayers() {
            const searchTerm = document.getElementById('playerSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#playersTable tr');

            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function viewPlayerDetails(playerId) {
            // This could open a modal or navigate to player details
            openProfileModal(playerId);
        }

        function manageCredentials(playerId) {
            // This will open the game credentials management for this player
            currentPlayerId = playerId;
            showSection('games');
            loadGames();
        }

        async function sendFriendRequest(userId) {
            try {
                const response = await fetch(`${API_URL}/friends/request`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ receiver_user_id: userId })
                });

                if (response.ok) {
                    showNotification('Friend request sent!', 'success');
                    loadPlayers();
                } else {
                    const data = await response.json();
                    showNotification(data.detail || 'Failed to send request', 'error');
                }
            } catch (error) {
                showNotification('Connection error', 'error');
            }
        }

        async function loadFriendRequests() {
            try {
                const response = await fetch(`${API_URL}/friends/requests/received`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (!response.ok) return;

                const requests = await response.json();
                const container = document.getElementById('friendRequests');

                if (requests.length === 0) {
                    container.innerHTML = '<p style="color: #888;">No pending friend requests</p>';
                    document.getElementById('friendRequestBadge').style.display = 'none';
                    return;
                }

                document.getElementById('friendRequestBadge').textContent = requests.length;
                document.getElementById('friendRequestBadge').style.display = 'inline-block';

                container.innerHTML = requests.map(req => `
                    <div class="friend-card">
                        ${createAvatarHTML(req.sender, 'friend-avatar', `openProfileModal(${req.sender.id})`)}
                        <div class="friend-info" style="cursor: pointer;" onclick="openProfileModal(${req.sender.id})">
                            <div class="friend-name">${req.sender.full_name || req.sender.username}</div>
                            <div class="friend-id">ID: ${req.sender.user_id}</div>
                        </div>
                        <div class="friend-actions">
                            <button class="btn-icon" onclick="openProfileModal(${req.sender.id})" title="View Profile">
                                <i class="fas fa-user"></i>
                            </button>
                            <button class="btn-icon" onclick="handleFriendRequest(${req.id}, 'accepted')" title="Accept">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="btn-icon btn-danger" onclick="handleFriendRequest(${req.id}, 'rejected')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Failed to load friend requests:', error);
            }
        }

        async function handleFriendRequest(requestId, status) {
            try {
                const response = await fetch(`${API_URL}/friends/requests/${requestId}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status: status })
                });

                if (response.ok) {
                    showNotification(`Friend request ${status}`, 'success');
                    await Promise.all([
                        loadFriends(),
                        loadFriendRequests()
                    ]);
                } else {
                    showNotification('Failed to update friend request', 'error');
                }
            } catch (error) {
                showNotification('Connection error', 'error');
            }
        }

        async function loadFriends() {
            try {
                const response = await fetch(`${API_URL}/friends/list`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (!response.ok) throw new Error('Failed to load friends');

                const data = await response.json();
                friends = data.friends; // Store friends globally
                const friendsDiv = document.getElementById('friendsList');

                if (data.friends.length === 0) {
                    friendsDiv.innerHTML = '<p style="color: #888;">No friends yet. Send friend requests to connect!</p>';
                    friends = []; // Initialize as empty array
                    return;
                }

                friendsDiv.innerHTML = data.friends.map(friend => {
                    const onlineStatus = getOnlineStatus(friend);
                    return `
                    <div class="friend-card">
                        ${createAvatarHTML(friend, 'friend-avatar', `openProfileModal(${friend.id})`)}
                        <div class="friend-info" style="cursor: pointer;" onclick="openProfileModal(${friend.id})">
                            <div class="friend-name">${friend.full_name || friend.username}</div>
                            <div class="friend-id">ID: ${friend.user_id}</div>
                            <div class="last-seen">${onlineStatus.text}</div>
                        </div>
                        <div class="friend-actions">
                            <button class="btn-icon" onclick="openProfileModal(${friend.id})" title="View Profile">
                                <i class="fas fa-user"></i>
                            </button>
                            <button class="btn-icon" onclick='openChat(${JSON.stringify(friend).replace(/'/g, "&apos;")})'  title="Send Message">
                                <i class="fas fa-comment"></i>
                            </button>
                            <button class="btn-icon btn-danger" onclick="removeFriend(${friend.id})" title="Remove Friend">
                                <i class="fas fa-user-minus"></i>
                            </button>
                        </div>
                    </div>
                `;}).join('');
            } catch (error) {
                console.error('Failed to load friends:', error);
            }
        }

        async function removeFriend(friendId) {
            if (!confirm('Are you sure you want to remove this friend?')) return;

            try {
                const response = await fetch(`${API_URL}/friends/remove/${friendId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    showNotification('Friend removed', 'success');
                    await loadFriends();
                } else {
                    showNotification('Failed to remove friend', 'error');
                }
            } catch (error) {
                showNotification('Connection error', 'error');
            }
        }

        // Chat functions
        async function loadConversations() {
            try {
                const response = await fetch(`${API_URL}/chat/conversations`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (!response.ok) return;

                const conversations = await response.json();
                const container = document.getElementById('conversationsList');

                if (conversations.length === 0) {
                    container.innerHTML = '<div style="padding: 1rem; text-align: center; color: #888;">No conversations yet</div>';
                    document.getElementById('messageBadge').style.display = 'none';
                    return;
                }

                let totalUnread = 0;
                container.innerHTML = conversations.map(conv => {
                    totalUnread += conv.unread_count;
                    const lastMsg = conv.last_message;
                    const lastMsgText = lastMsg ?
                        (lastMsg.message_type === 'text' ? lastMsg.content :
                         `<i class="fas fa-${lastMsg.message_type === 'image' ? 'image' : 'microphone'}"></i> ${lastMsg.message_type}`) :
                        'No messages';

                    return `
                        <div class="conversation-item ${currentChatUser && currentChatUser.id === conv.friend.id ? 'active' : ''}"
                             onclick='selectConversation(${JSON.stringify(conv.friend).replace(/'/g, "&apos;")})'>
                            ${createAvatarHTML(conv.friend, 'conversation-avatar')}
                            <div class="conversation-info">
                                <div class="conversation-name">${conv.friend.username}</div>
                                <div class="conversation-last-msg">${lastMsgText}</div>
                            </div>
                            ${conv.unread_count > 0 ? `<span class="conversation-badge">${conv.unread_count}</span>` : ''}
                        </div>
                    `;
                }).join('');

                if (totalUnread > 0) {
                    document.getElementById('messageBadge').textContent = totalUnread;
                    document.getElementById('messageBadge').style.display = 'inline-block';
                } else {
                    document.getElementById('messageBadge').style.display = 'none';
                }
            } catch (error) {
                console.error('Failed to load conversations:', error);
            }
        }

        function selectConversation(friend) {
            openChat(friend);
            // Switch to messages tab
            document.querySelector('.nav-item[data-section="messages"]').click();
        }

        async function openChat(friend) {
            currentChatUser = friend;
            currentPlayerId = friend.id; // Set current player ID for credentials

            // Update UI
            document.getElementById('chatUserName').textContent = friend.username;
            updateUserAvatar('chatAvatar', friend);

            // Show active chat area, hide empty state
            document.getElementById('emptyChatState').style.display = 'none';
            document.getElementById('activeChatArea').classList.remove('hidden');
            document.getElementById('activeChatArea').style.display = 'flex';

            // Update active conversation
            document.querySelectorAll('.conversation-item').forEach(item => {
                item.classList.remove('active');
            });
            if (event && event.currentTarget) {
                event.currentTarget.classList.add('active');
            }

            // Load messages and credentials
            await loadMessages(friend.id);
            await loadPlayerCredentials(friend.id); // Load game credentials for this player
        }

        async function loadMessages(friendId) {
            try {
                const response = await fetch(`${API_URL}/chat/messages/${friendId}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (!response.ok) return;

                const data = await response.json();
                const container = document.getElementById('messagesContainer');

                container.innerHTML = data.messages.map(msg => {
                    const isOwn = msg.sender_id === currentUser.id;
                    let content = '';
                    let isClaimRequest = false;
                    let promotionId = null;

                    if (msg.message_type === 'text') {
                        content = msg.content;

                        // Check if this is a promotion claim request
                        if (content.includes('ðŸŽ¯ Promotion Claim Request') && content.includes('Promotion ID: #')) {
                            isClaimRequest = true;
                            const match = content.match(/Promotion ID: #(\d+)/);
                            if (match) {
                                promotionId = match[1];
                            }
                        }
                    } else if (msg.message_type === 'image') {
                        const imageUrl = msg.file_url.startsWith('http') ? msg.file_url : `${API_URL}${msg.file_url}`;
                        console.log('Image URL fixed:', msg.file_url, '->', imageUrl);
                        content = `<img src="${imageUrl}" alt="Image" style="max-width: 200px; max-height: 200px; border-radius: 8px;">`;
                    } else if (msg.message_type === 'voice') {
                        const voiceUrl = msg.file_url.startsWith('http') ? msg.file_url : `${API_URL}${msg.file_url}`;
                        console.log('Voice URL fixed:', msg.file_url, '->', voiceUrl);
                        content = `
                            <audio controls>
                                <source src="${voiceUrl}" type="audio/webm">
                                Your browser does not support audio playback.
                            </audio>
                        `;
                    }

                    // Add approval buttons for claim requests if it's from another user
                    let approvalButtons = '';
                    if (isClaimRequest && !isOwn && promotionId) {
                        approvalButtons = `
                            <div class="claim-approval-buttons" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,215,0,0.2);">
                                <button onclick="approvePromotionClaim(${promotionId}, ${msg.sender_id})"
                                        class="btn-approve" style="background: #4caf50; color: white; padding: 5px 15px; border: none; border-radius: 5px; margin-right: 10px; cursor: pointer;">
                                    <i class="fas fa-check"></i> Approve Claim
                                </button>
                                <button onclick="rejectPromotionClaim(${promotionId}, ${msg.sender_id})"
                                        class="btn-reject" style="background: #f44336; color: white; padding: 5px 15px; border: none; border-radius: 5px; cursor: pointer;">
                                    <i class="fas fa-times"></i> Reject
                                </button>
                            </div>
                        `;
                    }

                    return `
                        <div class="message ${isOwn ? 'own' : 'other'}">
                            <div class="message-bubble">
                                ${content.replace(/\n/g, '<br>')}
                                ${approvalButtons}
                                <div class="message-time">${new Date(msg.created_at).toLocaleTimeString()}</div>
                            </div>
                        </div>
                    `;
                }).join('');

                // Show/hide Game Credentials section based on friend type
                const friend = friends.find(f => f.id === parseInt(friendId));
                const credentialsSection = document.getElementById('gameCredentialsSection');
                if (friend && friend.user_type === 'player') {
                    credentialsSection.style.display = 'block';
                    document.getElementById('gameCredentialsTitle').textContent = `Game Credentials for ${friend.full_name}`;

                    // Load the credentials content into the separate section
                    loadPlayerCredentialsInSection(friendId);
                } else {
                    credentialsSection.style.display = 'none';
                }

                // Scroll to bottom
                container.scrollTop = container.scrollHeight;
            } catch (error) {
                console.error('Failed to load messages:', error);
            }
        }

        async function sendChatMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();

            if (!message || !currentChatUser) return;

            const formData = new FormData();
            formData.append('receiver_id', currentChatUser.id);
            formData.append('content', message);

            try {
                const response = await fetch(`${API_URL}/chat/send/text`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${authToken}` },
                    body: formData
                });

                if (response.ok) {
                    input.value = '';
                    await loadMessages(currentChatUser.id);
                    await loadConversations();
                } else {
                    const error = await response.json();
                    showNotification(error.detail || 'Failed to send message', 'error');
                }
            } catch (error) {
                showNotification('Failed to send message', 'error');
            }
        }

        // WebSocket connection
        function connectWebSocket() {
            if (!authToken) return;
            console.log('Client Dashboard v2.1 - File URL Fix Active');

            const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${wsProtocol}//${window.location.host}/ws?token=${authToken}`;
            socket = new WebSocket(wsUrl);

            socket.onopen = () => {
                console.log('WebSocket connected');
                // Send heartbeat every 30 seconds
                setInterval(() => {
                    if (socket.readyState === WebSocket.OPEN) {
                        socket.send(JSON.stringify({ type: 'ping' }));
                    }
                }, 30000);
            };

            socket.onmessage = async (event) => {
                const data = JSON.parse(event.data);

                if (data.type === 'new_message') {
                    // Refresh messages if in chat with sender
                    if (currentChatUser && currentChatUser.id === data.sender_id) {
                        await loadMessages(data.sender_id);
                    }

                    // Refresh conversations list
                    await loadConversations();

                    // Show notification
                    showNotification(`New message from ${data.sender_name}`, 'info');
                } else if (data.type === 'user_online') {
                    updateUserOnlineStatus(data.user_id, true);
                    showNotification(`${data.username} is now online`, 'info');
                } else if (data.type === 'user_offline') {
                    updateUserOnlineStatus(data.user_id, false);
                    showNotification(`${data.username} is now offline`, 'info');
                } else if (data.type === 'typing') {
                    // Handle typing indicator
                    if (currentChatUser && currentChatUser.id === data.user_id) {
                        showTypingIndicator(data.is_typing);
                    }
                }
            };

            socket.onerror = (error) => {
                console.error('WebSocket error:', error);
            };

            socket.onclose = () => {
                console.log('WebSocket disconnected');
                // Reconnect after 5 seconds
                setTimeout(() => {
                    if (authToken) {
                        connectWebSocket();
                    }
                }, 5000);
            };
        }

        // Online Status Functions
        function updateUserOnlineStatus(userId, isOnline, username = '') {
            // Update online indicators throughout the UI
            const avatars = document.querySelectorAll('.friend-avatar, .user-avatar, .conversation-avatar, .review-avatar');
            avatars.forEach(avatar => {
                const parentCard = avatar.closest('.friend-card, .conversation-item, .user-card');
                if (parentCard && parentCard.querySelector(`[onclick*="${userId}"]`)) {
                    const indicator = avatar.querySelector('.online-indicator');
                    if (indicator) {
                        indicator.className = `online-indicator ${isOnline ? 'online' : 'offline'}`;
                    }

                    // Update last seen text
                    const lastSeenElement = parentCard.querySelector('.last-seen');
                    if (lastSeenElement) {
                        lastSeenElement.textContent = isOnline ? 'Online' : 'Offline';
                    }
                }
            });

            // Update status in chat header if this is the current chat user
            if (currentChatUser && currentChatUser.id === userId) {
                const chatStatus = document.getElementById('chatUserStatus');
                if (chatStatus) {
                    chatStatus.textContent = isOnline ? 'Online' : 'Offline';
                    chatStatus.style.color = isOnline ? '#4CAF50' : '#757575';
                }

                // Update chat avatar indicator
                const chatAvatar = document.querySelector('#chatSection .online-indicator');
                if (chatAvatar) {
                    chatAvatar.className = `online-indicator ${isOnline ? 'online' : 'offline'}`;
                }
            }
        }

        async function loadOnlineStatus() {
            try {
                const response = await fetch(`${API_URL}/users/online-status`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    // Update UI with online friends
                    data.online_friends.forEach(userId => {
                        updateUserOnlineStatus(userId, true);
                    });
                }
            } catch (error) {
                console.error('Error loading online status:', error);
            }
        }

        // Typing indicator functions
        let typingTimeout;
        let isCurrentlyTyping = false;

        function sendTypingIndicator(isTyping) {
            if (!socket || socket.readyState !== WebSocket.OPEN || !currentChatUser) return;

            socket.send(JSON.stringify({
                type: 'typing',
                receiver_id: currentChatUser.id,
                is_typing: isTyping
            }));
        }

        function handleTyping() {
            if (!isCurrentlyTyping) {
                isCurrentlyTyping = true;
                sendTypingIndicator(true);
            }

            clearTimeout(typingTimeout);
            typingTimeout = setTimeout(() => {
                isCurrentlyTyping = false;
                sendTypingIndicator(false);
            }, 2000);
        }

        function showTypingIndicator(isTyping) {
            const typingIndicator = document.getElementById('typingIndicator');
            const onlineStatus = document.getElementById('onlineStatus');

            if (typingIndicator && onlineStatus) {
                if (isTyping) {
                    typingIndicator.style.display = 'block';
                    onlineStatus.style.display = 'none';
                } else {
                    typingIndicator.style.display = 'none';
                    onlineStatus.style.display = 'block';
                }
            }
        }

        // Handle Enter key in message input
        document.addEventListener('DOMContentLoaded', () => {
            const messageInput = document.getElementById('messageInput');
            if (messageInput) {
                messageInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendChatMessage();
                    }
                });

                // Add typing indicator events
                messageInput.addEventListener('input', handleTyping);
                messageInput.addEventListener('blur', () => {
                    clearTimeout(typingTimeout);
                    isCurrentlyTyping = false;
                    sendTypingIndicator(false);
                });
            }
        });

        // Image handling
        function selectImage() {
            document.getElementById('imageInput').click();
        }

        async function handleImageSelect(event) {
            const file = event.target.files[0];
            if (!file || !currentChatUser) return;

            const formData = new FormData();
            formData.append('receiver_id', currentChatUser.id);
            formData.append('file', file);

            try {
                const response = await fetch(`${API_URL}/chat/send/image`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${authToken}` },
                    body: formData
                });

                if (response.ok) {
                    await loadMessages(currentChatUser.id);
                    await loadConversations();
                } else {
                    showNotification('Failed to send image', 'error');
                }
            } catch (error) {
                showNotification('Failed to send image', 'error');
            }

            // Reset input
            event.target.value = '';
        }

        // Voice recording
        let mediaRecorder = null;
        let audioChunks = [];

        async function toggleVoiceRecording() {
            if (!currentChatUser) return;

            if (!mediaRecorder || mediaRecorder.state === 'inactive') {
                // Start recording
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    audioChunks = [];

                    mediaRecorder.ondataavailable = (event) => {
                        audioChunks.push(event.data);
                    };

                    mediaRecorder.onstop = async () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                        await sendVoiceMessage(audioBlob);
                        stream.getTracks().forEach(track => track.stop());
                    };

                    mediaRecorder.start();
                    document.querySelector('.fa-microphone').style.color = '#ff4444';
                    showNotification('Recording...', 'info');
                } catch (error) {
                    showNotification('Microphone access denied', 'error');
                }
            } else {
                // Stop recording
                mediaRecorder.stop();
                document.querySelector('.fa-microphone').style.color = '';
            }
        }

        async function sendVoiceMessage(audioBlob) {
            const formData = new FormData();
            formData.append('receiver_id', currentChatUser.id);
            formData.append('file', audioBlob, 'voice.webm');
            formData.append('duration', Math.round(audioChunks.length / 10));

            try {
                const response = await fetch(`${API_URL}/chat/send/voice`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${authToken}` },
                    body: formData
                });

                if (response.ok) {
                    await loadMessages(currentChatUser.id);
                    await loadConversations();
                } else {
                    showNotification('Failed to send voice message', 'error');
                }
            } catch (error) {
                showNotification('Failed to send voice message', 'error');
            }
        }

        function logout() {
            localStorage.removeItem('authToken');
            authToken = null;
            currentUser = null;
            if (socket) {
                socket.close();
            }
            document.getElementById('dashboardSection').classList.add('hidden');
            document.getElementById('loginSection').classList.remove('hidden');
            showNotification('Logged out successfully', 'success');
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification show';
            notification.style.borderColor = type === 'error' ? '#ff6b6b' : '#FFD700';
            notification.style.color = type === 'error' ? '#ff6b6b' : '#FFD700';

            // Error messages stay longer (5 seconds) so users can read them
            const displayTime = type === 'error' ? 5000 : 3000;

            setTimeout(() => {
                notification.classList.remove('show');
            }, displayTime);
        }

        function showAddFriend() {
            const userId = prompt('Enter the User ID of the person you want to add as friend:');
            if (userId) {
                sendFriendRequest(userId);
            }
        }

        // Review Functions
        let currentReviewTab = 'given';
        let selectedRating = 0;

        async function loadReviewStats() {
            try {
                const [givenResponse, receivedResponse] = await Promise.all([
                    fetch(`${API_URL}/reviews/given`, {
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    }),
                    fetch(`${API_URL}/reviews/my-reviews`, {
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    })
                ]);

                if (givenResponse.ok && receivedResponse.ok) {
                    const givenData = await givenResponse.json();
                    const receivedData = await receivedResponse.json();

                    document.getElementById('reviewsGiven').textContent = givenData.total_count;
                    document.getElementById('reviewsReceived').textContent = receivedData.total_count;
                    document.getElementById('myRating').textContent = receivedData.average_rating ? receivedData.average_rating.toFixed(1) : '0.0';

                    // Calculate average rating given
                    if (givenData.reviews.length > 0) {
                        const avgGiven = givenData.reviews.reduce((sum, review) => sum + review.rating, 0) / givenData.reviews.length;
                        document.getElementById('avgRatingGiven').textContent = avgGiven.toFixed(1);
                    }
                }
            } catch (error) {
                console.error('Error loading review stats:', error);
            }
        }

        function switchReviewTab(tab) {
            currentReviewTab = tab;

            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Load content based on tab
            if (tab === 'given') {
                loadGivenReviews();
            } else if (tab === 'received') {
                loadReceivedReviews();
            } else if (tab === 'players') {
                loadReviewablePlayers();
            }
        }

        async function loadGivenReviews() {
            try {
                const response = await fetch(`${API_URL}/reviews/given`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayReviews(data.reviews, 'given');
                }
            } catch (error) {
                console.error('Error loading given reviews:', error);
            }
        }

        async function loadReceivedReviews() {
            try {
                const response = await fetch(`${API_URL}/reviews/my-reviews`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayReviews(data.reviews, 'received');
                }
            } catch (error) {
                console.error('Error loading received reviews:', error);
            }
        }

        async function loadReviewablePlayers() {
            try {
                const response = await fetch(`${API_URL}/friends/list`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    const players = data.friends.filter(friend => friend.user_type === 'player');
                    displayReviewablePlayers(players);
                }
            } catch (error) {
                console.error('Error loading reviewable players:', error);
            }
        }

        function displayReviews(reviews, type) {
            const container = document.getElementById('reviewsContent');

            if (reviews.length === 0) {
                container.innerHTML = `<div class="empty-state">No reviews ${type === 'given' ? 'given' : 'received'} yet.</div>`;
                return;
            }

            container.innerHTML = reviews.map(review => `
                <div class="review-card">
                    <div class="review-header">
                        <div class="review-user" style="cursor: pointer;" onclick="openProfileModal(${type === 'given' ? review.reviewee.id : review.reviewer.id})">
                            ${createAvatarHTML(type === 'given' ? review.reviewee : review.reviewer, 'review-avatar')}
                            <div class="user-info">
                                <div class="user-name">${type === 'given' ? review.reviewee.full_name : review.reviewer.full_name || 'Anonymous'}</div>
                                <div class="user-id">@${type === 'given' ? review.reviewee.user_id : review.reviewer.user_id}</div>
                            </div>
                        </div>
                        <div class="review-rating">
                            ${'â˜…'.repeat(review.rating)}${'â˜†'.repeat(5 - review.rating)}
                        </div>
                    </div>
                    <div class="review-content">
                        <h4 class="review-title">${review.title}</h4>
                        ${review.comment ? `<p class="review-comment">${review.comment}</p>` : ''}
                        <div class="review-date">${new Date(review.created_at).toLocaleDateString()}</div>
                    </div>
                    ${type === 'given' ? `
                        <div class="review-actions">
                            <button class="btn-icon" onclick="editReview(${review.id})" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon" onclick="deleteReview(${review.id})" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function displayReviewablePlayers(players) {
            const container = document.getElementById('reviewsContent');

            if (players.length === 0) {
                container.innerHTML = '<div class="empty-state">No players available to review. Add some player friends first!</div>';
                return;
            }

            container.innerHTML = players.map(player => `
                <div class="reviewable-player-card">
                    <div class="player-info" style="cursor: pointer;" onclick="openProfileModal(${player.id})">
                        ${createAvatarHTML(player, 'user-avatar')}
                        <div class="player-details">
                            <div class="user-name">${player.full_name || 'Anonymous'}</div>
                            <div class="user-id">@${player.user_id}</div>
                            <div class="user-stats">Level ${player.player_level} â€¢ ${player.credits} credits</div>
                        </div>
                    </div>
                    <button class="btn-secondary" onclick="openProfileModal(${player.id})">
                        <i class="fas fa-user"></i> View Profile
                    </button>
                    <button class="btn-primary" onclick="openReviewModal(${player.id})">
                        <i class="fas fa-star"></i> Review
                    </button>
                </div>
            `).join('');
        }

        function showWriteReviewModal() {
            loadReviewablePlayers();
            switchReviewTab('players');
        }

        async function openReviewModal(playerId) {
            try {
                // Check if can review
                const canReviewResponse = await fetch(`${API_URL}/reviews/can-review/${playerId}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (canReviewResponse.ok) {
                    const canReviewData = await canReviewResponse.json();

                    if (!canReviewData.can_review) {
                        showNotification(canReviewData.reason, 'error');
                        return;
                    }
                }

                // Load player list for modal
                const response = await fetch(`${API_URL}/friends/list`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    const players = data.friends.filter(friend => friend.user_type === 'player');

                    const select = document.getElementById('reviewPlayerSelect');
                    select.innerHTML = '<option value="">Select a player to review...</option>' +
                        players.map(player => `
                            <option value="${player.id}" ${player.id === playerId ? 'selected' : ''}>
                                ${player.full_name || 'Anonymous'} (@${player.user_id})
                            </option>
                        `).join('');

                    // Reset form
                    selectedRating = 0;
                    document.getElementById('reviewRating').value = '';
                    document.getElementById('reviewTitle').value = '';
                    document.getElementById('reviewComment').value = '';
                    updateRatingDisplay();

                    document.getElementById('reviewModal').classList.add('active');
                }
            } catch (error) {
                showNotification('Error opening review modal', 'error');
            }
        }

        function closeReviewModal() {
            document.getElementById('reviewModal').classList.remove('active');
        }

        // Profile Modal Functions
        let currentProfileUserId = null;

        async function openProfileModal(userId) {
            currentProfileUserId = userId;

            try {
                // Fetch user profile
                const response = await fetch(`${API_URL}/profiles/${userId}`, {
                    headers: authToken ? { 'Authorization': `Bearer ${authToken}` } : {}
                });

                if (response.ok) {
                    const profile = await response.json();

                    // Update profile header
                    document.getElementById('profileModalTitle').textContent =
                        profile.user_type === 'player' ? 'Player Profile' : 'Client Profile';
                    // Update profile avatar with profile picture
                    const profileAvatarElement = document.getElementById('profileAvatarText');
                    if (profile.profile_picture) {
                        const imageUrl = profile.profile_picture.startsWith('http') ?
                            profile.profile_picture : `${API_URL}${profile.profile_picture}`;
                        profileAvatarElement.innerHTML = `<img src="${imageUrl}" alt="${profile.full_name || profile.username}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
                    } else {
                        profileAvatarElement.textContent = (profile.full_name || profile.username || '?')[0].toUpperCase();
                    }
                    document.getElementById('profileFullName').textContent =
                        profile.full_name || 'Anonymous';
                    document.getElementById('profileUsername').textContent = profile.username;
                    document.getElementById('profileTypeBadge').textContent =
                        profile.user_type === 'player' ? 'Player' : 'Client';

                    // Update stats
                    document.getElementById('profileFriendsCount').textContent = profile.total_friends;
                    document.getElementById('profileReviewsCount').textContent = profile.reviews_received;
                    document.getElementById('profileRating').textContent =
                        profile.average_rating ? profile.average_rating.toFixed(1) : '0.0';

                    // Update specific stat based on user type
                    if (profile.user_type === 'player') {
                        document.getElementById('profileSpecificValue').textContent = profile.total_clients;
                        document.getElementById('profileSpecificLabel').textContent = 'Clients';
                        document.getElementById('profileLevelItem').style.display = 'block';
                        document.getElementById('profileLevel').textContent = `Level ${profile.player_level}`;
                        document.getElementById('profileCompanyItem').style.display = 'none';

                        // Show email verification status for players
                        document.getElementById('profileEmailVerificationItem').style.display = 'block';
                        const emailVerification = document.getElementById('profileEmailVerification');
                        if (profile.is_email_verified && profile.secondary_email) {
                            emailVerification.innerHTML = '<span style="color: #4CAF50;"><i class="fas fa-check-circle"></i> Verified</span>';
                        } else if (profile.secondary_email && !profile.is_email_verified) {
                            emailVerification.innerHTML = '<span style="color: #FF9800;"><i class="fas fa-exclamation-triangle"></i> Pending</span>';
                        } else {
                            emailVerification.innerHTML = '<span style="color: #888;"><i class="fas fa-times-circle"></i> Not Set</span>';
                        }
                    } else {
                        document.getElementById('profileSpecificValue').textContent = profile.total_players;
                        document.getElementById('profileSpecificLabel').textContent = 'Players';
                        document.getElementById('profileCompanyItem').style.display = 'block';
                        document.getElementById('profileCompany').textContent = profile.company_name || 'N/A';
                        document.getElementById('profileLevelItem').style.display = 'none';
                        document.getElementById('profileEmailVerificationItem').style.display = 'none';
                    }

                    // Update account info
                    const createdDate = new Date(profile.created_at);
                    document.getElementById('profileCreatedAt').textContent = createdDate.toLocaleDateString();
                    document.getElementById('profileAccountAge').textContent = `${profile.account_age_days} days`;

                    // Update tab counts
                    document.getElementById('profileReviewsTabCount').textContent = profile.reviews_received;

                    // Update payment methods for clients
                    const paymentMethodsSection = document.getElementById('profilePaymentMethodsSection');
                    const paymentMethodsContainer = document.getElementById('profilePaymentMethods');

                    if (profile.user_type === 'client' && profile.accepted_payment_methods) {
                        paymentMethodsSection.style.display = 'block';

                        if (profile.accepted_payment_methods.length > 0) {
                            paymentMethodsContainer.innerHTML = profile.accepted_payment_methods.map(method => `
                                <div class="profile-payment-method">
                                    <div class="profile-payment-method-icon">
                                        ${method.icon_url ?
                                            `<img src="${method.icon_url}" alt="${method.display_name}" onerror="this.style.display='none'">` :
                                            `<i class="fas fa-credit-card"></i>`
                                        }
                                    </div>
                                    <div class="profile-payment-method-name">${method.display_name}</div>
                                </div>
                            `).join('');
                        } else {
                            paymentMethodsContainer.innerHTML = '<div style="color: var(--text-secondary);">No payment methods selected</div>';
                        }
                    } else {
                        paymentMethodsSection.style.display = 'none';
                    }

                    // Update available games for clients and players
                    const gamesSection = document.getElementById('profileGamesSection');
                    const gamesContainer = document.getElementById('profileAvailableGames');

                    if (profile.user_type === 'client' && profile.available_games && profile.available_games.length > 0) {
                        // Use games data from API response (FIXED: was using localStorage)
                        gamesSection.style.display = 'block';
                        gamesContainer.innerHTML = profile.available_games.map(game => `
                            <div class="profile-game-card" title="${game.display_name}">
                                <div class="profile-game-icon">
                                    ${game.icon_url ?
                                        `<img src="${game.icon_url}" alt="${game.display_name}"
                                             onerror="this.style.display='none'; this.parentElement.querySelector('.fa-gamepad').style.display='block';">
                                         <i class="fas fa-gamepad" style="font-size: 1.5rem; color: var(--primary-gold); display: none;"></i>` :
                                        `<i class="fas fa-gamepad" style="font-size: 1.5rem; color: var(--primary-gold);"></i>`
                                    }
                                </div>
                                <div class="profile-game-name">${game.display_name}</div>
                            </div>
                        `).join('');
                    } else if (profile.user_type === 'player' && profile.available_games) {
                        gamesSection.style.display = 'block';

                        if (profile.available_games.length > 0) {
                            gamesContainer.innerHTML = profile.available_games.map(game => `
                                <div class="profile-game-card" title="${game.display_name}">
                                    <div class="profile-game-icon">
                                        ${game.icon_url ?
                                            `<img src="${API_URL}${game.icon_url}" alt="${game.display_name}" onerror="this.style.display='none'">` :
                                            `<i class="fas fa-gamepad" style="font-size: 1.5rem; color: var(--primary-gold);"></i>`
                                        }
                                    </div>
                                    <div class="profile-game-name">${game.display_name}</div>
                                </div>
                            `).join('');
                        } else {
                            gamesContainer.innerHTML = '<div style="color: var(--text-secondary);">No games available</div>';
                        }
                    } else {
                        gamesSection.style.display = 'none';
                    }

                    // Load reviews
                    loadProfileReviews(userId);

                    // Update actions based on relationship
                    updateProfileActions(profile);

                    // Show modal
                    document.getElementById('profileModal').classList.add('active');
                }
            } catch (error) {
                console.error('Error loading profile:', error);
                showNotification('Error loading profile', 'error');
            }
        }

        function closeProfileModal() {
            document.getElementById('profileModal').classList.remove('active');
            currentProfileUserId = null;
        }

        async function loadProfileReviews(userId) {
            try {
                const response = await fetch(`${API_URL}/profiles/${userId}/reviews?limit=10`, {
                    headers: authToken ? { 'Authorization': `Bearer ${authToken}` } : {}
                });

                if (response.ok) {
                    const data = await response.json();
                    const reviewsList = document.getElementById('profileReviewsList');

                    if (data.reviews.length === 0) {
                        reviewsList.innerHTML = '<p style="color: #b8b8b8;">No reviews yet</p>';
                    } else {
                        reviewsList.innerHTML = data.reviews.map(review => `
                            <div class="profile-review-card">
                                <div class="profile-review-header">
                                    <div class="profile-review-rating">
                                        ${'â˜…'.repeat(review.rating)}${'â˜†'.repeat(5 - review.rating)}
                                    </div>
                                    <div class="profile-review-author">
                                        by <span class="profile-link" onclick="openProfileModal(${review.reviewer.id})">
                                            ${review.reviewer.full_name || review.reviewer.username}
                                        </span>
                                    </div>
                                </div>
                                <div class="profile-review-title">${review.title}</div>
                                ${review.comment ? `<div class="profile-review-comment">${review.comment}</div>` : ''}
                            </div>
                        `).join('');
                    }
                }
            } catch (error) {
                console.error('Error loading reviews:', error);
            }
        }

        async function loadProfileFriends(userId) {
            try {
                const response = await fetch(`${API_URL}/profiles/${userId}/friends?limit=20`, {
                    headers: authToken ? { 'Authorization': `Bearer ${authToken}` } : {}
                });

                if (response.ok) {
                    const data = await response.json();
                    const friendsList = document.getElementById('profileFriendsList');

                    if (data.friends.length === 0) {
                        friendsList.innerHTML = '<p style="color: #b8b8b8;">No friends yet</p>';
                    } else {
                        friendsList.innerHTML = data.friends.map(friend => `
                            <div class="profile-friend-card" onclick="openProfileModal(${friend.id})">
                                <div class="profile-friend-avatar">
                                    ${(friend.full_name || friend.username || '?')[0].toUpperCase()}
                                </div>
                                <div class="profile-friend-name">${friend.full_name || 'Anonymous'}</div>
                                <div class="profile-friend-username">@${friend.username}</div>
                            </div>
                        `).join('');
                    }
                }
            } catch (error) {
                console.error('Error loading friends:', error);
            }
        }

        function switchProfileTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.profile-tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update tab panes
            document.querySelectorAll('.profile-tab-pane').forEach(pane => {
                pane.style.display = 'none';
                pane.classList.remove('active');
            });

            if (tab === 'reviews') {
                document.getElementById('profileReviewsTab').style.display = 'block';
                document.getElementById('profileReviewsTab').classList.add('active');
            } else if (tab === 'reports') {
                document.getElementById('profileReportsTab').style.display = 'block';
                document.getElementById('profileReportsTab').classList.add('active');

                // Load reports when reports tab is opened
                if (currentProfileUserId) {
                    loadUserReports(currentProfileUserId);
                }
            }
        }

        function updateProfileActions(profile) {
            const actionsDiv = document.getElementById('profileActions');
            let actionsHTML = '';

            if (currentUser && profile.id !== currentUser.id) {
                if (profile.is_friend) {
                    actionsHTML += `
                        <button class="btn-primary" onclick="startChat(${profile.id})">
                            <i class="fas fa-comment"></i> Send Message
                        </button>
                        <button class="btn-secondary" onclick="openReviewModal(${profile.id})">
                            <i class="fas fa-star"></i> Write Review
                        </button>
                    `;
                } else {
                    actionsHTML += `
                        <button class="btn-primary" onclick="sendFriendRequestFromProfile(${profile.id})">
                            <i class="fas fa-user-plus"></i> Send Friend Request
                        </button>
                    `;
                }
            }

            actionsDiv.innerHTML = actionsHTML;
        }

        async function sendFriendRequestFromProfile(userId) {
            try {
                const userResponse = await fetch(`${API_URL}/users/${userId}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (userResponse.ok) {
                    const user = await userResponse.json();
                    await sendFriendRequest(user.user_id);
                    closeProfileModal();
                }
            } catch (error) {
                console.error('Error sending friend request:', error);
                showNotification('Error sending friend request', 'error');
            }
        }

        // Rating system
        document.addEventListener('DOMContentLoaded', function() {
            const ratingStars = document.querySelectorAll('.rating-star');

            ratingStars.forEach(star => {
                star.addEventListener('click', function() {
                    selectedRating = parseInt(this.dataset.rating);
                    document.getElementById('reviewRating').value = selectedRating;
                    updateRatingDisplay();
                });

                star.addEventListener('mouseover', function() {
                    const rating = parseInt(this.dataset.rating);
                    highlightStars(rating);
                });
            });

            // Reset on mouse leave
            document.querySelector('.rating-input').addEventListener('mouseleave', function() {
                updateRatingDisplay();
            });
        });

        function highlightStars(rating) {
            const stars = document.querySelectorAll('.rating-star');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }

        function updateRatingDisplay() {
            highlightStars(selectedRating);
        }

        async function submitReview(event) {
            event.preventDefault();

            const playerId = document.getElementById('reviewPlayerSelect').value;
            const rating = document.getElementById('reviewRating').value;
            const title = document.getElementById('reviewTitle').value;
            const comment = document.getElementById('reviewComment').value;

            if (!playerId || !rating || !title) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/reviews/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        reviewee_id: parseInt(playerId),
                        rating: parseInt(rating),
                        title: title,
                        comment: comment || null
                    })
                });

                if (response.ok) {
                    showNotification('Review submitted successfully!', 'success');
                    closeReviewModal();
                    loadReviewStats();
                    loadGivenReviews();
                } else {
                    const error = await response.json();
                    showNotification(error.detail || 'Failed to submit review', 'error');
                }
            } catch (error) {
                showNotification('Failed to submit review', 'error');
            }
        }

        async function deleteReview(reviewId) {
            if (confirm('Are you sure you want to delete this review?')) {
                try {
                    const response = await fetch(`${API_URL}/reviews/${reviewId}`, {
                        method: 'DELETE',
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    });

                    if (response.ok) {
                        showNotification('Review deleted successfully', 'success');
                        loadReviewStats();
                        if (currentReviewTab === 'given') {
                            loadGivenReviews();
                        }
                    } else {
                        showNotification('Failed to delete review', 'error');
                    }
                } catch (error) {
                    showNotification('Failed to delete review', 'error');
                }
            }
        }

        // Promotions Functions
        let currentPromotionTab = 'active';
        let allPromotions = [];

        async function loadPromotions() {
            try {
                const response = await fetch(`${API_URL}/promotions/my-promotions`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    allPromotions = data;
                    updatePromotionStats(data);
                    displayPromotions(currentPromotionTab);
                }
            } catch (error) {
                console.error('Error loading promotions:', error);
            }
        }

        function updatePromotionStats(promotions) {
            const activeCount = promotions.filter(p => p.status === 'active').length;
            const totalClaims = promotions.reduce((sum, p) => sum + p.claims_count, 0);
            const creditsDistributed = promotions.reduce((sum, p) => sum + (p.used_budget || 0), 0);

            let avgClaimRate = 0;
            if (activeCount > 0) {
                const totalPossibleClaims = promotions.reduce((sum, p) => {
                    return sum + (p.max_claims_per_player * 10); // Assuming avg 10 players
                }, 0);
                avgClaimRate = totalPossibleClaims > 0 ? (totalClaims / totalPossibleClaims * 100).toFixed(1) : 0;
            }

            document.getElementById('activePromotions').textContent = activeCount;
            document.getElementById('totalClaims').textContent = totalClaims;
            document.getElementById('creditsDistributed').textContent = creditsDistributed;
            document.getElementById('avgClaimRate').textContent = avgClaimRate + '%';

            // Update badge
            if (activeCount > 0) {
                document.getElementById('promotionsBadge').textContent = activeCount;
                document.getElementById('promotionsBadge').style.display = 'inline-block';
            } else {
                document.getElementById('promotionsBadge').style.display = 'none';
            }
        }

        function switchPromotionTab(tab) {
            currentPromotionTab = tab;

            // Update tab buttons
            const tabs = document.querySelectorAll('#promotions-section .tab-btn');
            tabs.forEach(t => {
                t.classList.remove('active');
                if (t.textContent.toLowerCase().includes(tab.toLowerCase()) ||
                    (tab === 'all' && t.textContent === 'All Promotions')) {
                    t.classList.add('active');
                }
            });

            displayPromotions(tab);
        }

        function displayPromotions(filter) {
            const container = document.getElementById('promotionsList');
            let filtered = allPromotions;

            if (filter === 'active') {
                filtered = allPromotions.filter(p => p.status === 'active');
            } else if (filter === 'expired') {
                filtered = allPromotions.filter(p => p.status === 'expired' || p.status === 'depleted');
            }

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #888;">
                        <i class="fas fa-gift" style="font-size: 3rem; margin-bottom: 1rem; color: #444;"></i>
                        <p>No ${filter !== 'all' ? filter : ''} promotions found</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filtered.map(promo => {
                const endDate = new Date(promo.end_date);
                const now = new Date();
                const daysLeft = Math.ceil((endDate - now) / (1000 * 60 * 60 * 24));
                const progressPercent = promo.total_budget ?
                    ((promo.used_budget / promo.total_budget) * 100).toFixed(0) : 0;

                return `
                    <div class="promotion-card">
                        <div class="promotion-header">
                            <div>
                                <div class="promotion-title">${promo.title}</div>
                                <span class="promotion-type">${promo.promotion_type.replace('_', ' ')}</span>
                            </div>
                            <span class="promotion-status ${promo.status}">${promo.status}</span>
                        </div>

                        ${promo.description ? `<p style="margin: 1rem 0; color: #ccc;">${promo.description}</p>` : ''}

                        <div class="promotion-details">
                            <div class="promotion-detail">
                                <i class="fas fa-coins"></i>
                                <span class="promotion-detail-label">Value:</span>
                                <span class="promotion-detail-value">${promo.value} ${promo.promotion_type.includes('cashback') ? '%' : 'credits'}</span>
                            </div>
                            <div class="promotion-detail">
                                <i class="fas fa-users"></i>
                                <span class="promotion-detail-label">Claims:</span>
                                <span class="promotion-detail-value">${promo.claims_count}</span>
                            </div>
                            <div class="promotion-detail">
                                <i class="fas fa-layer-group"></i>
                                <span class="promotion-detail-label">Player Level:</span>
                                <span class="promotion-detail-value">â‰¥ ${promo.min_player_level}</span>
                            </div>
                            <div class="promotion-detail">
                                <i class="fas fa-dice"></i>
                                <span class="promotion-detail-label">Wagering:</span>
                                <span class="promotion-detail-value">${promo.wagering_requirement}x</span>
                            </div>
                        </div>

                        ${promo.total_budget ? `
                            <div class="promotion-progress">
                                <div class="promotion-progress-label">
                                    <span>Budget Used</span>
                                    <span>${promo.used_budget} / ${promo.total_budget} credits</span>
                                </div>
                                <div class="promotion-progress-bar">
                                    <div class="promotion-progress-fill" style="width: ${progressPercent}%"></div>
                                </div>
                            </div>
                        ` : ''}

                        <div class="promotion-details" style="margin-top: 1rem;">
                            <div class="promotion-detail">
                                <i class="fas fa-calendar"></i>
                                <span class="promotion-detail-label">Ends:</span>
                                <span class="promotion-detail-value">
                                    ${promo.status === 'active' ? `${daysLeft} days` : endDate.toLocaleDateString()}
                                </span>
                            </div>
                            <div class="promotion-detail">
                                <i class="fas fa-redo"></i>
                                <span class="promotion-detail-label">Max claims/player:</span>
                                <span class="promotion-detail-value">${promo.max_claims_per_player}</span>
                            </div>
                        </div>

                        <div class="promotion-actions">
                            <button class="btn-secondary" onclick="viewPromotionDetails(${promo.id})">
                                <i class="fas fa-chart-line"></i> View Stats
                            </button>
                            ${promo.status === 'active' ? `
                                <button class="btn-secondary" onclick="sharePromotion(${promo.id})">
                                    <i class="fas fa-share"></i> Share
                                </button>
                                <button class="btn-danger" onclick="cancelPromotion(${promo.id})">
                                    <i class="fas fa-times"></i> Cancel
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showCreatePromotionModal() {
            document.getElementById('createPromotionModal').style.display = 'flex';
            loadPlayersForPromotion();
        }

        function closeCreatePromotionModal() {
            document.getElementById('createPromotionModal').style.display = 'none';
            document.getElementById('createPromotionForm').reset();
        }

        async function loadPlayersForPromotion() {
            try {
                const response = await fetch(`${API_URL}/friends/list`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    const playerFriends = data.friends.filter(f => f.user_type === 'player');

                    const playersList = document.getElementById('playersList');
                    if (playerFriends.length === 0) {
                        playersList.innerHTML = '<p style="padding: 1rem; color: #888;">No player friends connected yet</p>';
                    } else {
                        playersList.innerHTML = playerFriends.map(player => `
                            <div class="player-checkbox">
                                <input type="checkbox" id="player_${player.id}" value="${player.id}" checked>
                                <label for="player_${player.id}">
                                    ${player.full_name || player.username} (Level ${player.player_level || 1})
                                </label>
                            </div>
                        `).join('');
                    }
                }
            } catch (error) {
                console.error('Error loading players:', error);
            }
        }

        function toggleAllPlayers() {
            const selectAll = document.getElementById('selectAllPlayers');
            const playersList = document.getElementById('playersList');

            if (selectAll.checked) {
                playersList.style.display = 'none';
                // Check all players
                const checkboxes = playersList.querySelectorAll('input[type="checkbox"]');
                checkboxes.forEach(cb => cb.checked = true);
            } else {
                playersList.style.display = 'block';
            }
        }

        // Handle promotion form submission
        document.getElementById('createPromotionForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const selectAll = document.getElementById('selectAllPlayers');
            let targetPlayerIds = null;

            if (!selectAll.checked) {
                const checkedBoxes = document.querySelectorAll('#playersList input[type="checkbox"]:checked');
                if (checkedBoxes.length > 0) {
                    targetPlayerIds = Array.from(checkedBoxes).map(cb => parseInt(cb.value));
                }
            }

            const promotionData = {
                title: document.getElementById('promotionTitle').value,
                description: document.getElementById('promotionDescription').value || null,
                promotion_type: document.getElementById('promotionType').value,
                value: parseInt(document.getElementById('promotionValue').value),
                max_claims_per_player: parseInt(document.getElementById('maxClaimsPerPlayer').value) || 1,
                total_budget: document.getElementById('totalBudget').value ?
                    parseInt(document.getElementById('totalBudget').value) : null,
                min_player_level: parseInt(document.getElementById('minPlayerLevel').value) || 1,
                end_date: new Date(document.getElementById('endDate').value).toISOString(),
                target_player_ids: targetPlayerIds,
                terms: document.getElementById('promotionTerms').value || null,
                wagering_requirement: parseInt(document.getElementById('wageringRequirement').value) || 1
            };

            try {
                const response = await fetch(`${API_URL}/promotions/create`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(promotionData)
                });

                if (response.ok) {
                    showNotification('Promotion created successfully!', 'success');
                    closeCreatePromotionModal();
                    loadPromotions();
                } else {
                    const error = await response.json();
                    showNotification(error.detail || 'Failed to create promotion', 'error');
                }
            } catch (error) {
                console.error('Error creating promotion:', error);
                showNotification('Failed to create promotion', 'error');
            }
        });

        async function viewPromotionDetails(promotionId) {
            try {
                const response = await fetch(`${API_URL}/promotions/stats/${promotionId}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const stats = await response.json();

                    document.getElementById('promotionDetailsTitle').textContent = stats.title;
                    document.getElementById('promotionDetailsContent').innerHTML = `
                        <div class="promotion-stats">
                            <h3>Performance Statistics</h3>
                            <div class="dashboard-grid" style="margin: 1.5rem 0;">
                                <div class="stat-card">
                                    <div class="stat-icon"><i class="fas fa-users"></i></div>
                                    <div class="stat-label">Total Claims</div>
                                    <div class="stat-value">${stats.total_claims}</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon"><i class="fas fa-user-check"></i></div>
                                    <div class="stat-label">Unique Players</div>
                                    <div class="stat-value">${stats.unique_players}</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon"><i class="fas fa-coins"></i></div>
                                    <div class="stat-label">Credits Claimed</div>
                                    <div class="stat-value">${stats.total_value_claimed}</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon"><i class="fas fa-percentage"></i></div>
                                    <div class="stat-label">Claim Rate</div>
                                    <div class="stat-value">${stats.claim_rate.toFixed(1)}%</div>
                                </div>
                            </div>

                            ${stats.remaining_budget !== null ? `
                                <div class="promotion-progress">
                                    <div class="promotion-progress-label">
                                        <span>Budget Utilization</span>
                                        <span>${stats.total_value_claimed} / ${stats.total_value_claimed + stats.remaining_budget} credits</span>
                                    </div>
                                    <div class="promotion-progress-bar">
                                        <div class="promotion-progress-fill" style="width: ${((stats.total_value_claimed / (stats.total_value_claimed + stats.remaining_budget)) * 100).toFixed(0)}%"></div>
                                    </div>
                                </div>
                            ` : ''}

                            <div style="margin-top: 1.5rem;">
                                <p><strong>Status:</strong> <span class="promotion-status ${stats.status}">${stats.status}</span></p>
                                <p style="margin-top: 0.5rem;"><strong>Average Claim Value:</strong> ${stats.avg_claim_value.toFixed(0)} credits</p>
                            </div>
                        </div>
                    `;

                    document.getElementById('promotionDetailsModal').style.display = 'flex';
                }
            } catch (error) {
                console.error('Error loading promotion stats:', error);
                showNotification('Failed to load promotion statistics', 'error');
            }
        }

        function closePromotionDetailsModal() {
            document.getElementById('promotionDetailsModal').style.display = 'none';
        }

        // Close modal when clicking outside of it
        document.getElementById('promotionDetailsModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closePromotionDetailsModal();
            }
        });

        async function approvePromotionClaim(promotionId, playerId) {
            if (!confirm('Approve this promotion claim? The player will receive the promotion benefits.')) {
                return;
            }

            try {
                const response = await fetch(`${API_URL}/promotions/approve-claim`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        promotion_id: promotionId,
                        player_id: playerId
                    })
                });

                if (response.ok) {
                    showNotification('Promotion claim approved successfully!', 'success');

                    // Send confirmation message to player
                    const confirmMessage = `âœ… Your promotion claim has been APPROVED!\n\nThe promotion benefits have been added to your account.\n\nThank you for playing with us! ðŸŽ®`;

                    const messageData = new FormData();
                    messageData.append('receiver_id', playerId);
                    messageData.append('content', confirmMessage);

                    await fetch(`${API_URL}/chat/send/text`, {
                        method: 'POST',
                        headers: { 'Authorization': `Bearer ${authToken}` },
                        body: messageData
                    });

                    // Reload messages to show the confirmation
                    await loadMessages(playerId);

                    // Reload promotions to update stats
                    loadPromotions();
                } else {
                    const error = await response.json();
                    showNotification(error.detail || 'Failed to approve claim', 'error');
                }
            } catch (error) {
                console.error('Error approving claim:', error);
                showNotification('Failed to approve claim', 'error');
            }
        }

        async function rejectPromotionClaim(promotionId, playerId) {
            const reason = prompt('Please provide a reason for rejection (optional):');

            try {
                // Send rejection message to player
                const rejectMessage = `âŒ Your promotion claim has been REJECTED.\n\n${reason ? `Reason: ${reason}\n\n` : ''}Please contact support if you have questions.`;

                const messageData = new FormData();
                messageData.append('receiver_id', playerId);
                messageData.append('content', rejectMessage);

                const response = await fetch(`${API_URL}/chat/send/text`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${authToken}` },
                    body: messageData
                });

                if (response.ok) {
                    showNotification('Claim rejection sent to player', 'info');
                    // Reload messages to show the rejection
                    await loadMessages(playerId);
                }
            } catch (error) {
                console.error('Error rejecting claim:', error);
                showNotification('Failed to send rejection', 'error');
            }
        }

        async function cancelPromotion(promotionId) {
            if (!confirm('Are you sure you want to cancel this promotion? This action cannot be undone.')) {
                return;
            }

            try {
                const response = await fetch(`${API_URL}/promotions/${promotionId}/cancel`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    showNotification('Promotion cancelled successfully', 'success');
                    loadPromotions();
                } else {
                    showNotification('Failed to cancel promotion', 'error');
                }
            } catch (error) {
                console.error('Error cancelling promotion:', error);
                showNotification('Failed to cancel promotion', 'error');
            }
        }

        function sharePromotion(promotionId) {
            // This could open a share modal or copy a link
            showNotification('Share feature coming soon!', 'info');
        }

        // Profile Picture Functions
        function selectProfilePicture() {
            document.getElementById('profilePictureInput').click();
        }

        document.getElementById('profilePictureInput').addEventListener('change', async function(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Validate file type
            if (!file.type.startsWith('image/')) {
                showNotification('Please select an image file', 'error');
                return;
            }

            // Validate file size (5MB max)
            if (file.size > 5 * 1024 * 1024) {
                showNotification('File size too large. Maximum 5MB allowed', 'error');
                return;
            }

            // Show preview
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.getElementById('profilePictureImage');
                const placeholder = document.getElementById('profilePicturePlaceholder');
                const deleteBtn = document.getElementById('deleteProfilePictureBtn');

                img.src = e.target.result;
                img.style.display = 'block';
                placeholder.style.display = 'none';
                deleteBtn.style.display = 'block';
            };
            reader.readAsDataURL(file);

            // Upload file
            await uploadProfilePicture(file);
        });

        async function uploadProfilePicture(file) {
            try {
                const formData = new FormData();
                formData.append('file', file);

                const response = await fetch(`${API_URL}/profiles/${currentUser.id}/profile-picture`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });

                if (response.ok) {
                    const result = await response.json();
                    showNotification('Profile picture uploaded successfully!', 'success');

                    // Update current user object
                    currentUser.profile_picture = result.profile_picture_url;

                    // Update profile picture in header
                    updateHeaderProfilePicture();
                } else {
                    const error = await response.json();
                    showNotification(error.detail || 'Failed to upload profile picture', 'error');
                }
            } catch (error) {
                console.error('Error uploading profile picture:', error);
                showNotification('Failed to upload profile picture', 'error');
            }
        }

        async function deleteProfilePicture() {
            try {
                const response = await fetch(`${API_URL}/profiles/${currentUser.id}/profile-picture`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const img = document.getElementById('profilePictureImage');
                    const placeholder = document.getElementById('profilePicturePlaceholder');
                    const deleteBtn = document.getElementById('deleteProfilePictureBtn');

                    img.style.display = 'none';
                    placeholder.style.display = 'block';
                    deleteBtn.style.display = 'none';

                    // Update current user object
                    currentUser.profile_picture = null;

                    // Update profile picture in header
                    updateHeaderProfilePicture();

                    showNotification('Profile picture deleted successfully!', 'success');
                } else {
                    const error = await response.json();
                    showNotification(error.detail || 'Failed to delete profile picture', 'error');
                }
            } catch (error) {
                console.error('Error deleting profile picture:', error);
                showNotification('Failed to delete profile picture', 'error');
            }
        }

        function updateHeaderProfilePicture() {
            // Update the main user avatar
            updateUserAvatar('userAvatar', currentUser);
        }

        function updateUserAvatar(elementId, user) {
            const avatarElement = document.getElementById(elementId);
            if (!avatarElement) return;

            if (user.profile_picture) {
                const imageUrl = user.profile_picture.startsWith('http') ?
                    user.profile_picture : `${API_URL}${user.profile_picture}`;

                avatarElement.innerHTML = `<img src="${imageUrl}" alt="${user.full_name || user.username}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
            } else {
                avatarElement.textContent = (user.full_name || user.username).charAt(0).toUpperCase();
            }
        }

        function createAvatarHTML(user, className = 'user-avatar', onClick = null, showOnlineStatus = true) {
            const clickHandler = onClick ? `onclick="${onClick}"` : '';
            const onlineStatus = showOnlineStatus ? getOnlineStatus(user) : null;
            const onlineIndicator = showOnlineStatus ? `<div class="online-indicator ${onlineStatus.class}"></div>` : '';

            if (user.profile_picture) {
                const imageUrl = user.profile_picture.startsWith('http') ?
                    user.profile_picture : `${API_URL}${user.profile_picture}`;

                return `<div class="${className}" ${clickHandler} style="position: relative;">
                    <img src="${imageUrl}" alt="${user.full_name || user.username}"
                         style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                    ${onlineIndicator}
                </div>`;
            } else {
                const initial = (user.full_name || user.username).charAt(0).toUpperCase();
                return `<div class="${className}" ${clickHandler} style="position: relative;">${initial}${onlineIndicator}</div>`;
            }
        }

        // Helper function to format time ago
        function timeAgo(dateString) {
            if (!dateString) return 'Never';
            const now = new Date();
            const date = new Date(dateString);
            const diffInSeconds = Math.floor((now - date) / 1000);

            if (diffInSeconds < 60) return 'Just now';
            if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)}m ago`;
            if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)}h ago`;
            if (diffInSeconds < 604800) return `${Math.floor(diffInSeconds / 86400)}d ago`;
            return date.toLocaleDateString();
        }

        // Helper function to get online status
        function getOnlineStatus(user) {
            if (user.is_online) {
                return { class: 'online', text: 'Online' };
            }

            if (!user.last_seen) {
                return { class: 'offline', text: 'Offline' };
            }

            const lastSeen = new Date(user.last_seen);
            const now = new Date();
            const diffInMinutes = Math.floor((now - lastSeen) / (1000 * 60));

            if (diffInMinutes < 5) {
                return { class: 'away', text: 'Away' };
            }

            return { class: 'offline', text: `Last seen ${timeAgo(user.last_seen)}` };
        }

        function loadProfilePicture() {
            if (currentUser.profile_picture) {
                const img = document.getElementById('profilePictureImage');
                const placeholder = document.getElementById('profilePicturePlaceholder');
                const deleteBtn = document.getElementById('deleteProfilePictureBtn');

                const imageUrl = currentUser.profile_picture.startsWith('http') ?
                    currentUser.profile_picture : `${API_URL}${currentUser.profile_picture}`;

                img.src = imageUrl;
                img.style.display = 'block';
                placeholder.style.display = 'none';
                deleteBtn.style.display = 'block';
            }
        }

        // Payment Methods Functions
        let availablePaymentMethods = [];
        let selectedPaymentMethods = [];

        async function loadPaymentMethods() {
            try {
                // Load available payment methods
                const methodsResponse = await fetch(`${API_URL}/payment-methods/`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (methodsResponse.ok) {
                    availablePaymentMethods = await methodsResponse.json();
                }

                // Load client's selected payment methods
                const selectedResponse = await fetch(`${API_URL}/payment-methods/my-methods`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (selectedResponse.ok) {
                    const data = await selectedResponse.json();
                    selectedPaymentMethods = data.accepted_methods.map(m => m.id);
                }

                renderPaymentMethods();
            } catch (error) {
                console.error('Error loading payment methods:', error);
                showNotification('Failed to load payment methods', 'error');
            }
        }

        function renderPaymentMethods() {
            const container = document.getElementById('paymentMethodsGrid');

            if (availablePaymentMethods.length === 0) {
                container.innerHTML = '<div class="loading-spinner">No payment methods available</div>';
                return;
            }

            container.innerHTML = availablePaymentMethods.map(method => `
                <div class="payment-method-card ${selectedPaymentMethods.includes(method.id) ? 'selected' : ''}"
                     onclick="togglePaymentMethod(${method.id})">
                    <div class="payment-method-icon">
                        ${method.icon_url ?
                            `<img src="${method.icon_url}" alt="${method.display_name}" onerror="this.style.display='none'">` :
                            `<i class="fas fa-credit-card"></i>`
                        }
                    </div>
                    <div class="payment-method-info">
                        <div class="payment-method-name">${method.display_name}</div>
                        <div class="payment-method-type">Payment Method</div>
                    </div>
                    <div class="payment-method-checkbox ${selectedPaymentMethods.includes(method.id) ? 'checked' : ''}"></div>
                </div>
            `).join('');
        }

        function togglePaymentMethod(methodId) {
            const index = selectedPaymentMethods.indexOf(methodId);

            if (index > -1) {
                selectedPaymentMethods.splice(index, 1);
            } else {
                selectedPaymentMethods.push(methodId);
            }

            renderPaymentMethods();
        }

        async function savePaymentMethods() {
            try {
                const response = await fetch(`${API_URL}/payment-methods/update-methods`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        payment_method_ids: selectedPaymentMethods
                    })
                });

                if (response.ok) {
                    showNotification('Payment methods updated successfully!', 'success');
                } else {
                    const error = await response.json();
                    showNotification(error.detail || 'Failed to update payment methods', 'error');
                }
            } catch (error) {
                console.error('Error saving payment methods:', error);
                showNotification('Failed to save payment methods', 'error');
            }
        }

        // Games Management
        let allGames = [];
        let selectedGameIds = new Set();
        let currentCategory = 'all';
        let friends = [];

        async function loadAvailableGames() {
            try {
                // Hardcoded games list based on available images
                allGames = [
                    { id: 1, name: "Blue Dragon", image: "bluedragon.png", category: "slots" },
                    { id: 2, name: "Cash Frenzy", image: "cashfrenzy 1.png", category: "slots" },
                    { id: 3, name: "Cash Machine", image: "cashmachine.png", category: "slots" },
                    { id: 4, name: "Casino Ignite", image: "casinoignitee.jpg", category: "casino" },
                    { id: 5, name: "Casino Royale", image: "casinoroyale.png", category: "casino" },
                    { id: 6, name: "E-Games", image: "Egames.png", category: "multi-game" },
                    { id: 7, name: "Fire Kirin", image: "firekirin.png", category: "fish" },
                    { id: 8, name: "Game Room Online", image: "Gameroom online.png", category: "multi-game" },
                    { id: 9, name: "Game Vault", image: "gamevault.png", category: "multi-game" },
                    { id: 10, name: "High Stake", image: "Highstake.jpg", category: "casino" },
                    { id: 11, name: "Joker 777", image: "joker 777.png", category: "slots" },
                    { id: 12, name: "Juwa Online", image: "juwaonline.png", category: "multi-game" },
                    { id: 13, name: "Loot", image: "loot.jpg", category: "slots" },
                    { id: 14, name: "Mega Spin", image: "Megaspin.jpg", category: "slots" },
                    { id: 15, name: "Milky Way", image: "milkyway 2.png", category: "multi-game" },
                    { id: 16, name: "Moolah", image: "moolah.jpg", category: "slots" },
                    { id: 17, name: "Orion Stars", image: "orionstars.jpg", category: "multi-game" },
                    { id: 18, name: "Panda Master", image: "Panda Master.jpg", category: "multi-game" },
                    { id: 19, name: "Para Casino", image: "Paracasino.jpg", category: "casino" },
                    { id: 20, name: "River Monster", image: "rivermonster 1.png", category: "fish" },
                    { id: 21, name: "River Sweeps", image: "riversweeps 1.png", category: "sweepstakes" },
                    { id: 22, name: "River Sweeps 2", image: "riversweeps 2.png", category: "sweepstakes" },
                    { id: 23, name: "River Sweeps 3", image: "riversweeps 3.png", category: "sweepstakes" },
                    { id: 24, name: "Sirius", image: "sirus.png", category: "multi-game" },
                    { id: 25, name: "Ultra Panda", image: "ultrapanda.png", category: "multi-game" },
                    { id: 26, name: "VBlink", image: "vblink 2.png", category: "multi-game" },
                    { id: 27, name: "Vega Sweeps", image: "Vega Sweeps.png", category: "sweepstakes" },
                    { id: 28, name: "Vegas X", image: "vegas x.png", category: "casino" },
                    { id: 29, name: "Vegas Roll", image: "vegasroll.png", category: "casino" },
                    { id: 30, name: "Win Star", image: "winstar.png", category: "casino" },
                    { id: 31, name: "Yolo 777", image: "yolo777.png", category: "slots" }
                ];

                displayGames();
                loadClientGames();
            } catch (error) {
                console.error('Error loading games:', error);
                showNotification('Failed to load available games', 'error');
            }
        }

        async function loadClientGames() {
            try {
                // Load selected games from backend database (FIXED: was using localStorage)
                const response = await fetch(`${API_URL}/games/my-games`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    // Extract game IDs from the response
                    if (data.available_games && Array.isArray(data.available_games)) {
                        selectedGameIds = new Set(data.available_games.map(game => game.id));
                    } else {
                        selectedGameIds = new Set();
                    }
                } else {
                    // If API fails, start with empty selection
                    selectedGameIds = new Set();
                }

                updateGameSelection();
            } catch (error) {
                console.error('Error loading client games:', error);
                selectedGameIds = new Set();
                updateGameSelection();
            }
        }

        function displayGames() {
            const grid = document.getElementById('gamesGrid');
            const filteredGames = currentCategory === 'all'
                ? allGames
                : allGames.filter(game => game.category === currentCategory);

            grid.innerHTML = filteredGames.map(game => `
                <div class="game-card ${selectedGameIds.has(game.id) ? 'selected' : ''}"
                     data-game-id="${game.id}" onclick="toggleGame(${game.id})">
                    <div class="game-icon">
                        <img src="${API_URL}/static/images/games/${game.image}" alt="${game.name}"
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                        <i class="fas fa-gamepad" style="font-size: 2rem; color: var(--primary-gold); display: none;"></i>
                    </div>
                    <p class="game-name">${game.name}</p>
                </div>
            `).join('');
        }

        function toggleGame(gameId) {
            const card = document.querySelector(`[data-game-id="${gameId}"]`);

            if (selectedGameIds.has(gameId)) {
                selectedGameIds.delete(gameId);
                card.classList.remove('selected');
            } else {
                selectedGameIds.add(gameId);
                card.classList.add('selected');
            }

            updateSelectedCount();
        }

        function updateSelectedCount() {
            document.getElementById('selectedGamesCount').textContent = `${selectedGameIds.size} selected`;
        }

        function selectAllGames() {
            const filteredGames = currentCategory === 'all'
                ? allGames
                : allGames.filter(game => game.category === currentCategory);

            filteredGames.forEach(game => {
                selectedGameIds.add(game.id);
            });

            updateGameSelection();
        }

        function clearGameSelection() {
            if (currentCategory === 'all') {
                selectedGameIds.clear();
            } else {
                const filteredGames = allGames.filter(game => game.category === currentCategory);
                filteredGames.forEach(game => {
                    selectedGameIds.delete(game.id);
                });
            }

            updateGameSelection();
        }

        function updateGameSelection() {
            document.querySelectorAll('.game-card').forEach(card => {
                const gameId = parseInt(card.dataset.gameId);
                if (selectedGameIds.has(gameId)) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            });
            updateSelectedCount();
        }

        async function saveGameSelection() {
            try {
                console.log('=== SAVING GAMES ===');
                console.log('Selected game IDs:', Array.from(selectedGameIds));
                console.log('Number of games:', selectedGameIds.size);
                console.log('User ID:', currentUser.user_id);

                // Save selected games to backend database (FIXED: was only saving to localStorage)
                const response = await fetch(`${API_URL}/games/update-games`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        game_ids: Array.from(selectedGameIds)
                    })
                });

                console.log('API Response Status:', response.status);

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API Error:', errorText);
                    throw new Error('Failed to save games to server');
                }

                const result = await response.json();
                console.log('API Response:', result);
                console.log('âœ… Games saved successfully to database');
                console.log('===================');

                // Get selected game names for display
                const selectedGames = allGames.filter(game => selectedGameIds.has(game.id));
                const gameNames = selectedGames.map(game => game.name).join(', ');

                showNotification(`Game selection saved successfully! Selected: ${selectedGames.length} games`, 'success');
                console.log('Selected games:', gameNames);
            } catch (error) {
                console.error('Error saving game selection:', error);
                showNotification('Failed to save game selection', 'error');
            }
        }

        // Setup game category tabs
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.game-category-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // Update active tab
                    document.querySelectorAll('.game-category-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');

                    // Update current category and display
                    currentCategory = this.dataset.category;
                    displayGames();
                });
            });
        });

        // Toggle Game Credentials section
        function toggleGameCredentials() {
            const content = document.getElementById('gameCredentialsContent');
            const toggle = document.getElementById('gameCredentialsToggle');
            const icon = toggle.querySelector('i');

            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.style.transform = 'rotate(180deg)';
            } else {
                content.style.display = 'none';
                icon.style.transform = 'rotate(0deg)';
            }
        }

        // Load player credentials into the separate section
        async function loadPlayerCredentialsInSection(friendId) {
            const content = document.getElementById('gameCredentialsContent');

            // Create the form and list structure
            content.innerHTML = `
                <!-- Add Credential Form -->
                <div id="addPlayerCredentialForm-${friendId}" class="player-credentials-form" style="display: none; background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <div style="display: grid; gap: 0.75rem;">
                        <div>
                            <label style="display: block; margin-bottom: 0.25rem; color: #ccc; font-size: 0.875rem;">Game:</label>
                            <select id="credentialGameSelect-${friendId}" style="width: 100%; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 215, 0, 0.2); color: #fff; padding: 0.5rem; border-radius: 4px;">
                                <option value="">Select a game...</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.25rem; color: #ccc; font-size: 0.875rem;">Username:</label>
                            <input type="text" id="credentialUsername-${friendId}" placeholder="Game username" style="width: 100%; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 215, 0, 0.2); color: #fff; padding: 0.5rem; border-radius: 4px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.25rem; color: #ccc; font-size: 0.875rem;">Password:</label>
                            <input type="text" id="credentialPassword-${friendId}" placeholder="Game password" style="width: 100%; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 215, 0, 0.2); color: #fff; padding: 0.5rem; border-radius: 4px;">
                        </div>
                        <div style="display: flex; gap: 0.5rem; justify-content: flex-end;">
                            <button onclick="hidePlayerCredentialForm(${friendId})" style="background: rgba(255, 255, 255, 0.1); border: 1px solid #666; color: #ccc; padding: 0.5rem 1rem; border-radius: 4px; font-size: 0.875rem;">Cancel</button>
                            <button onclick="savePlayerGameCredential(${friendId})" style="background: linear-gradient(135deg, #FFD700, #FFA500); border: none; color: #1a1a2e; padding: 0.5rem 1rem; border-radius: 4px; font-size: 0.875rem; font-weight: 600;">Save</button>
                        </div>
                    </div>
                </div>

                <!-- Add Credential Button -->
                <div style="margin-bottom: 1rem;">
                    <button onclick="togglePlayerCredentialsForm(${friendId})" class="btn-secondary" style="background: linear-gradient(135deg, #FFD700, #FFA500); border: none; color: #1a1a2e; padding: 0.5rem 1rem; border-radius: 4px; font-size: 0.875rem; font-weight: 600;">
                        <i class="fas fa-plus"></i> Add New Credential
                    </button>
                </div>

                <!-- Player Credentials List -->
                <div id="playerCredentialsList-${friendId}" class="player-credentials-content">
                    <!-- Credentials will be loaded here -->
                </div>
            `;

            // Load games for this player's credential form
            await loadGamesForPlayer(friendId);

            // Load existing credentials for this player
            await loadPlayerCredentials(friendId);

            // Keep the section collapsed by default
            content.style.display = 'none';
        }

        // Game Credentials Management Functions
        let editingCredentialId = null;

        async function showAddCredentialForm() {
            document.getElementById('addCredentialForm').style.display = 'block';
            document.getElementById('credentialGameSelect').value = '';
            document.getElementById('credentialUsername').value = '';
            document.getElementById('credentialPassword').value = '';
            editingCredentialId = null;

            // Find the save button and update its text
            const saveButton = document.querySelector('#addCredentialForm button[onclick="saveGameCredential(event)"]');
            if (saveButton) {
                saveButton.textContent = 'Save';
            }

            // Load available games for the client
            await loadGamesForCredentials();
        }

        async function loadGamesForCredentials() {
            try {
                const response = await fetch(`${API_URL}/games/my-games`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    populateGameSelect(data.available_games);
                } else {
                    console.error('Failed to load games');
                    showNotification('Failed to load available games', 'error');
                }
            } catch (error) {
                console.error('Error loading games:', error);
                showNotification('Failed to load available games', 'error');
            }
        }

        function populateGameSelect(games) {
            const select = document.getElementById('credentialGameSelect');

            // Clear existing options (keep the default one)
            select.innerHTML = '<option value="">Select a game...</option>';

            // Add games as options
            games.forEach(game => {
                const option = document.createElement('option');
                option.value = game.id;
                option.textContent = game.display_name;
                select.appendChild(option);
            });

            if (games.length === 0) {
                select.innerHTML = '<option value="">âš ï¸ Please select games from Settings (Games tab) first to setup credentials</option>';
            }
        }

        function hideAddCredentialForm() {
            document.getElementById('addCredentialForm').style.display = 'none';
            editingCredentialId = null;
        }

        async function saveGameCredential(event) {
            event.preventDefault();

            const gameId = document.getElementById('credentialGameSelect').value;
            const username = document.getElementById('credentialUsername').value;
            const password = document.getElementById('credentialPassword').value;

            if (!gameId || !username || !password) {
                showNotification('Please fill in all fields', 'error');
                return;
            }

            try {
                let response;
                if (editingCredentialId) {
                    // Update existing credential
                    response = await fetch(`${API_URL}/game-credentials/${editingCredentialId}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${authToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            game_username: username,
                            game_password: password
                        })
                    });
                } else {
                    // Create new credential
                    response = await fetch(`${API_URL}/game-credentials/`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${authToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            player_id: parseInt(currentPlayerId),
                            game_id: parseInt(gameId),
                            game_username: username,
                            game_password: password
                        })
                    });
                }

                if (response.ok) {
                    showNotification(editingCredentialId ? 'Credential updated successfully' : 'Credential added successfully', 'success');
                    hideAddCredentialForm();
                    loadCurrentPlayerCredentials();
                } else {
                    const error = await response.json();
                    showNotification(error.detail || 'Failed to save credential', 'error');
                }
            } catch (error) {
                console.error('Error saving credential:', error);
                showNotification('Failed to save credential', 'error');
            }
        }

        async function loadCurrentPlayerCredentials() {
            if (!currentPlayerId) return;

            try {
                const response = await fetch(`${API_URL}/game-credentials/player/${currentPlayerId}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayCredentials(data.credentials);
                } else {
                    console.error('Failed to load credentials');
                }
            } catch (error) {
                console.error('Error loading credentials:', error);
            }
        }

        function displayCredentials(credentials) {
            const container = document.getElementById('credentialsList');

            if (credentials.length === 0) {
                container.innerHTML = '<p style="color: #888; text-align: center; padding: 1rem;">No game credentials found</p>';
                return;
            }

            container.innerHTML = credentials.map(credential => `
                <div class="credential-item" style="background: rgba(255, 255, 255, 0.05); border-radius: 8px; padding: 1rem; margin-bottom: 0.5rem;">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <div>
                            <h5 style="color: #FFD700; margin: 0 0 0.5rem 0;">${credential.game_display_name}</h5>
                            <p style="margin: 0.25rem 0; color: #ccc;"><strong>Username:</strong> ${credential.game_username}</p>
                            <p style="margin: 0.25rem 0; color: #ccc;"><strong>Password:</strong> ${credential.game_password}</p>
                            <p style="margin: 0.25rem 0 0 0; color: #888; font-size: 0.8rem;">Created: ${new Date(credential.created_at).toLocaleDateString()}</p>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn-small" onclick="editCredential(${credential.id}, ${credential.game_id}, '${credential.game_username}', '${credential.game_password}')" style="background: #4CAF50;">Edit</button>
                            <button class="btn-small" onclick="deleteCredential(${credential.id})" style="background: #f44336;">Delete</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        async function editCredential(credentialId, gameId, username, password) {
            editingCredentialId = credentialId;
            document.getElementById('addCredentialForm').style.display = 'block';
            document.getElementById('credentialUsername').value = username;
            document.getElementById('credentialPassword').value = password;

            // Find the save button and update its text
            const saveButton = document.querySelector('#addCredentialForm button[onclick="saveGameCredential(event)"]');
            if (saveButton) {
                saveButton.textContent = 'Update';
            }

            // Load games first, then set the selected game
            await loadGamesForCredentials();
            document.getElementById('credentialGameSelect').value = gameId;
        }

        async function deleteCredential(credentialId) {
            if (!confirm('Are you sure you want to delete this credential?')) {
                return;
            }

            try {
                const response = await fetch(`${API_URL}/game-credentials/${credentialId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    showNotification('Credential deleted successfully', 'success');
                    loadCurrentPlayerCredentials();
                } else {
                    const error = await response.json();
                    showNotification(error.detail || 'Failed to delete credential', 'error');
                }
            } catch (error) {
                console.error('Error deleting credential:', error);
                showNotification('Failed to delete credential', 'error');
            }
        }

        // Player-specific Game Credentials Management Functions
        async function togglePlayerCredentialsForm(playerId) {
            const form = document.getElementById(`addPlayerCredentialForm-${playerId}`);
            const toggle = document.getElementById(`credentialsToggle-${playerId}`);

            if (form.style.display === 'none') {
                form.style.display = 'block';
                toggle.innerHTML = '<i class="fas fa-times"></i>';

                // Clear form
                document.getElementById(`credentialGameSelect-${playerId}`).value = '';
                document.getElementById(`credentialUsername-${playerId}`).value = '';
                document.getElementById(`credentialPassword-${playerId}`).value = '';
            } else {
                form.style.display = 'none';
                toggle.innerHTML = '<i class="fas fa-plus"></i>';
            }
        }

        async function hidePlayerCredentialForm(playerId) {
            const form = document.getElementById(`addPlayerCredentialForm-${playerId}`);
            const toggle = document.getElementById(`credentialsToggle-${playerId}`);

            form.style.display = 'none';
            toggle.innerHTML = '<i class="fas fa-plus"></i>';
        }

        async function loadGamesForPlayer(playerId) {
            try {
                const response = await fetch(`${API_URL}/games/my-games`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    populatePlayerGameSelect(playerId, data.available_games);
                } else {
                    console.error('Failed to load games for player');
                }
            } catch (error) {
                console.error('Error loading games for player:', error);
            }
        }

        function populatePlayerGameSelect(playerId, games) {
            const select = document.getElementById(`credentialGameSelect-${playerId}`);
            if (!select) return;

            // Clear existing options (keep the default one)
            select.innerHTML = '<option value="">Select a game...</option>';

            // Add games as options
            games.forEach(game => {
                const option = document.createElement('option');
                option.value = game.id;
                option.textContent = game.display_name;
                select.appendChild(option);
            });

            if (games.length === 0) {
                select.innerHTML = '<option value="">âš ï¸ Please select games from Settings (Games tab) first to setup credentials</option>';
            }
        }

        async function savePlayerGameCredential(playerId) {
            const gameId = document.getElementById(`credentialGameSelect-${playerId}`).value;
            const username = document.getElementById(`credentialUsername-${playerId}`).value;
            const password = document.getElementById(`credentialPassword-${playerId}`).value;

            if (!gameId || !username || !password) {
                showNotification('Please fill in all fields', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/game-credentials/`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        player_id: parseInt(playerId),
                        game_id: parseInt(gameId),
                        game_username: username,
                        game_password: password
                    })
                });

                if (response.ok) {
                    showNotification('Game credential created successfully', 'success');
                    hidePlayerCredentialForm(playerId);
                    loadPlayerCredentials(playerId);
                } else {
                    const error = await response.json();
                    showNotification(error.detail || 'Failed to create credential', 'error');
                }
            } catch (error) {
                console.error('Error saving credential:', error);
                showNotification('Failed to create credential', 'error');
            }
        }

        async function loadPlayerCredentials(playerId) {
            try {
                const response = await fetch(`${API_URL}/game-credentials/player/${playerId}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayPlayerCredentials(playerId, data.credentials);
                } else {
                    console.log('No credentials found for player or failed to load');
                    displayPlayerCredentials(playerId, []);
                }
            } catch (error) {
                console.error('Error loading player credentials:', error);
                displayPlayerCredentials(playerId, []);
            }
        }

        function displayPlayerCredentials(playerId, credentials) {
            const container = document.getElementById(`playerCredentialsList-${playerId}`);
            if (!container) return;

            if (credentials.length === 0) {
                container.innerHTML = '<p style="color: #888; font-style: italic; margin: 0;">No game credentials yet</p>';
                return;
            }

            container.innerHTML = credentials.map(credential => `
                <div class="credential-item" style="background: rgba(255, 255, 255, 0.05); border-radius: 8px; padding: 0.75rem; margin-bottom: 0.5rem; border: 1px solid rgba(255, 215, 0, 0.1);">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong style="color: #FFD700;">${credential.game_display_name}</strong>
                            <div style="font-size: 0.875rem; color: #ccc; margin-top: 0.25rem;">
                                <div><strong>Username:</strong> ${credential.game_username}</div>
                                <div><strong>Password:</strong> ${credential.game_password}</div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button onclick="editPlayerCredential(${playerId}, ${credential.id}, '${credential.game_username}', '${credential.game_password}', ${credential.game_id})"
                                    style="background: rgba(255, 215, 0, 0.1); border: 1px solid #FFD700; color: #FFD700; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deletePlayerCredential(${credential.id}, ${playerId})"
                                    style="background: rgba(255, 0, 0, 0.1); border: 1px solid #ff6b6b; color: #ff6b6b; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        async function editPlayerCredential(playerId, credentialId, username, password, gameId) {
            // Show the form
            const form = document.getElementById(`addPlayerCredentialForm-${playerId}`);
            const toggle = document.getElementById(`credentialsToggle-${playerId}`);

            form.style.display = 'block';
            toggle.innerHTML = '<i class="fas fa-times"></i>';

            // Fill the form with current values
            document.getElementById(`credentialGameSelect-${playerId}`).value = gameId;
            document.getElementById(`credentialUsername-${playerId}`).value = username;
            document.getElementById(`credentialPassword-${playerId}`).value = password;

            // Update save button to handle edit
            const saveButton = form.querySelector('button[onclick*="savePlayerGameCredential"]');
            saveButton.setAttribute('onclick', `updatePlayerCredential(${playerId}, ${credentialId})`);
            saveButton.textContent = 'Update';
        }

        async function updatePlayerCredential(playerId, credentialId) {
            const username = document.getElementById(`credentialUsername-${playerId}`).value;
            const password = document.getElementById(`credentialPassword-${playerId}`).value;

            if (!username || !password) {
                showNotification('Please fill in all fields', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/game-credentials/${credentialId}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        game_username: username,
                        game_password: password
                    })
                });

                if (response.ok) {
                    showNotification('Game credential updated successfully', 'success');
                    hidePlayerCredentialForm(playerId);
                    loadPlayerCredentials(playerId);

                    // Reset save button
                    const form = document.getElementById(`addPlayerCredentialForm-${playerId}`);
                    const saveButton = form.querySelector('button[onclick*="updatePlayerCredential"]');
                    saveButton.setAttribute('onclick', `savePlayerGameCredential(${playerId})`);
                    saveButton.textContent = 'Save';
                } else {
                    const error = await response.json();
                    showNotification(error.detail || 'Failed to update credential', 'error');
                }
            } catch (error) {
                console.error('Error updating credential:', error);
                showNotification('Failed to update credential', 'error');
            }
        }

        async function deletePlayerCredential(credentialId, playerId) {
            if (!confirm('Are you sure you want to delete this game credential?')) {
                return;
            }

            try {
                const response = await fetch(`${API_URL}/game-credentials/${credentialId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    showNotification('Credential deleted successfully', 'success');
                    loadPlayerCredentials(playerId);
                } else {
                    const error = await response.json();
                    showNotification(error.detail || 'Failed to delete credential', 'error');
                }
            } catch (error) {
                console.error('Error deleting credential:', error);
                showNotification('Failed to delete credential', 'error');
            }
        }

        // Reporting System Functions
        let currentReportUserId = null;
        let currentEditingReport = null;

        async function loadUserReports(userId) {
            currentReportUserId = userId;
            try {
                const response = await fetch(`${API_URL}/reports/user/${userId}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();

                    // Update total reports count
                    document.getElementById('totalReportsCount').textContent =
                        `This user has received ${data.total_reports} report(s)`;

                    // Show/hide report creation button based on can_report
                    const createBtn = document.getElementById('createReportBtn');
                    if (data.can_report) {
                        createBtn.style.display = 'inline-block';
                        createBtn.textContent = 'Report User';
                    } else if (data.my_report) {
                        createBtn.style.display = 'none';
                        // Show user's existing report
                        showMyReport(data.my_report);
                    } else {
                        createBtn.style.display = 'none';
                    }
                } else {
                    showNotification('Failed to load reports', 'error');
                }
            } catch (error) {
                console.error('Error loading user reports:', error);
                showNotification('Error loading reports', 'error');
            }
        }

        function showMyReport(report) {
            const myReportSection = document.getElementById('myReportOnUser');
            const myReportCard = document.getElementById('myReportCard');

            myReportCard.innerHTML = createReportCard(report, true);
            myReportSection.style.display = 'block';
        }

        function createReportCard(report, isMyReport = false) {
            return `
                <div class="report-meta">
                    <div>
                        <strong style="color: var(--text-primary);">${isMyReport ? 'Your Report' : `Report by ${report.reporter_name}`}</strong>
                        <div style="color: var(--text-secondary); font-size: 0.875rem;">
                            ${new Date(report.created_at).toLocaleDateString()}
                        </div>
                    </div>
                    <span class="report-status ${report.status.toLowerCase()}">${report.status}</span>
                </div>
                <div class="report-reason">${report.reason}</div>
                ${isMyReport ? `
                    <div class="report-actions">
                        <button class="edit-report-btn" onclick="editReport(${report.id}, '${report.reason.replace(/'/g, "\\'")}')">
                            Edit Report
                        </button>
                        <button class="delete-report-btn" onclick="deleteReport(${report.id})">
                            Delete Report
                        </button>
                    </div>
                ` : ''}
            `;
        }

        function showReportForm() {
            document.getElementById('reportDisplaySection').style.display = 'none';
            document.getElementById('reportActionSection').style.display = 'block';
            document.getElementById('reportReason').value = '';
            document.getElementById('submitReportBtn').textContent = 'Submit Report';
            currentEditingReport = null;
        }

        function editReport(reportId, currentReason) {
            document.getElementById('reportDisplaySection').style.display = 'none';
            document.getElementById('reportActionSection').style.display = 'block';
            document.getElementById('reportReason').value = currentReason;
            document.getElementById('submitReportBtn').textContent = 'Update Report';
            currentEditingReport = reportId;
        }

        function cancelReportAction() {
            document.getElementById('reportActionSection').style.display = 'none';
            document.getElementById('reportDisplaySection').style.display = 'block';
            currentEditingReport = null;
        }

        async function submitReport(event) {
            event.preventDefault();

            const reason = document.getElementById('reportReason').value.trim();
            if (!reason) {
                showNotification('Please provide a reason for the report', 'error');
                return;
            }

            try {
                let response;

                if (currentEditingReport) {
                    // Update existing report
                    response = await fetch(`${API_URL}/reports/${currentEditingReport}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${authToken}`
                        },
                        body: JSON.stringify({ reason })
                    });
                } else {
                    // Create new report
                    response = await fetch(`${API_URL}/reports/`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${authToken}`
                        },
                        body: JSON.stringify({
                            reported_user_id: currentReportUserId,
                            reason
                        })
                    });
                }

                if (response.ok) {
                    const data = await response.json();
                    showNotification(currentEditingReport ? 'Report updated successfully' : 'Report submitted successfully', 'success');
                    cancelReportAction();

                    // Show the updated report
                    showMyReport(data);

                    // Hide create button
                    document.getElementById('createReportBtn').style.display = 'none';
                } else {
                    const errorData = await response.json();
                    showNotification(errorData.detail || 'Failed to submit report', 'error');
                }
            } catch (error) {
                console.error('Error submitting report:', error);
                showNotification('Error submitting report', 'error');
            }
        }

        async function deleteReport(reportId) {
            if (!confirm('Are you sure you want to delete this report?')) {
                return;
            }

            try {
                const response = await fetch(`${API_URL}/reports/${reportId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    showNotification('Report deleted successfully', 'success');

                    // Hide my report section and show create button
                    document.getElementById('myReportOnUser').style.display = 'none';
                    document.getElementById('createReportBtn').style.display = 'inline-block';
                    document.getElementById('createReportBtn').textContent = 'Report User';
                } else {
                    const errorData = await response.json();
                    showNotification(errorData.detail || 'Failed to delete report', 'error');
                }
            } catch (error) {
                console.error('Error deleting report:', error);
                showNotification('Error deleting report', 'error');
            }
        }

        async function loadMyReports() {
            try {
                const response = await fetch(`${API_URL}/reports/my-reports`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();

                    // Create modal to show reports
                    const reportsHtml = `
                        <div class="modal" style="display: block;">
                            <div class="modal-content" style="max-width: 800px;">
                                <div class="modal-header">
                                    <h3>My Reports</h3>
                                    <span class="close" onclick="this.closest('.modal').remove()">&times;</span>
                                </div>
                                <div class="modal-body" style="max-height: 600px; overflow-y: auto;">
                                    <div style="margin-bottom: 2rem;">
                                        <h4 style="color: var(--accent-color); margin-bottom: 1rem;">Reports I Made (${data.reports_made.length})</h4>
                                        ${data.reports_made.length > 0 ?
                                            data.reports_made.map(report => `
                                                <div class="report-card">
                                                    <strong>Against: ${report.reported_user_name} (@${report.reported_user_username})</strong>
                                                    ${createReportCard(report, false)}
                                                </div>
                                            `).join('') :
                                            '<p style="color: var(--text-secondary);">You haven\'t made any reports.</p>'
                                        }
                                    </div>
                                    <div>
                                        <h4 style="color: var(--accent-color); margin-bottom: 1rem;">Reports Against Me (${data.reports_received.length})</h4>
                                        ${data.reports_received.length > 0 ?
                                            data.reports_received.map(report => `
                                                <div class="report-card">
                                                    ${createReportCard(report, false)}
                                                </div>
                                            `).join('') :
                                            '<p style="color: var(--text-secondary);">No reports have been made against you.</p>'
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;

                    document.body.insertAdjacentHTML('beforeend', reportsHtml);
                } else {
                    showNotification('Failed to load your reports', 'error');
                }
            } catch (error) {
                console.error('Error loading my reports:', error);
                showNotification('Error loading reports', 'error');
            }
        }

        // Add event listener for report form when page loads
        document.addEventListener('DOMContentLoaded', function() {
            const reportForm = document.getElementById('reportForm');
            if (reportForm) {
                reportForm.addEventListener('submit', submitReport);
            }
        });

        // Reports Section Functions for Main Dashboard
        let currentReportTab = 'made';
        let allReportsData = { reports_made: [], reports_received: [] };

        async function loadAllReports() {
            try {
                const response = await fetch(`${API_URL}/reports/my-reports`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    allReportsData = await response.json();
                    updateReportStats();
                    displayReports(currentReportTab);
                } else {
                    showNotification('Failed to load reports', 'error');
                }
            } catch (error) {
                console.error('Error loading reports:', error);
                showNotification('Error loading reports', 'error');
            }
        }

        function updateReportStats() {
            // Update stats with null checks
            const reportsMadeEl = document.getElementById('reportsMadeCount');
            const reportsReceivedEl = document.getElementById('reportsReceivedCount');
            const pendingReportsEl = document.getElementById('pendingReportsCount');
            const resolvedReportsEl = document.getElementById('resolvedReportsCount');

            if (reportsMadeEl) reportsMadeEl.textContent = allReportsData.reports_made.length;
            if (reportsReceivedEl) reportsReceivedEl.textContent = allReportsData.reports_received.length;

            // Count pending and resolved
            let pendingCount = 0;
            let resolvedCount = 0;

            [...allReportsData.reports_made, ...allReportsData.reports_received].forEach(report => {
                if (report.status === 'pending') pendingCount++;
                if (report.status === 'resolved') resolvedCount++;
            });

            if (pendingReportsEl) pendingReportsEl.textContent = pendingCount;
            if (resolvedReportsEl) resolvedReportsEl.textContent = resolvedCount;
        }

        async function loadReportsForSection() {
            try {
                const response = await fetch(`${API_URL}/reports/my-reports`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (!response.ok) throw new Error('Failed to load reports');

                allReportsData = await response.json();

                // Update counts
                document.getElementById('reportsMadeCount').textContent = allReportsData.reports_made?.length || 0;
                document.getElementById('reportsReceivedCount').textContent = allReportsData.reports_received?.length || 0;

                // Display reports made by default
                switchReportTab('made');
            } catch (error) {
                console.error('Error loading reports:', error);
                showNotification('Failed to load reports', 'error');
            }
        }

        function switchReportTab(tab) {
            currentReportTab = tab;

            // Update tab buttons
            document.querySelectorAll('.report-tab-btn').forEach(btn => {
                if ((tab === 'made' && btn.textContent.includes('I Made')) ||
                    (tab === 'received' && btn.textContent.includes('About Me'))) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });

            // Show/hide report lists
            const madeList = document.getElementById('reportsMadeList');
            const receivedList = document.getElementById('reportsReceivedList');

            if (tab === 'made') {
                madeList.style.display = 'block';
                receivedList.style.display = 'none';
                displayReportsInSection('made');
            } else {
                madeList.style.display = 'none';
                receivedList.style.display = 'block';
                displayReportsInSection('received');
            }
        }

        function displayReportsInSection(tab) {
            const container = tab === 'made' ? document.getElementById('reportsMadeList') : document.getElementById('reportsReceivedList');
            const reports = tab === 'made' ? allReportsData.reports_made : allReportsData.reports_received;

            if (!container) return;

            if (!reports || reports.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                        ${tab === 'made' ? 'You have not made any reports.' : 'No reports have been made about you.'}
                    </div>
                `;
                return;
            }

            container.innerHTML = reports.map(report => `
                <div class="review-card">
                    <div class="review-header">
                        <div class="review-author">
                            <div class="avatar-small">
                                <i class="fas fa-user"></i>
                            </div>
                            <div>
                                <h4>${tab === 'made' ? report.reported_user_username : report.reporter_username}</h4>
                                <span>${tab === 'made' ? report.reported_user_name : report.reporter_name}</span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            ${tab === 'made' ? `
                                <button class="btn-icon btn-secondary" onclick="editReport(${report.id}, '${report.reason.replace(/'/g, "\\'")}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-icon btn-danger" onclick="deleteReport(${report.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                            <span class="badge ${report.status === 'pending' ? 'badge-warning' : report.status === 'resolved' ? 'badge-success' : 'badge-info'}">
                                ${report.status}
                            </span>
                        </div>
                    </div>
                    <div class="review-content">
                        <p>${report.reason}</p>
                    </div>
                    <div class="review-footer">
                        <span>${new Date(report.created_at).toLocaleDateString()}</span>
                    </div>
                </div>
            `).join('');
        }

        function displayReports(tab) {
            const containerId = tab === 'made' ? 'reportsMadeList' : 'reportsReceivedList';
            const container = document.getElementById(containerId);

            if (!container) {
                console.error(`Reports container not found: ${containerId}`);
                return;
            }

            const reports = tab === 'made' ? allReportsData.reports_made : allReportsData.reports_received;

            if (reports.length === 0) {
                container.innerHTML = `
                    <p style="color: var(--text-secondary); text-align: center; padding: 2rem;">
                        ${tab === 'made' ? "You haven't made any reports yet." : "No reports have been made against you."}
                    </p>
                `;
                return;
            }

            container.innerHTML = reports.map(report => `
                <div class="report-card" style="
                    background: var(--bg-secondary);
                    border: 1px solid var(--border-color);
                    border-radius: 0.75rem;
                    padding: 1.5rem;
                    margin-bottom: 1rem;
                    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                ">
                    <div class="report-meta" style="
                        display: flex;
                        justify-content: space-between;
                        align-items: flex-start;
                        margin-bottom: 1rem;
                    ">
                        <div>
                            <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">
                                ${tab === 'made' ?
                                    `Report against ${report.reported_user_name} (@${report.reported_user_username})` :
                                    `Reported by ${report.reporter_name} (@${report.reporter_username})`
                                }
                            </h4>
                            <div style="color: var(--text-secondary); font-size: 0.875rem;">
                                <i class="fas fa-calendar"></i> ${new Date(report.created_at).toLocaleDateString()}
                            </div>
                        </div>
                        <span class="report-status ${report.status.toLowerCase()}" style="
                            padding: 0.25rem 0.75rem;
                            border-radius: 1rem;
                            font-size: 0.75rem;
                            font-weight: 600;
                            text-transform: uppercase;
                        ">${report.status}</span>
                    </div>

                    <div class="report-reason" style="
                        background: var(--bg-primary);
                        border: 1px solid var(--border-color);
                        border-radius: 0.5rem;
                        padding: 1rem;
                        margin: 1rem 0;
                        color: var(--text-primary);
                    ">
                        <strong style="color: var(--accent-color);">Reason:</strong><br>
                        ${report.reason}
                    </div>

                    ${tab === 'made' && report.status === 'pending' ? `
                        <div class="report-actions" style="
                            display: flex;
                            gap: 0.75rem;
                            margin-top: 1rem;
                        ">
                            <button class="btn-secondary" onclick="editMainReport(${report.id}, '${report.reason.replace(/'/g, "\\'")}')" style="
                                padding: 0.5rem 1rem;
                                border-radius: 0.375rem;
                                font-size: 0.875rem;
                            ">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn-danger" onclick="deleteMainReport(${report.id})" style="
                                background: #dc3545;
                                color: #fff;
                                padding: 0.5rem 1rem;
                                border-radius: 0.375rem;
                                border: none;
                                cursor: pointer;
                                font-size: 0.875rem;
                            ">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        async function editMainReport(reportId, currentReason) {
            const newReason = prompt('Edit your report reason:', currentReason);
            if (newReason && newReason !== currentReason) {
                try {
                    const response = await fetch(`${API_URL}/reports/${reportId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${authToken}`
                        },
                        body: JSON.stringify({ reason: newReason })
                    });

                    if (response.ok) {
                        showNotification('Report updated successfully', 'success');
                        loadAllReports();
                    } else {
                        const errorData = await response.json();
                        showNotification(errorData.detail || 'Failed to update report', 'error');
                    }
                } catch (error) {
                    console.error('Error updating report:', error);
                    showNotification('Error updating report', 'error');
                }
            }
        }

        async function deleteMainReport(reportId) {
            if (!confirm('Are you sure you want to delete this report?')) {
                return;
            }

            try {
                const response = await fetch(`${API_URL}/reports/${reportId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    showNotification('Report deleted successfully', 'success');
                    loadAllReports();
                } else {
                    const errorData = await response.json();
                    showNotification(errorData.detail || 'Failed to delete report', 'error');
                }
            } catch (error) {
                console.error('Error deleting report:', error);
                showNotification('Error deleting report', 'error');
            }
        }

        // Load reports when dashboard loads
        window.addEventListener('load', () => {
            if (authToken) {
                setTimeout(loadAllReports, 2000); // Load after other data
            }
        });

    </script>
</body>
</html>